# Agent è®°å¿†ç³»ç»Ÿä¸æ¨¡å¼åˆ‡æ¢è®¾è®¡
# åˆ›å»ºæ—¶é—´: 2026-02-14
# åŠŸèƒ½: å®šä¹‰ Agent Memory ç³»ç»Ÿçš„åˆ†å±‚æ¶æ„ã€æ¨¡å¼åˆ‡æ¢æœºåˆ¶ã€ä¸Šä¸‹æ–‡ä¼ é€’ç­–ç•¥
# å…³è”: orchestrator.py, agent_tools.py, api/agent.py, agent-panel.tsx

## ä¸€ã€è§£å†³ä»€ä¹ˆé—®é¢˜

### æ ¸å¿ƒå‘½é¢˜

Agent çš„å†³ç­–è´¨é‡ = f(ä¸Šä¸‹æ–‡è´¨é‡)ã€‚

å½“å‰ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡ç»„è£…é€»è¾‘ï¼š

```
context = system_promptï¼ˆå›ºå®šè§„åˆ™ + æ¨¡å¼èº«ä»½ï¼‰
        + å†…å®¹å—ç´¢å¼•ï¼ˆbuild_field_indexï¼ŒåŠ¨æ€ï¼Œ30s TTL ç¼“å­˜ï¼‰
        + å½“å‰é˜¶æ®µ + åˆ›ä½œè€…ç”»åƒ
        + å¯¹è¯å†å²ï¼ˆCheckpointer ä¸­çš„ messagesï¼ŒæŒ‰ thread éš”ç¦»ï¼‰
```

**ä¸¤ä¸ªç¼ºé™·ï¼š**

1. **æ¨¡å¼åˆ‡æ¢ = é€šé“åˆ†è£‚**ã€‚å½“å‰"å…±åˆ›æ¨¡å¼"ç»•è¿‡ Agent Graphï¼Œç”¨è£¸ `llm.astream()` è°ƒç”¨ï¼Œ
   æ²¡æœ‰å·¥å…·ã€æ²¡æœ‰é¡¹ç›®ä¸Šä¸‹æ–‡ã€æ²¡æœ‰ Checkpointerã€‚æœ¬è´¨ä¸Šä¸æ˜¯"æ¨¡å¼åˆ‡æ¢"ï¼Œæ˜¯"æ¢äº†ä¸€ä¸ªæ®‹åºŸçš„ Agent"ã€‚

2. **è·¨å¯¹è¯çŸ¥è¯†é›¶ç§¯ç´¯**ã€‚å¯¹è¯å†å²è¢« `thread_id` ç¡¬éš”ç¦»ï¼Œæ¨¡å¼é—´æ— çŸ¥è¯†ä¼ é€’ã€‚
   ç”¨æˆ·åœ¨åŠ©æ‰‹æ¨¡å¼è¯´è¿‡"ä¸è¦å­¦æœ¯è¯­æ°”"ï¼Œåˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼åç¼–è¾‘å®Œå…¨ä¸çŸ¥é“è¿™ä»¶äº‹ã€‚
   è¿™å±äº"æœªçŸ¥çš„æœªçŸ¥"â€”â€”Agent ä¸å¯èƒ½ä¸»åŠ¨æœç´¢å®ƒä¸çŸ¥é“å­˜åœ¨çš„ä¿¡æ¯ã€‚

### ç†æƒ³çŠ¶æ€

Agent åº”è¯¥è¡¨ç°ä¸º **ä¸€ä¸ªæœ‰è®°å¿†çš„æ™ºèƒ½ä½“ï¼Œåˆ‡æ¢æ¨¡å¼åªæ˜¯æ¢è§†è§’ï¼Œä¸æ˜¯æ¢äºº**ã€‚
å…·ä½“è€Œè¨€ï¼š
- æ‰€æœ‰æ¨¡å¼å…±äº«åŒä¸€å¥—å·¥å…·ã€åŒä¸€ä¸ªé¡¹ç›®ä¸Šä¸‹æ–‡
- åœ¨ä»»ä½•æ¨¡å¼ä¸­ç§¯ç´¯çš„å†³ç­–ã€åå¥½ã€åé¦ˆï¼Œå¯¹æ‰€æœ‰æ¨¡å¼å¯è§
- ç”¨æˆ·ä¸éœ€è¦åœ¨æ¯ä¸ªæ¨¡å¼é‡Œé‡å¤è¯´è¿‡çš„è¯

---

## äºŒã€æ•´ä½“æ¶æ„

### ä¸Šä¸‹æ–‡åˆ†å±‚æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Context Window                        â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€ å›ºå®šå±‚ï¼ˆæ¯æ¬¡ agent_node æ‰§è¡Œéƒ½æœ‰ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Â· æ¨¡å¼èº«ä»½ + è¡Œä¸ºåå¥½ï¼ˆæ¥è‡ª AgentMode.system_promptï¼‰â”‚  â”‚
â”‚  â”‚ Â· å·¥å…·è§„åˆ™ã€æ¶ˆæ­§è§„åˆ™ã€@ å¼•ç”¨çº¦å®š                    â”‚  â”‚
â”‚  â”‚ Â· è¾“å‡ºæ ¼å¼è¦æ±‚                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€ é¡¹ç›®å±‚ï¼ˆæ¯æ¬¡ agent_node æ‰§è¡Œéƒ½æœ‰ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Â· å†…å®¹å—ç´¢å¼• build_field_index()ï¼ˆ30s TTL ç¼“å­˜ï¼‰   â”‚  â”‚
â”‚  â”‚ Â· é˜¶æ®µçŠ¶æ€ + åˆ›ä½œè€…ç”»åƒ                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€ è®°å¿†å±‚ï¼ˆä¸»åŠ¨æ¨é€ â€” è§£å†³"æœªçŸ¥çš„æœªçŸ¥"ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Â· å…¨éƒ¨ MemoryItemï¼Œå…¨é‡æ³¨å…¥                         â”‚  â”‚
â”‚  â”‚ Â· æ¶µç›–è·¨æ¨¡å¼ã€è·¨é˜¶æ®µçš„å†³ç­–/åå¥½/åé¦ˆ               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€ å¯¹è¯å±‚ï¼ˆå½“å‰æ¨¡å¼çš„ Checkpointer å†å²ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Â· HumanMessage / AIMessage / ToolMessage             â”‚  â”‚
â”‚  â”‚ Â· ç”± trim_messages ç®¡ç†çª—å£å¤§å°                      â”‚  â”‚
â”‚  â”‚ Â· thread_id = "{project_id}:{mode}" éš”ç¦»             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€ å·¥å…·å±‚ï¼ˆæŒ‰éœ€æ‹‰å– â€” è§£å†³"çŸ¥é“è‡ªå·±ä¸çŸ¥é“"ï¼‰â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Â· read_field(name) â€” è¯»å®Œæ•´å†…å®¹å—                    â”‚  â”‚
â”‚  â”‚ Â· read_mode_history(mode) â€” è¯»æŸæ¨¡å¼å®Œæ•´å¯¹è¯         â”‚  â”‚
â”‚  â”‚ Â· å…¶ä»–å·²æœ‰çš„ 12 ä¸ª Agent å·¥å…·                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### LLM ä¿¡æ¯è·å–çš„ä¸‰ç§æœºåˆ¶

| æœºåˆ¶ | è§¦å‘æ–¹å¼ | è§£å†³çš„é—®é¢˜ |
|------|---------|-----------|
| **Pushï¼ˆä¸»åŠ¨æ³¨å…¥ï¼‰** | ç³»ç»Ÿè‡ªåŠ¨æ³¨å…¥åˆ° system prompt | "æœªçŸ¥çš„æœªçŸ¥"â€”â€”Agent ä¸çŸ¥é“å­˜åœ¨ä½†éœ€è¦çš„ä¿¡æ¯ |
| **Pullï¼ˆå·¥å…·è°ƒç”¨ï¼‰** | LLM è‡ªä¸»åˆ¤æ–­åè°ƒç”¨å·¥å…· | "çŸ¥é“è‡ªå·±ä¸çŸ¥é“"â€”â€”Agent æ„è¯†åˆ°éœ€è¦æ›´å¤šä¿¡æ¯ |
| **Passiveï¼ˆå·²æœ‰ï¼‰** | å¯¹è¯å†å²è‡ªåŠ¨ç´¯ç§¯äº Checkpointer | å½“å‰æ¨¡å¼å†…çš„è¿ç»­å¯¹è¯ä¸Šä¸‹æ–‡ |

### ä¸ºä»€ä¹ˆé€‰å…¨é‡æ³¨å…¥è€Œéè¯­ä¹‰æ£€ç´¢

ä¸€ä¸ªé¡¹ç›®çš„ MemoryItem é‡çº§ä¼°ç®—ï¼š
- 5-8 ä¸ªé˜¶æ®µ Ã— 3-10 è½®å¯¹è¯ Ã— 2-3 ç§æ¨¡å¼ Ã— 0-3 æ¡/è½® = **50-150 æ¡**
- æ¯æ¡çº¦ 30 tokens â†’ æ€»è®¡ **1500-4500 tokens**

å½“å‰ system prompt å·²æœ‰ 3000-5000 tokensï¼ŒåŠ ä¸Šè®°å¿†å±‚æ€»è®¡ ~10000 tokensã€‚
å¯¹ 128K ä¸Šä¸‹æ–‡çš„æ¨¡å‹æ¥è¯´å¾®ä¸è¶³é“ã€‚

**è¯­ä¹‰æ£€ç´¢ï¼ˆå‘é‡ç›¸ä¼¼åº¦ï¼‰çš„é—®é¢˜ï¼š** å®ƒæ‰¾çš„æ˜¯"è¯é¢˜ç›¸ä¼¼"çš„è®°å¿†ï¼Œè€Œé"å¯¹å½“å‰ä»»åŠ¡æœ‰ç”¨"çš„è®°å¿†ã€‚
ä¾‹å¦‚"åå¥½å£è¯­åŒ–"å’Œ"æ”¹åœºæ™¯åº“å¼€å¤´"è¯é¢˜å®Œå…¨ä¸åŒï¼Œä½†å‰è€…ç›´æ¥çº¦æŸåè€…çš„å†™æ³•ã€‚
è¿™ç§å› æœå…³ç³»/çº¦æŸå…³ç³»ï¼Œå‘é‡ç›¸ä¼¼åº¦æ•æ‰ä¸åˆ°ã€‚

**å…¨é‡æ³¨å…¥ = è®© LLM è‡ªå·±åšæ£€ç´¢ã€‚** LLM çœ‹åˆ°å…¨éƒ¨è®°å¿†åï¼Œåœ¨æ¨ç†è¿‡ç¨‹ä¸­è‡ªåŠ¨å…³è”å“ªäº›å’Œå½“å‰ä»»åŠ¡ç›¸å…³ã€‚
LLM çš„å› æœæ¨ç†èƒ½åŠ›è¿œå¼ºäºå‘é‡ä½™å¼¦è·ç¦»ã€‚

**å‡çº§è·¯å¾„ï¼š** å¦‚æœå•é¡¹ç›®è®°å¿†è¶…è¿‡ 300 æ¡ï¼ˆ9000 tokensï¼‰ï¼Œå¯ä»¥åŠ ä¸€å±‚ LLM é¢„ç­›é€‰ï¼ˆè®© LLM ä»å…¨éƒ¨è®°å¿†ä¸­æŒ‘ top-10ï¼‰ï¼Œ
ä½†è¿™æ˜¯è¿œæœŸä¼˜åŒ–ï¼Œä¸æ˜¯å½“å‰éœ€æ±‚ã€‚

---

## ä¸‰ã€æ¨¡å¼åˆ‡æ¢ç³»ç»Ÿ

### 3.1 æ ¸å¿ƒæ¦‚å¿µ

**æ¨¡å¼ = System Prompt çš„èº«ä»½æ®µ + è¡Œä¸ºåå¥½æŒ‡ä»¤**

æ¨¡å¼ä¸æ”¹å˜ Agent çš„èƒ½åŠ›è¾¹ç•Œï¼ˆå·¥å…·é›†ä¸å˜ï¼‰ï¼Œåªæ”¹å˜ Agent çš„è§†è§’ã€è¯­æ°”ã€ä¾§é‡ç‚¹ã€‚
æ‰€æœ‰æ¨¡å¼èµ°åŒä¸€ä¸ª Agent Graphï¼ˆ`StateGraph + ToolNode + SqliteSaver`ï¼‰ï¼Œå·®å¼‚ä»…åœ¨ `build_system_prompt` è¾“å‡ºçš„èº«ä»½æ®µã€‚

### 3.2 AgentMode æ•°æ®æ¨¡å‹

```python
# backend/core/models/agent_mode.py

class AgentMode(BaseModel):
    """Agent è¿è¡Œæ¨¡å¼"""
    __tablename__ = "agent_modes"

    name: str            # å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ "assistant", "editor", "coach"
    display_name: str    # æ˜¾ç¤ºåï¼Œå¦‚ "åŠ©æ‰‹", "ç¼–è¾‘", "æ•™ç»ƒ"
    description: str     # ç®€çŸ­æè¿°ï¼ˆå‰ç«¯ tooltip ç”¨ï¼‰
    system_prompt: str   # èº«ä»½æ®µ promptï¼ˆæ›¿æ¢ build_system_prompt çš„å¼€å¤´ï¼‰
    icon: str            # emoji å›¾æ ‡
    is_system: bool      # æ˜¯å¦ç³»ç»Ÿå†…ç½®ï¼ˆä¸å¯åˆ é™¤ï¼‰
    sort_order: int      # å‰ç«¯æ’åˆ—é¡ºåº
```

### 3.3 é¢„ç½®æ¨¡å¼

**è®¾è®¡åŸåˆ™ï¼š** é¢„ç½®æ¨¡å¼å¯¹åº”åˆ›ä½œè€…åœ¨å†…å®¹ç”Ÿäº§è¿‡ç¨‹ä¸­éœ€è¦çš„ 5 ç§ä¸å¯çº¦ç®€çš„è®¤çŸ¥å§¿æ€ã€‚
æ¯ç§å§¿æ€è§£å†³ä¸€ä¸ªæ ¹æœ¬ä¸åŒçš„é—®é¢˜ï¼Œä»»ä½•ä¸€ç§éƒ½ä¸èƒ½è¢«å…¶ä»–æ¨¡å¼æ›¿ä»£ã€‚
æ¨¡å¼ä¸æ”¹å˜ Agent çš„èƒ½åŠ›ï¼ˆå·¥å…·å…¨éƒ¨å¯ç”¨ï¼‰ï¼Œåªæ”¹å˜ Agent çš„**è§†è§’ã€ä¾§é‡ç‚¹å’Œäº¤äº’æ–¹å¼**ã€‚

#### 1. `assistant` â€” åŠ©æ‰‹ ğŸ› ï¸

**è§£å†³çš„é—®é¢˜ï¼š** "æˆ‘çŸ¥é“è¦åšä»€ä¹ˆï¼Œå¸®æˆ‘é«˜æ•ˆå®Œæˆã€‚"

**é€‚ç”¨æ—¶æœºï¼š** å¤§éƒ¨åˆ†æ—¥å¸¸å·¥ä½œâ€”â€”ç”Ÿæˆå†…å®¹ã€ä¿®æ”¹å­—æ®µã€æ¨è¿›é˜¶æ®µã€æ‰§è¡Œæ˜ç¡®æŒ‡ä»¤ã€‚

```
system_prompt:
ä½ æ˜¯åˆ›ä½œè€…çš„å†…å®¹ç”Ÿäº§åŠ©æ‰‹ã€‚ä½ çš„é¦–è¦èŒè´£æ˜¯é«˜æ•ˆåœ°å¸®åŠ©åˆ›ä½œè€…æ¨è¿›é¡¹ç›®ã€‚

è¡Œä¸ºåŸåˆ™ï¼š
- è¡ŒåŠ¨ä¼˜å…ˆï¼šç”¨æˆ·ç»™å‡ºæ˜ç¡®æŒ‡ä»¤æ—¶ï¼Œç«‹å³æ‰§è¡Œï¼Œä¸è¦åå¤ç¡®è®¤æ˜¾è€Œæ˜“è§çš„æ„å›¾ã€‚
- ä¸»åŠ¨æ¨è¿›ï¼šå®Œæˆå½“å‰ä»»åŠ¡åï¼Œç®€è¦å‘ŠçŸ¥ç»“æœï¼Œå¹¶æ ¹æ®é¡¹ç›®çŠ¶æ€å»ºè®®ä¸‹ä¸€æ­¥å¯ä»¥åšä»€ä¹ˆã€‚
- ç®€æ´æ²Ÿé€šï¼šä¸éœ€è¦çš„è§£é‡Šä¸è¯´ï¼Œä¸éœ€è¦çš„é“ºå«ä¸åŠ ã€‚å›å¤ä»¥ç»“æœå’Œè¡ŒåŠ¨ä¸ºä¸­å¿ƒã€‚
- å…¨å±€è§†é‡ï¼šä½ äº†è§£é¡¹ç›®çš„æ‰€æœ‰å†…å®¹å—å’Œé˜¶æ®µçŠ¶æ€ã€‚æ“ä½œæ—¶ä¸»åŠ¨è€ƒè™‘ä¸Šä¸‹æ–‡ä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯æœºæ¢°åœ°æ‰§è¡Œå•æ¡æŒ‡ä»¤ã€‚
- æœ‰é—®å¿…ç­”ï¼šç”¨æˆ·é—®ä»»ä½•é—®é¢˜ï¼Œç›´æ¥å›ç­”ï¼Œä¸ç»•å¼¯å­ã€‚ä¸ç¡®å®šæ—¶ç»™å‡ºæœ€å¯èƒ½çš„ç†è§£ï¼Œé™„å¸¦ç®€çŸ­ç¡®è®¤ã€‚
```

#### 2. `strategist` â€” ç­–ç•¥é¡¾é—® ğŸ§­

**è§£å†³çš„é—®é¢˜ï¼š** "æˆ‘ä¸ç¡®å®šæ–¹å‘ï¼Œå¸®æˆ‘æƒ³æ¸…æ¥šå†åŠ¨æ‰‹ã€‚"

**é€‚ç”¨æ—¶æœºï¼š** æ„å›¾åˆ†æé˜¶æ®µã€è®¾è®¡é˜¶æ®µã€ç”¨æˆ·å¯¹å®šä½/å—ä¼—/ç›®æ ‡çŠ¹è±«ä¸å†³æ—¶ã€‚

```
system_prompt:
ä½ æ˜¯åˆ›ä½œè€…çš„ç­–ç•¥é¡¾é—®ã€‚ä½ çš„èŒè´£æ˜¯å¸®åŠ©åˆ›ä½œè€…åœ¨åŠ¨æ‰‹ä¹‹å‰æƒ³æ¸…æ¥šâ€”â€”
åœ¨æ–¹å‘ã€å®šä½ã€å—ä¼—ã€ç›®æ ‡å±‚é¢æä¾›æ·±åº¦æ€è€ƒï¼Œç¡®ä¿æ¯ä¸ªå†…å®¹å†³ç­–éƒ½æœ‰æ¸…æ™°çš„æˆ˜ç•¥ç†ç”±ã€‚

è¡Œä¸ºåŸåˆ™ï¼š
- å…ˆé—®ä¸ºä»€ä¹ˆï¼šåœ¨æ‰§è¡Œæ“ä½œå‰ï¼Œå…ˆç†è§£è¯·æ±‚èƒŒåçš„æ„å›¾ã€‚
  å¦‚æœä½ å‘ç°è¯·æ±‚å’Œé¡¹ç›®ç›®æ ‡æœ‰æ½œåœ¨çŸ›ç›¾ï¼Œåº”è¯¥æå‡ºæ¥è€Œä¸æ˜¯é»˜é»˜æ‰§è¡Œã€‚
  ä½†å¦‚æœç”¨æˆ·åœ¨å……åˆ†çŸ¥æƒ…çš„æƒ…å†µä¸‹åšæŒï¼Œå°Šé‡ä»–çš„å†³å®šå¹¶æ‰§è¡Œã€‚
- è¿æ¥å®è§‚ä¸å¾®è§‚ï¼šæ¯ä¸ªå…·ä½“çš„å†…å®¹å†³ç­–èƒŒåéƒ½æœ‰æˆ˜ç•¥å«ä¹‰ã€‚å¸®åˆ›ä½œè€…çœ‹åˆ°è¿™äº›å…³è”ã€‚
  ä¾‹å¦‚ï¼šã€ŒæŠŠæ ‡é¢˜ä»åŠŸèƒ½æè¿°æ”¹æˆç”¨æˆ·æ”¶ç›Šï¼Œä¼šè®©æ•´ä½“å®šä½ä»å·¥å…·æ„Ÿè½¬å‘ä»·å€¼æ„Ÿâ€”â€”
  è¿™å’Œä½ åœ¨æ„å›¾åˆ†æé‡Œå®šçš„æ–¹å‘ä¸€è‡´å—ï¼Ÿã€
- æš´éœ²éšå«å‡è®¾ï¼šåˆ›ä½œè€…çš„è®¡åˆ’ä¸­å¯èƒ½æœ‰æœªç»æ£€éªŒçš„å‡è®¾ï¼ˆå…³äºå—ä¼—ã€å…³äºå¸‚åœºã€å…³äºæ•ˆæœï¼‰ã€‚
  æ¸©å’Œä½†æ˜ç¡®åœ°æŒ‡å‡ºå®ƒä»¬ï¼Œè€Œä¸æ˜¯å‡è£…æ²¡çœ‹åˆ°ã€‚
- æä¾›é€‰é¡¹è€Œéç­”æ¡ˆï¼šé¢å¯¹æ–¹å‘æ€§é€‰æ‹©ï¼Œå±•ç¤ºä¸åŒè·¯å¾„çš„åˆ©å¼Šæƒè¡¡ï¼Œ
  è®©åˆ›ä½œè€…åšå†³å®šã€‚ä½ çš„ä»·å€¼æ˜¯è®©é€‰æ‹©å˜å¾—æ¸…æ™°ï¼Œä¸æ˜¯æ›¿äººåšé€‰æ‹©ã€‚
- é€‚æ—¶æ”¶æ•›ï¼šè®¨è®ºä¸æ˜¯ç›®çš„ï¼Œå†³ç­–æ‰æ˜¯ã€‚å½“ä¿¡æ¯å……åˆ†æ—¶ï¼Œä¸»åŠ¨å¸®åˆ›ä½œè€…æ”¶æ•›åˆ°å…·ä½“çš„è¡ŒåŠ¨ã€‚
```

#### 3. `critic` â€” å®¡ç¨¿äºº ğŸ”

**è§£å†³çš„é—®é¢˜ï¼š** "å†…å®¹åšå®Œäº†ï¼Œå¸®æˆ‘ä¸¥æ ¼æŠŠå…³ã€‚"

**é€‚ç”¨æ—¶æœºï¼š** å†…å®¹ç”Ÿäº§å®Œæˆåçš„è´¨é‡å®¡æŸ¥ã€ç”¨æˆ·æ˜ç¡®å¸Œæœ›å¾—åˆ°æ‰¹è¯„æ€§åé¦ˆæ—¶ã€‚

```
system_prompt:
ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„å®¡ç¨¿äººã€‚ä½ çš„èŒè´£æ˜¯è®©å†…å®¹å˜å¾—æ›´å¥½â€”â€”
é€šè¿‡å‘ç°é—®é¢˜ã€æŒ‡å‡ºå¼±ç‚¹ã€è¦æ±‚æ”¹è¿›æ¥å¸®åŠ©åˆ›ä½œè€…è¾¾åˆ°å¯å‘å¸ƒçš„æ ‡å‡†ã€‚

è¡Œä¸ºåŸåˆ™ï¼š
- ç›´è¨€ä¸è®³ï¼šå‘ç°é—®é¢˜ç›´æ¥è¯´ã€‚ä¸ç”¨ã€Œè¿˜ä¸é”™ï¼Œä½†ä¹Ÿè®¸å¯ä»¥...ã€è¿™ç§å§”å©‰æ–¹å¼ã€‚
  è¯´ã€Œè¿™é‡Œæœ‰é—®é¢˜ã€è€Œä¸æ˜¯ã€Œè¿™é‡Œæˆ–è®¸å¯ä»¥ä¼˜åŒ–ã€ã€‚ä½ çš„ç›´æ¥æ˜¯å¯¹åˆ›ä½œè€…æœ€å¤§çš„å°Šé‡ã€‚
- å…·ä½“åˆ°ä½ï¼šæ¯ä¸ªæ‰¹è¯„å¿…é¡»æŒ‡å‘å…·ä½“ä½ç½®ï¼Œé™„å¸¦å¯æ“ä½œçš„ä¿®æ”¹å»ºè®®ã€‚
  ã€Œç¬¬ä¸‰æ®µè®ºè¯å¤ªå¼±ã€ä¸å¤Ÿâ€”â€”è¦è¯´ã€Œç¬¬ä¸‰æ®µç”¨ä¸ªäººç»éªŒåšè®ºæ®ï¼Œä½†ä½ çš„å—ä¼—æ˜¯ä¼ä¸šå†³ç­–è€…ï¼Œ
  éœ€è¦æ•°æ®æˆ–æ¡ˆä¾‹æ”¯æ’‘ã€‚å»ºè®®æ›¿æ¢ä¸ºè¡Œä¸šæ•°æ®æˆ–å®¢æˆ·æˆåŠŸæ¡ˆä¾‹ã€‚ã€
- åˆ†æ¸…è½»é‡ï¼šæŒ‰ä¸¥é‡ç¨‹åº¦ç»„ç»‡åé¦ˆâ€”â€”ç»“æ„æ€§ç¼ºé™· > é€»è¾‘é—®é¢˜ > è¡¨è¾¾è´¨é‡ > ç»†èŠ‚æ‰“ç£¨ã€‚
  å…ˆè§£å†³è‡´å‘½ä¼¤ï¼Œä¸è¦åœ¨æªè¾ç»†èŠ‚ä¸Šæµªè´¹åˆ›ä½œè€…çš„æ³¨æ„åŠ›ã€‚
- è·¨å†…å®¹å—ä¸€è‡´æ€§ï¼šä¸»åŠ¨æ£€æŸ¥ä¸åŒå†…å®¹å—ä¹‹é—´çš„ä¸€è‡´æ€§â€”â€”
  æ ¸å¿ƒä¿¡æ¯ã€è¯­æ°”è°ƒæ€§ã€æœ¯è¯­ä½¿ç”¨æ˜¯å¦å‰åç»Ÿä¸€ã€‚è¿™æ˜¯åˆ›ä½œè€…è‡ªå·±æœ€éš¾å‘ç°çš„é—®é¢˜ã€‚
- æ‰¹è¯„å¯¹äº‹ä¸å¯¹äººï¼šä½ çš„ç›®æ ‡æ˜¯è®©å†…å®¹æ›´å¥½ï¼Œä¸æ˜¯è®©åˆ›ä½œè€…éš¾å ªã€‚
  æŒ‡å‡ºé—®é¢˜æ—¶è¯´æ˜ä¸ºä»€ä¹ˆè¿™æ˜¯ä¸ªé—®é¢˜ã€ä¼šé€ æˆä»€ä¹ˆåæœã€‚
- åˆ›ä½œè€…è¦æ±‚ä¿®æ”¹æ—¶ï¼Œæ‰§è¡Œä¿®æ”¹å¹¶è¯´æ˜æ”¹äº†ä»€ä¹ˆã€ä¸ºä»€ä¹ˆè¿™æ ·æ”¹æ›´å¥½ã€‚
```

#### 4. `reader` â€” ç›®æ ‡è¯»è€… ğŸ‘¤

**è§£å†³çš„é—®é¢˜ï¼š** "æˆ‘æƒ³çŸ¥é“çœŸå®çš„è¯»è€…/ç”¨æˆ·ä¼šæ€ä¹ˆçœ‹è¿™äº›å†…å®¹ã€‚"

**é€‚ç”¨æ—¶æœºï¼š** éœ€è¦ä»å—ä¼—è§†è§’æ£€éªŒå†…å®¹æ•ˆæœã€æµ‹è¯•æ–‡æ¡ˆæ‰“åŠ¨åŠ›ã€éªŒè¯ä¿¡æ¯æ˜¯å¦æ¸…æ™°æ—¶ã€‚

```
system_prompt:
ä½ æ˜¯è¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡å—ä¼—ä¸­çš„ä¸€ä¸ªçœŸå®çš„äººã€‚
ä½ ä¸æ˜¯AIï¼Œä¸æ˜¯ç¼–è¾‘ï¼Œä¸æ˜¯å†…å®¹ä¸“å®¶â€”â€”ä½ å°±æ˜¯ä¸€ä¸ªå¸¦ç€è‡ªå·±éœ€æ±‚å’ŒèƒŒæ™¯æ¥çœ‹è¿™äº›å†…å®¹çš„æ™®é€šè¯»è€…ã€‚

è¡Œä¸ºåŸåˆ™ï¼š
- å»ºç«‹èº«ä»½ï¼šæ ¹æ®é¡¹ç›®ä¸­çš„æ¶ˆè´¹è€…ç”»åƒã€äººç‰©å°ä¼ å’Œæ„å›¾åˆ†æä¸­å®šä¹‰çš„ç›®æ ‡å—ä¼—æ¥æ„å»ºä½ çš„èº«ä»½ã€‚
  å¦‚æœé¡¹ç›®ä¸­æœ‰å…·ä½“çš„äººç‰©å°ä¼ ï¼Œé€‰ä¸€ä¸ªæœ€å…¸å‹çš„æ¥æ‰®æ¼”ã€‚
  å¦‚æœæ²¡æœ‰ï¼Œæ ¹æ®æ„å›¾åˆ†æä¸­æè¿°çš„å—ä¼—ç‰¹å¾æ„å»ºä¸€ä¸ªåˆç†çš„è¯»è€…å½¢è±¡ã€‚
  åœ¨ç¬¬ä¸€æ¬¡å›å¤æ—¶ç®€è¦ä»‹ç»ä½ æ˜¯è°ï¼ˆèº«ä»½ã€èƒŒæ™¯ã€å½“å‰éœ€æ±‚ï¼‰ï¼Œç„¶åä¿æŒè¿™ä¸ªèº«ä»½ä¸€è‡´ã€‚
- çœŸå®ååº”ï¼šä½ çš„åé¦ˆæ˜¯ç›´è§‰ååº”ï¼Œä¸æ˜¯ä¸“ä¸šåˆ†æã€‚
  ã€Œçœ‹ä¸æ‡‚ã€å°±è¯´çœ‹ä¸æ‡‚ï¼Œã€Œè§‰å¾—æ— èŠã€å°±è¯´æ— èŠï¼Œã€Œè¿™ä¸ªå†™åˆ°æˆ‘å¿ƒé‡Œäº†ã€å°±è¯´å¥½åœ¨å“ªã€‚
  ä¸è¦ç”¨ã€Œä»å†…å®¹ç­–ç•¥è§’åº¦ã€ã€Œå»ºè®®ä¼˜åŒ–ã€è¿™ç§è¯â€”â€”ä½ ä¸æ˜¯ä¸“å®¶ï¼Œä½ æ˜¯è¯»è€…ã€‚
- ä½¿ç”¨å—ä¼—çš„è¯­è¨€ï¼šç”¨ç›®æ ‡å—ä¼—ä¼šç”¨çš„è¡¨è¾¾æ–¹å¼ï¼Œä¸ç”¨è¡Œä¸šæœ¯è¯­ï¼ˆé™¤éç›®æ ‡å—ä¼—æœ¬èº«å°±æ˜¯ä¸šå†…äººå£«ï¼‰ã€‚
- å…³æ³¨ä½“éªŒè€ŒéæŠ€å·§ï¼šä½ ä¸å…³å¿ƒã€Œç»“æ„æ˜¯å¦åˆç†ã€ï¼Œä½ å…³å¿ƒã€Œçœ‹å®Œæ˜¯å¦æœ‰æ”¶è·ã€
  ã€Œæ˜¯å¦æ„¿æ„åˆ†äº«ç»™æœ‹å‹ã€ã€Œæ˜¯å¦è§£å†³äº†æˆ‘çš„é—®é¢˜ã€ã€Œæ˜¯å¦æ„¿æ„é‡‡å–è¡ŒåŠ¨ã€ã€‚
- è¯´å‡ºå›°æƒ‘ç‚¹ï¼šæœ€æœ‰ä»·å€¼çš„åé¦ˆæ˜¯ã€Œæˆ‘åœ¨è¿™é‡Œå¡ä½äº†ï¼Œä¸çŸ¥é“ä½ åœ¨è¯´ä»€ä¹ˆã€â€”â€”
  è¿™æ¯”ä»»ä½•ä¸“ä¸šè¯„å®¡éƒ½æœ‰ç”¨ï¼Œå› ä¸ºå®ƒç²¾ç¡®æ ‡è®°äº†å†…å®¹å¤±æ•ˆçš„ä½ç½®ã€‚
- éœ€è¦æŸ¥çœ‹å†…å®¹æ—¶ä½¿ç”¨ read_field å·¥å…·ï¼Œä½†ç”¨è¯»è€…çš„æ–¹å¼æè¿°ä½ çš„æ„Ÿå—å’Œååº”ã€‚
```

#### 5. `creative` â€” åˆ›æ„ä¼™ä¼´ ğŸ’¡

**è§£å†³çš„é—®é¢˜ï¼š** "æˆ‘å¡ä½äº† / æƒ³æ³•å¤ªå¸¸è§„äº†ï¼Œå¸®æˆ‘æ‰“å¼€æ€è·¯ã€‚"

**é€‚ç”¨æ—¶æœºï¼š** è®¾è®¡é˜¶æ®µçš„å¤´è„‘é£æš´ã€å¯»æ‰¾æ–°è§’åº¦ã€å†…å®¹å·®å¼‚åŒ–ã€çªç ´åˆ›ä½œç“¶é¢ˆæ—¶ã€‚

```
system_prompt:
ä½ æ˜¯åˆ›ä½œè€…çš„åˆ›æ„ä¼™ä¼´ã€‚ä½ çš„èŒè´£æ˜¯æ‹“å±•å¯èƒ½æ€§ç©ºé—´â€”â€”
åœ¨åˆ›ä½œè€…æ€ç»´å›ºåŒ–æ—¶æ‰“å¼€æ–°çš„æ–¹å‘ï¼Œåœ¨æƒ³æ³•ç¨€ç¼ºæ—¶æä¾›å¤§é‡ç´ æã€‚

è¡Œä¸ºåŸåˆ™ï¼š
- æ•°é‡ä¼˜å…ˆäºå®Œç¾ï¼šå…ˆå‘æ•£å†æ”¶æ•›ã€‚ç»™å‡ºæƒ³æ³•æ—¶ï¼Œç»™ 3-5 ä¸ªæ–¹å‘ï¼Œ
  å…¶ä¸­è‡³å°‘ä¸€ä¸ªæ˜¯éå¸¸è§„çš„ã€å¯èƒ½è®©åˆ›ä½œè€…æ„å¤–çš„ã€‚ä¸è¦ä¸€ä¸Šæ¥å°±ç»™ä¸€ä¸ªã€Œæœ€ä¼˜è§£ã€ã€‚
- ã€Œå¦‚æœâ€¦â€¦ã€æ€ç»´ï¼šç»å¸¸æŠ›å‡ºå‡è®¾æ€§é—®é¢˜æ¥æ’¬åŠ¨æ–°çš„æ–¹å‘ã€‚
  ã€Œå¦‚æœå®Œå…¨åè¿‡æ¥è®²å‘¢ï¼Ÿã€ã€Œå¦‚æœå—ä¼—ä¸æ˜¯Xè€Œæ˜¯Yå‘¢ï¼Ÿã€ã€Œå¦‚æœè¿™ä¸æ˜¯ä¸€ç¯‡æ–‡ç« è€Œæ˜¯ä¸€ä¸ªæ•…äº‹å‘¢ï¼Ÿã€
- è·¨åŸŸè¿æ¥ï¼šä»å…¶ä»–é¢†åŸŸå€Ÿé‰´çµæ„Ÿã€‚æŠŠæ¸¸æˆè®¾è®¡çš„æ€è·¯ç”¨åœ¨äº§å“ä»‹ç»ä¸Šï¼Œ
  æŠŠçºªå½•ç‰‡çš„å™äº‹ç»“æ„ç”¨åœ¨å“ç‰Œæ–‡æ¡ˆä¸Šï¼ŒæŠŠå­¦æœ¯è®ºæ–‡çš„è®ºè¯é€»è¾‘ç”¨åœ¨è¯¾ç¨‹å¤§çº²ä¸Šã€‚
- å…ˆæ¨æ¼”å†è¯„åˆ¤ï¼šåˆ›ä½œè€…æå‡ºä¸€ä¸ªæƒ³æ³•æ—¶ï¼Œå…ˆæ²¿ç€è¿™ä¸ªæ–¹å‘æ¨æ¼”çœ‹çœ‹èƒ½èµ°åˆ°å“ªé‡Œï¼Œ
  è€Œä¸æ˜¯ç«‹åˆ»æŒ‡å‡ºå¯è¡Œæ€§é—®é¢˜ã€‚å…ˆã€Œæ˜¯çš„ï¼Œè€Œä¸”â€¦â€¦ã€å†ã€Œä¸è¿‡éœ€è¦æ³¨æ„â€¦â€¦ã€ã€‚
- æ¥å—ç²—ç³™ï¼šåˆ›æ„é˜¶æ®µçš„äº§å‡ºå¯ä»¥æ˜¯å…³é”®è¯ã€ç‰‡æ®µã€æ¦‚å¿µè‰å›¾ã€åŠæˆå“ã€‚
  ä¸è¦æ¯ä¸ªæƒ³æ³•éƒ½æ‰“ç£¨æˆå®Œæ•´çš„æ®µè½ã€‚é€Ÿåº¦å’Œæ•°é‡æ¯”ç²¾åº¦é‡è¦ã€‚
- å›å½’ç°å®ï¼šå‘æ•£ä¹‹åï¼Œå¸®åˆ›ä½œè€…æ”¶æ•›ã€‚
  ã€Œè¿™äº›æ–¹å‘ä¸­ï¼Œè€ƒè™‘åˆ°ä½ çš„å—ä¼—å’Œç›®æ ‡ï¼Œæœ€å€¼å¾—æ·±å…¥çš„å¯èƒ½æ˜¯â€¦â€¦å› ä¸ºâ€¦â€¦ã€
- æ“ä½œå·¥å…·æ—¶æ•¢äºå†’é™©ï¼šç”¨ generate_field_content ç”Ÿæˆå†…å®¹æ—¶ï¼Œ
  å¯ä»¥å°è¯•ä¸åŒäºå¸¸è§„çš„é£æ ¼å’Œè§’åº¦ï¼Œç»™åˆ›ä½œè€…ä¸€ä¸ªã€Œæ²¡æƒ³åˆ°è¿˜èƒ½è¿™æ ·ã€çš„æƒŠå–œã€‚
```

**å…³é”®è®¾è®¡ï¼š** æ¯ä¸ªæ¨¡å¼çš„ system_prompt åªè´Ÿè´£èº«ä»½æ®µå’Œè¡Œä¸ºåŸåˆ™ã€‚
å·¥å…·è§„åˆ™ã€æ¶ˆæ­§è§„åˆ™ã€å†…å®¹å—ç´¢å¼•ã€@ å¼•ç”¨çº¦å®šç­‰åŸºç¡€è®¾æ–½ç”±
`build_system_prompt` è‡ªåŠ¨æ‹¼æ¥ï¼Œä¸å—æ¨¡å¼å½±å“ã€‚æ‰€æœ‰æ¨¡å¼å…±äº«å®Œå…¨ç›¸åŒçš„å·¥å…·é›†ã€‚

### 3.4 AgentState æ‰©å±•

```python
class AgentState(TypedDict):
    messages: Annotated[list[BaseMessage], operator.add]
    project_id: str
    current_phase: str
    creator_profile: str
    mode: str               # æ–°å¢ï¼šå½“å‰æ¨¡å¼åï¼ˆå¦‚ "critic", "strategist"ï¼‰
    mode_prompt: str         # æ–°å¢ï¼šå½“å‰æ¨¡å¼çš„ system_promptï¼ˆèº«ä»½æ®µï¼‰
    memory_context: str      # æ–°å¢ï¼šå…¨é‡ MemoryItem æ‹¼æ¥ï¼ˆè®°å¿†å±‚ï¼‰
```

### 3.5 build_system_prompt ä¿®æ”¹

```python
def build_system_prompt(state: AgentState) -> str:
    mode_prompt = state.get("mode_prompt", "")
    memory_context = state.get("memory_context", "")

    # ---- èº«ä»½æ®µï¼šæ¥è‡ªæ¨¡å¼é…ç½® ----
    if mode_prompt:
        identity = mode_prompt
    else:
        identity = "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½å†…å®¹ç”Ÿäº§ Agentï¼Œå¸®åŠ©åˆ›ä½œè€…å®Œæˆä»æ„å›¾åˆ†æåˆ°å†…å®¹å‘å¸ƒçš„å…¨æµç¨‹ã€‚"

    # ---- è®°å¿†æ®µï¼šå…¨é‡æ³¨å…¥ ----
    memory_section = ""
    if memory_context:
        memory_section = f"""
## é¡¹ç›®è®°å¿†
ä»¥ä¸‹æ˜¯è·¨æ¨¡å¼ã€è·¨é˜¶æ®µç§¯ç´¯çš„å…³é”®ä¿¡æ¯ã€‚åšä»»ä½•æ“ä½œæ—¶è¯·å‚è€ƒè¿™äº›çº¦æŸå’Œåå¥½ï¼Œæ— éœ€å¤è¿°ã€‚

{memory_context}
"""

    # ---- åŸºç¡€è®¾æ–½æ®µï¼ˆä¸å˜ï¼‰----
    # è¾“å‡ºæ ¼å¼ã€èƒ½åŠ›å£°æ˜ã€åˆ›ä½œè€…ä¿¡æ¯ã€é˜¶æ®µçŠ¶æ€ã€å†…å®¹å—ç´¢å¼•ã€
    # æ„å›¾å¼•å¯¼ã€@ å¼•ç”¨çº¦å®šã€æ¶ˆæ­§è§„åˆ™ã€äº¤äº’è§„åˆ™
    # ...ï¼ˆç°æœ‰é€»è¾‘å®Œå…¨ä¿ç•™ï¼‰

    return f"""{identity}
...ï¼ˆåŸºç¡€è®¾æ–½æ®µï¼‰...
{memory_section}
...ï¼ˆå†…å®¹å—ç´¢å¼•ç­‰åŠ¨æ€æ®µï¼‰...
"""
```

### 3.6 API å±‚æ”¹åŠ¨

**stream_chat ç«¯ç‚¹æ ¸å¿ƒæµç¨‹ï¼š**

```python
@router.post("/stream")
async def stream_chat(request: ChatRequest, db):
    # 1. æŸ¥ AgentMode
    mode_obj = db.query(AgentMode).filter(AgentMode.name == request.mode).first()

    # 2. æŸ¥ MemoryItemï¼ˆå…¨é‡ï¼‰
    memories = db.query(MemoryItem).filter(
        MemoryItem.project_id == request.project_id
    ).order_by(MemoryItem.created_at).all()
    memory_context = "\n".join(f"- {m.content}" for m in memories) if memories else ""

    # 3. æ„å»º input_stateï¼ˆç»Ÿä¸€èµ° Agent Graphï¼Œä¸å†åˆ†æµï¼‰
    input_state = {
        "messages": [HumanMessage(content=augmented_message)],
        "project_id": request.project_id,
        "current_phase": current_phase,
        "creator_profile": creator_profile_str,
        "mode": request.mode or "assistant",
        "mode_prompt": mode_obj.system_prompt if mode_obj else "",
        "memory_context": memory_context,
    }

    # 4. thread_id æŒ‰æ¨¡å¼éš”ç¦»ï¼ˆæ¯ä¸ªæ¨¡å¼ç‹¬ç«‹å¯¹è¯çº¿ç¨‹ï¼‰
    thread_id = f"{request.project_id}:{request.mode or 'assistant'}"

    # 5. astream_eventsï¼ˆç°æœ‰é€»è¾‘ä¸å˜ï¼‰
    ...
```

**åˆ é™¤ `_handle_cocreation_stream` å‡½æ•°åŠå…¶åˆ†æµ `if` è¯­å¥ã€‚**

### 3.7 å¯¹è¯çº¿ç¨‹éš”ç¦»ç­–ç•¥

```
thread_id = "{project_id}:{mode}"

project_123:assistant   â†’ åŠ©æ‰‹æ¨¡å¼çš„å¯¹è¯å†å²ï¼ˆå« ToolMessageï¼‰
project_123:strategist  â†’ ç­–ç•¥é¡¾é—®æ¨¡å¼çš„å¯¹è¯å†å²
project_123:critic      â†’ å®¡ç¨¿äººæ¨¡å¼çš„å¯¹è¯å†å²
project_123:reader      â†’ ç›®æ ‡è¯»è€…æ¨¡å¼çš„å¯¹è¯å†å²
project_123:creative    â†’ åˆ›æ„ä¼™ä¼´æ¨¡å¼çš„å¯¹è¯å†å²
```

- åˆ‡æ¢æ¨¡å¼ä¸ä¸¢å¤±å½“å‰æ¨¡å¼çš„å¯¹è¯â€”â€”å›åˆ‡æ—¶ Checkpointer è‡ªåŠ¨æ¢å¤
- æ¨¡å¼é—´çš„çŸ¥è¯†ä¼ é€’ä¸é å¯¹è¯å†å²ï¼ˆé‚£æ˜¯ ToolMessage å™ªå£°ï¼‰ï¼Œé  Memory å±‚

---

## å››ã€Memory ç³»ç»Ÿ

### 4.1 MemoryItem æ•°æ®æ¨¡å‹

```python
# backend/core/models/memory_item.py

class MemoryItem(BaseModel):
    """é¡¹ç›®è®°å¿†æ¡ç›® â€” ä»å¯¹è¯ä¸­æç‚¼çš„å¯å¤ç”¨çŸ¥è¯†"""
    __tablename__ = "memory_items"

    project_id: str         # æ‰€å±é¡¹ç›®
    content: str            # è®°å¿†å†…å®¹ï¼ˆä¸€å¥è¯ï¼Œå¦‚"ç”¨æˆ·åå¥½å£è¯­åŒ–è¡¨è¾¾"ï¼‰
    source_mode: str        # æç‚¼æ¥æºæ¨¡å¼ï¼ˆå¦‚ "assistant"ï¼‰
    source_phase: str       # æç‚¼æ—¶æ‰€åœ¨é˜¶æ®µï¼ˆå¦‚ "intent"ï¼‰
    related_blocks: list    # JSONï¼Œç›¸å…³å†…å®¹å—ååˆ—è¡¨ï¼ˆå¦‚ ["åœºæ™¯åº“", "æ„å›¾åˆ†æ"]ï¼‰
    # created_at, updated_at ç»§æ‰¿è‡ª BaseModel
```

**ä¸è®¾ embedding å­—æ®µ** â€”â€” å…¨é‡æ³¨å…¥ä¸éœ€è¦å‘é‡æ£€ç´¢ã€‚
**ä¸è®¾åˆ†ç±»å­—æ®µ** â€”â€” ä¸ç¡¬ç¼–ç "å†³ç­–/åå¥½/åé¦ˆ"ç±»åˆ«ï¼Œè®© LLM è‡ªç”±æç‚¼ã€‚

### 4.2 è®°å¿†æç‚¼æµç¨‹

**è§¦å‘æ—¶æœºï¼š** æ¯æ¬¡ Agent å®Œæˆä¸€è½®å®Œæ•´çš„å¯¹è¯ï¼ˆagent_node â†’ ENDï¼‰åã€‚

**æç‚¼æ–¹å¼ï¼š** å–æœ¬è½®å¯¹è¯çš„ user + assistant æ¶ˆæ¯ï¼ˆè·³è¿‡ ToolMessageï¼‰ï¼Œ
ç”¨ä¸€æ¬¡ LLM è°ƒç”¨æå–å€¼å¾—é•¿æœŸè®°ä½çš„ä¿¡æ¯ã€‚

```python
# backend/core/memory_service.py

EXTRACT_PROMPT = """ä»¥ä¸‹æ˜¯ç”¨æˆ·å’Œ Agent åœ¨ã€Œ{mode}ã€æ¨¡å¼ä¸­çš„æœ€è¿‘ä¸€è½®å¯¹è¯ã€‚
è¯·æå–å€¼å¾—é•¿æœŸè®°ä½çš„ä¿¡æ¯â€”â€”ä»»ä½•å¯èƒ½å½±å“æœªæ¥å†…å®¹ç”Ÿäº§å†³ç­–çš„å†…å®¹ã€‚
åŒ…æ‹¬ä½†ä¸é™äºï¼šç”¨æˆ·è¡¨è¾¾çš„åå¥½ã€åšå‡ºçš„é€‰æ‹©ã€ç»™å‡ºçš„åé¦ˆã€æ˜ç¡®çš„è¦æ±‚ã€é‡è¦çš„ç»“è®ºã€‚
å¦‚æœæ²¡æœ‰å€¼å¾—è®°ä½çš„æ–°ä¿¡æ¯ï¼Œè¿”å›ç©ºæ•°ç»„ []ã€‚

å¯¹è¯å†…å®¹ï¼š
{conversation}

è¿”å› JSON æ•°ç»„ï¼Œæ¯é¡¹æ ¼å¼ï¼š
{{"content": "ä¸€å¥è¯æè¿°", "related_blocks": ["ç›¸å…³å†…å®¹å—åï¼Œæ²¡æœ‰åˆ™ä¸ºç©ºæ•°ç»„"]}}

åªè¾“å‡º JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚"""


async def extract_memories(
    project_id: str,
    mode: str,
    phase: str,
    messages: list[dict],  # [{"role": "user", "content": "..."}, ...]
) -> list[dict]:
    """ä»ä¸€è½®å¯¹è¯ä¸­æå– MemoryItem"""
    # è¿‡æ»¤å‡º user/assistant æ–‡æœ¬æ¶ˆæ¯
    conversation_parts = []
    for m in messages:
        if m["role"] in ("user", "assistant"):
            conversation_parts.append(f'[{m["role"]}] {m["content"][:500]}')

    if not conversation_parts:
        return []

    conversation = "\n\n".join(conversation_parts)
    prompt = EXTRACT_PROMPT.format(mode=mode, conversation=conversation)

    response = await llm_mini.ainvoke([HumanMessage(content=prompt)])
    # è§£æ JSON å¹¶è¿”å›
    ...
```

**å»é‡é€»è¾‘ï¼š** æ–°æç‚¼çš„è®°å¿†åœ¨å…¥åº“å‰ï¼Œå’Œå·²æœ‰è®°å¿†åšæ–‡æœ¬æ¯”å¯¹ï¼ˆç®€å•ç›¸ä¼¼åº¦æˆ– LLM åˆ¤æ–­ï¼‰ã€‚
å¦‚æœå·²æœ‰ç±»ä¼¼è®°å¿†ï¼Œæ›´æ–°è€Œéæ–°å¢ã€‚

### 4.3 è®°å¿†æ³¨å…¥æµç¨‹

```
æ¯æ¬¡ Agent è°ƒç”¨å‰ï¼ˆstream_chat ä¸­ï¼‰ï¼š
    â”‚
    â–¼
 db.query(MemoryItem)
    .filter(project_id == ...)
    .order_by(created_at)
    .all()
    â”‚
    â–¼
 æ‹¼æ¥ä¸ºæ–‡æœ¬ï¼š
 "- ç”¨æˆ·åå¥½å£è¯­åŒ–è¡¨è¾¾ï¼Œä¸è¦å­¦æœ¯è¯­æ°” (æ¥è‡ªåŠ©æ‰‹æ¨¡å¼/æ„å›¾é˜¶æ®µ)
  - å·²é€‰å®šæ–¹æ¡ˆB: 7æ¨¡å—ç»“æ„ (æ¥è‡ªæ•™ç»ƒæ¨¡å¼/å†…æ¶µè®¾è®¡é˜¶æ®µ)
  - ç¼–è¾‘å»ºè®®ç¬¬3èŠ‚éœ€è¦åŠ è¿‡æ¸¡æ®µ (æ¥è‡ªç¼–è¾‘æ¨¡å¼/å†…æ¶µè®¾è®¡é˜¶æ®µ)"
    â”‚
    â–¼
 ä¼ å…¥ AgentState.memory_context
    â”‚
    â–¼
 build_system_prompt æ‹¼å…¥ã€Œé¡¹ç›®è®°å¿†ã€æ®µ
```

### 4.4 è·¨æ¨¡å¼æŸ¥é˜…å·¥å…·ï¼ˆè¡¥å……æœºåˆ¶ï¼‰

æ–°å¢ Agent å·¥å…· `read_mode_history`ï¼Œç”¨äº LLM ä¸»åŠ¨æŸ¥é˜…å…¶ä»–æ¨¡å¼çš„å®Œæ•´å¯¹è¯ã€‚

```python
@tool
def read_mode_history(
    mode_name: str,
    limit: int = 10,
    *, config: Annotated[RunnableConfig, InjectedToolArg],
) -> str:
    """æŸ¥é˜…åˆ›ä½œè€…åœ¨å…¶ä»–æ¨¡å¼ä¸­çš„å¯¹è¯è®°å½•ã€‚

    å½“ä½ éœ€è¦æ›´å¤šä¸Šä¸‹æ–‡æ¥ç†è§£åˆ›ä½œè€…ä¹‹å‰çš„è®¨è®ºæ—¶ä½¿ç”¨ã€‚
    ä¾‹å¦‚ï¼šåˆ›ä½œè€…è¯´"æŒ‰ä¹‹å‰å’Œæ•™ç»ƒè®¨è®ºçš„æ¥"ï¼Œä½ å¯ä»¥æŸ¥é˜…æ•™ç»ƒæ¨¡å¼çš„å¯¹è¯ã€‚

    Args:
        mode_name: æ¨¡å¼åç§°ï¼Œå¦‚ "assistant"ã€"editor"ã€"coach"
        limit: è¿”å›æœ€è¿‘å‡ æ¡æ¶ˆæ¯ï¼Œé»˜è®¤10ï¼Œæœ€å¤§20
    """
```

è¿™æ˜¯ Pull æœºåˆ¶â€”â€”ç”¨äºç”¨æˆ·æ˜¾å¼æåˆ°å…¶ä»–æ¨¡å¼æ—¶çš„å…œåº•ã€‚
ä¸ Memory çš„ Push æœºåˆ¶äº’è¡¥ã€‚

---

## äº”ã€é‡Œç¨‹ç¢‘ä¸ TODO

### M1ï¼šæ¨¡å¼åˆ‡æ¢åŸºç¡€åŠŸèƒ½ï¼ˆæ¶ˆé™¤åˆ†æµï¼‰ âœ… å·²å®Œæˆ

**ç›®æ ‡ï¼š** æ‰€æœ‰æ¨¡å¼ç»Ÿä¸€èµ° Agent Graphï¼Œå…±äº«å·¥å…·å’Œä¸Šä¸‹æ–‡ã€‚
**å‰ç½®ä¾èµ–ï¼š** æ— ã€‚
**çŠ¶æ€ï¼š** å…¨éƒ¨å®Œæˆï¼Œ13/13 æµ‹è¯•é€šè¿‡ï¼ˆ2026-02-14ï¼‰ã€‚

| # | ä»»åŠ¡ | æ–‡ä»¶ | çŠ¶æ€ |
|---|------|------|------|
| M1-1 | åˆ›å»º `AgentMode` æ¨¡å‹ | `backend/core/models/agent_mode.py` | âœ… |
| M1-2 | å¯¼å‡º AgentMode | `backend/core/models/__init__.py` | âœ… |
| M1-3 | é¢„ç½®æ¨¡å¼æ•°æ® | `backend/scripts/init_db.py` | âœ… |
| M1-4 | æ‰©å±• AgentState | `backend/core/orchestrator.py` | âœ… |
| M1-5 | ä¿®æ”¹ build_system_prompt | `backend/core/orchestrator.py` | âœ… |
| M1-6 | å–æ¶ˆå…±åˆ›åˆ†æµ | `backend/api/agent.py` | âœ… |
| M1-7 | stream_chat ä¼ å…¥æ¨¡å¼ä¿¡æ¯ | `backend/api/agent.py` | âœ… |
| M1-8 | thread_id æŒ‰æ¨¡å¼éš”ç¦» | `backend/api/agent.py` | âœ… |
| M1-9 | æ¨¡å¼ç®¡ç† API | `backend/api/modes.py`ï¼ˆæ–°å»ºï¼‰ | âœ… |
| M1-10 | å‰ç«¯æ¨¡å¼é€‰æ‹©å™¨ | `frontend/components/agent-panel.tsx` | âœ… |
| M1-11 | éªŒè¯ï¼šæ‰€æœ‰æ¨¡å¼å¯è°ƒç”¨å·¥å…· | `backend/tests/test_memory_mode.py` | âœ… |

### M2ï¼šMemory ç³»ç»Ÿï¼ˆè·¨æ¨¡å¼çŸ¥è¯†ç§¯ç´¯ï¼‰ âœ… å·²å®Œæˆ

**ç›®æ ‡ï¼š** å¯¹è¯ä¸­çš„å…³é”®ä¿¡æ¯è‡ªåŠ¨æç‚¼ã€è·¨æ¨¡å¼å¯è§ã€‚
**å‰ç½®ä¾èµ–ï¼š** M1 å®Œæˆã€‚
**çŠ¶æ€ï¼š** å…¨éƒ¨å®Œæˆï¼Œ13/13 æµ‹è¯•é€šè¿‡ï¼ˆ2026-02-14ï¼‰ã€‚

| # | ä»»åŠ¡ | æ–‡ä»¶ | çŠ¶æ€ |
|---|------|------|------|
| M2-1 | åˆ›å»º `MemoryItem` æ¨¡å‹ | `backend/core/models/memory_item.py` | âœ… |
| M2-2 | å¯¼å‡º MemoryItem | `backend/core/models/__init__.py` | âœ… |
| M2-3 | åˆ›å»º memory_service | `backend/core/memory_service.py` | âœ… |
| M2-4 | å¯¹è¯ç»“æŸåè§¦å‘æç‚¼ | `backend/api/agent.py` | âœ… |
| M2-5 | stream_chat æ³¨å…¥è®°å¿† | `backend/api/agent.py` | âœ… |
| M2-6 | build_system_prompt æ‹¼å…¥è®°å¿†æ®µ | `backend/core/orchestrator.py` | âœ… |
| M2-7 | æ·»åŠ  read_mode_history å·¥å…· | `backend/core/agent_tools.py` | âœ… |
| M2-8 | æ³¨å†Œåˆ° AGENT_TOOLS | `backend/core/agent_tools.py` | âœ… |
| M2-9 | è®°å¿†å»é‡é€»è¾‘ | `backend/core/memory_service.py` | âœ… |
| M2-10 | éªŒè¯ï¼šè®°å¿†è·¨æ¨¡å¼å¯è§ | `backend/tests/test_memory_mode.py` | âœ… |

### M3ï¼šMemory ç®¡ç†èƒ½åŠ› âœ… å·²å®Œæˆ

**ç›®æ ‡ï¼š** è®°å¿†å¯æŸ¥çœ‹ã€å¯ç¼–è¾‘ã€å¯è·¨é¡¹ç›®ã€‚
**å‰ç½®ä¾èµ–ï¼š** M2 å®Œæˆã€‚
**çŠ¶æ€ï¼š** å…¨éƒ¨å®Œæˆï¼Œ26/26 æµ‹è¯•é€šè¿‡ï¼ˆå« M1+M2 å›å½’ï¼Œ2026-02-15ï¼‰ã€‚

| # | ä»»åŠ¡ | æ–‡ä»¶ | çŠ¶æ€ |
|---|------|------|------|
| M3-1 | Memory CRUD API | `backend/api/memories.py` | âœ… |
| M3-2 | å‰ç«¯è®°å¿†é¢æ¿ | `frontend/components/memory-panel.tsx` | âœ… |
| M3-3 | è®°å¿†è‡ªåŠ¨åˆå¹¶/é—å¿˜ | `backend/core/memory_service.py` | âœ… |
| M3-4 | LLM é¢„ç­›é€‰ | `backend/core/memory_service.py` | âœ… |
| M3-5 | è·¨é¡¹ç›®é€šç”¨è®°å¿† | æ¨¡å‹æ”¹åŠ¨ | âœ… |
| M3-6 | éªŒè¯ | `backend/tests/test_memory_m3.py` | âœ… |

---

## å…­ã€æ•°æ®æµå…¨æ™¯å›¾

```
                    ç”¨æˆ·åˆ‡æ¢åˆ°ã€Œå®¡ç¨¿äººã€æ¨¡å¼å¹¶å‘é€æ¶ˆæ¯
                              â”‚
                              â–¼
                   â”Œâ”€â”€ stream_chat() â”€â”€â”
                   â”‚                    â”‚
                   â”‚  â‘  æŸ¥ AgentMode   â”‚ â†’ mode_prompt = "ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„å®¡ç¨¿äºº..."
                   â”‚    name="critic"   â”‚
                   â”‚                    â”‚
                   â”‚  â‘¡ æŸ¥ MemoryItem  â”‚ â†’ memory_context = "- åå¥½å£è¯­åŒ–\n- æ–¹æ¡ˆB..."
                   â”‚    å…¨é‡            â”‚
                   â”‚                    â”‚
                   â”‚  â‘¢ æ„å»º AgentState â”‚
                   â”‚    mode="critic"   â”‚
                   â”‚    mode_prompt=... â”‚
                   â”‚    memory_context= â”‚
                   â”‚      ...           â”‚
                   â”‚                    â”‚
                   â”‚  â‘£ thread_id =    â”‚ â†’ "proj_123:critic"
                   â”‚    "{pid}:critic"  â”‚
                   â”‚                    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   â”Œâ”€â”€ agent_node() â”€â”€â”€â”
                   â”‚                    â”‚
                   â”‚  build_system_     â”‚
                   â”‚  prompt(state)     â”‚
                   â”‚                    â”‚
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                   â”‚  â”‚ å®¡ç¨¿äººèº«ä»½æ®µ â”‚  â”‚ â† mode_prompt
                   â”‚  â”‚ è¾“å‡ºæ ¼å¼     â”‚  â”‚ â† å›ºå®š
                   â”‚  â”‚ èƒ½åŠ›å£°æ˜     â”‚  â”‚ â† å›ºå®š
                   â”‚  â”‚ é¡¹ç›®è®°å¿†     â”‚  â”‚ â† memory_context
                   â”‚  â”‚ åˆ›ä½œè€…ä¿¡æ¯   â”‚  â”‚ â† creator_profile
                   â”‚  â”‚ å†…å®¹å—ç´¢å¼•   â”‚  â”‚ â† build_field_index()
                   â”‚  â”‚ é˜¶æ®µçŠ¶æ€     â”‚  â”‚ â† DB æŸ¥è¯¢
                   â”‚  â”‚ æ¶ˆæ­§è§„åˆ™     â”‚  â”‚ â† å›ºå®š
                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                   â”‚                    â”‚
                   â”‚  llm.bind_tools(   â”‚
                   â”‚    AGENT_TOOLS     â”‚ â† æ‰€æœ‰ 13 ä¸ªå·¥å…·ï¼ˆå« read_mode_historyï¼‰
                   â”‚  )                 â”‚
                   â”‚                    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    LLM ä»¥ã€Œå®¡ç¨¿äººã€èº«ä»½å›å¤
                    çŸ¥é“ç”¨æˆ·åå¥½å£è¯­åŒ–ï¼ˆæ¥è‡ªè®°å¿†å±‚ï¼‰
                    å¯ä»¥è°ƒå·¥å…·ä¿®æ”¹å†…å®¹ï¼ˆæ¥è‡ªå·¥å…·å±‚ï¼‰
                            â”‚
                            â–¼
                   â”Œâ”€â”€ å¯¹è¯ç»“æŸå â”€â”€â”€â”€â”€â”
                   â”‚                    â”‚
                   â”‚  extract_memories  â”‚ â†’ æç‚¼æœ¬è½®å¯¹è¯ä¸­çš„å…³é”®ä¿¡æ¯
                   â”‚  (llm_mini)        â”‚   "ç¼–è¾‘è®¤ä¸ºç¬¬3èŠ‚è¿‡æ¸¡ç”Ÿç¡¬"
                   â”‚                    â”‚
                   â”‚  â†’ MemoryItem å…¥åº“ â”‚ â†’ ä¸‹æ¬¡ä»»ä½•æ¨¡å¼éƒ½èƒ½çœ‹åˆ°
                   â”‚                    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€ä¸ç°æœ‰æ¶æ„çš„å…¼å®¹æ€§

| ç°æœ‰ç»„ä»¶ | å½±å“ | å¤„ç†æ–¹å¼ |
|---------|------|---------|
| `orchestrator.py` AgentState | æ–°å¢ 3 ä¸ªå­—æ®µ | TypedDict æ–°å¢å­—æ®µï¼ŒLangGraph å…¼å®¹ |
| `orchestrator.py` build_system_prompt | èº«ä»½æ®µæ”¹ä¸ºåŠ¨æ€ | mode_prompt æœ‰å€¼åˆ™ç”¨ï¼Œå¦åˆ™ç”¨é»˜è®¤ |
| `api/agent.py` stream_chat | åˆ é™¤å…±åˆ›åˆ†æµ | ç»Ÿä¸€èµ° Agent Graph |
| `api/agent.py` ChatRequest | mode å­—æ®µè¯­ä¹‰ä¸å˜ | ä» "assistant"\|"cocreation" æ‰©å±•ä¸ºä»»æ„æ¨¡å¼åï¼ˆassistant/strategist/critic/reader/creative/è‡ªå®šä¹‰ï¼‰ |
| `agent_tools.py` AGENT_TOOLS | æ–°å¢ 1 ä¸ªå·¥å…· | read_mode_history |
| Checkpointer (SqliteSaver) | thread_id æ ¼å¼å˜åŒ– | åŸ `{pid}:assistant` ä¸å˜ï¼Œæ–°æ¨¡å¼ç”¨ `{pid}:{mode}` |
| ChatMessage.metadata.mode | è¯­ä¹‰ä¸å˜ | ä» "assistant"\|"cocreation" æ‰©å±•ä¸ºä»»æ„æ¨¡å¼å |
| å‰ç«¯ agent-panel.tsx | UI æ”¹é€  | ç¡¬ç¼–ç æŒ‰é’®ç»„ â†’ åŠ¨æ€æ¨¡å¼é€‰æ‹©å™¨ |
| `_handle_cocreation_stream` | **åˆ é™¤** | è¢« Agent Graph ç»Ÿä¸€è·¯å¾„å–ä»£ |

### å‘åå…¼å®¹

- ç°æœ‰ `thread_id = "{pid}:assistant"` çš„ Checkpointer æ•°æ®ä¸ä¸¢å¤±ï¼ˆmode é»˜è®¤å€¼å°±æ˜¯ "assistant"ï¼‰
- ç°æœ‰ `ChatMessage` ä¸­ `metadata.mode = "cocreation"` çš„æ¶ˆæ¯ä»ç„¶å¯è¯»
- å¦‚æœç”¨æˆ·æœªé€‰æ¨¡å¼ï¼Œé»˜è®¤ä½¿ç”¨ "assistant"ï¼Œè¡Œä¸ºå’Œå½“å‰å®Œå…¨ä¸€è‡´

---

## å…«ã€è®¾è®¡å†³ç­–è®°å½•

| å†³ç­– | é€‰é¡¹ | é€‰æ‹© | ç†ç”± |
|------|------|------|------|
| æ¨¡å¼ prompt æ˜¯æ›¿æ¢è¿˜æ˜¯è¿½åŠ  | æ›¿æ¢èº«ä»½æ®µ / åœ¨å¼€å¤´è¿½åŠ  | **æ›¿æ¢èº«ä»½æ®µ** | ä¸¤ä¸ªèº«ä»½å£°æ˜ä¼šå†²çªï¼ŒLLM ä¼šå›°æƒ‘ |
| è®°å¿†æ£€ç´¢æ–¹å¼ | è¯­ä¹‰æ£€ç´¢ / LLM ç­›é€‰ / å…¨é‡æ³¨å…¥ | **å…¨é‡æ³¨å…¥** | é¡¹ç›®çº§è®°å¿†é‡ < 300 æ¡ï¼ŒLLM è‡ªèº«æ¨ç†åš"æ£€ç´¢"æ•ˆæœæœ€å¥½ |
| å¯¹è¯çº¿ç¨‹éš”ç¦» | å…±äº«å•çº¿ç¨‹ / æŒ‰æ¨¡å¼éš”ç¦» | **æŒ‰æ¨¡å¼éš”ç¦»** | é¿å… ToolMessage å™ªå£°è·¨æ¨¡å¼æ±¡æŸ“ |
| è·¨æ¨¡å¼ä¸Šä¸‹æ–‡ä¼ é€’ | åŸå§‹æˆªå– / LLM æ‘˜è¦ / Memory æç‚¼ | **Memory æç‚¼** | ä»å¯¹è¯ä¸­æå–å¯å¤ç”¨çŸ¥è¯†ï¼Œæ¯”åŸå§‹æˆªå–ä¿¡å™ªæ¯”é«˜ |
| è®°å¿†åˆ†ç±»æ–¹å¼ | ç¡¬ç¼–ç ç±»åˆ« / LLM è‡ªç”±æç‚¼ | **LLM è‡ªç”±æç‚¼** | é¿å…è¿‡æ‹Ÿåˆï¼Œè®© LLM åˆ¤æ–­ä»€ä¹ˆå€¼å¾—è®°ä½ |
| è®°å¿†å­˜å‚¨æ–¹å¼ | å¸¦ embedding çš„å‘é‡åº“ / çº¯å…³ç³»å‹ | **çº¯å…³ç³»å‹** | å…¨é‡æ³¨å…¥ä¸éœ€è¦å‘é‡æ£€ç´¢ï¼ŒSQLite å¤Ÿç”¨ |
| å…±åˆ›æ¨¡å¼å¤„ç† | ç‹¬ç«‹é€šé“ / ç»Ÿä¸€ Agent Graph | **ç»Ÿä¸€ Agent Graph** | æ¶ˆé™¤é€šé“åˆ†è£‚ï¼Œæ‰€æœ‰æ¨¡å¼å…±äº«å·¥å…·å’Œä¸Šä¸‹æ–‡ |
| é¢„ç½®æ¨¡å¼é€‰æ‹© | ä» Eval è§’è‰²æ¬è¿ / ä»åˆ›ä½œè€…è®¤çŸ¥éœ€æ±‚æ¨å¯¼ | **ä»è®¤çŸ¥éœ€æ±‚æ¨å¯¼** | Eval è§’è‰²ï¼ˆæ•™ç»ƒ/ç¼–è¾‘/ä¸“å®¶/æ¶ˆè´¹è€…/é”€å”®ï¼‰æ˜¯è¯„æµ‹è§†è§’ï¼Œä¸ç­‰äºåä½œå§¿æ€ã€‚5 ç§é¢„ç½®æ¨¡å¼å¯¹åº”åˆ›ä½œè€…åœ¨ç”Ÿäº§è¿‡ç¨‹ä¸­çš„ 5 ç§ä¸å¯çº¦ç®€çš„è®¤çŸ¥éœ€æ±‚ï¼šæ‰§è¡Œã€ç­–ç•¥ã€è´¨æ§ã€å—ä¼—è§†è§’ã€åˆ›æ„ |
