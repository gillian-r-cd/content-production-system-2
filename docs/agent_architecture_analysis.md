# Agent æ¶æ„æ„ŸçŸ¥èƒ½åŠ›æ’æŸ¥æŠ¥å‘Š

**æ’æŸ¥æ—¥æœŸ**: 2026-02-04

## ğŸ“‹ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šåœ¨çµæ´»æ¶æ„é¡¹ç›®ä¸­åˆ é™¤äº†"æ„å›¾åˆ†æ"é˜¶æ®µï¼Œä½† Agent ä»ç„¶åœ¨é—®æ„å›¾åˆ†æçš„é—®é¢˜ã€‚Agent ä¼¼ä¹ä¸èƒ½ç†è§£å½“å‰é¡¹ç›®çš„å®é™…å†…å®¹æ¶æ„ã€‚

---

## ğŸ” æ’æŸ¥ç»“æœ

### 1. Agent å½“å‰æ¶æ„æ„ŸçŸ¥èƒ½åŠ›ï¼šâŒ ä¸å…·å¤‡

| èƒ½åŠ›é¡¹ | å½“å‰çŠ¶æ€ | é—®é¢˜ |
|--------|----------|------|
| æ„ŸçŸ¥é¡¹ç›®çš„ `phase_order` | âŒ ä¸ä¼ é€’ | `content_agent.run()` æ²¡æœ‰ä¼ é€’ `phase_order`ï¼Œé»˜è®¤ä½¿ç”¨ç¡¬ç¼–ç çš„ `PROJECT_PHASES` |
| æ„ŸçŸ¥ ContentBlocks ç»“æ„ | âŒ å®Œå…¨ä¸å…·å¤‡ | Agent ä¸çŸ¥é“é¡¹ç›®æœ‰å“ªäº› ContentBlocks |
| æ„ŸçŸ¥å½“å‰æœ‰å“ªäº›å­—æ®µ | âŒ ä¸ä¸»åŠ¨è·å– | åªæœ‰é€šè¿‡ `@å¼•ç”¨` æ‰èƒ½è®¿é—®å­—æ®µå†…å®¹ |
| åŠ¨æ€ç†è§£å†…å®¹å±‚çº§ | âŒ ä¸å…·å¤‡ | Agent ä¸çŸ¥é“å­—æ®µä¹‹é—´çš„å±‚çº§å’Œä¾èµ–å…³ç³» |

### 2. Agent å¯è°ƒç”¨çš„å·¥å…·

```
backend/core/tools/
â”œâ”€â”€ deep_research.py     # æ¶ˆè´¹è€…è°ƒç ”
â”œâ”€â”€ evaluator.py         # å†…å®¹è¯„ä¼°
â”œâ”€â”€ field_generator.py   # å­—æ®µç”Ÿæˆ
â””â”€â”€ simulator.py         # æ¶ˆè´¹è€…æ¨¡æ‹Ÿ
```

**å·¥å…·æ¸…å•**:

| å·¥å…· | å‡½æ•° | åŠŸèƒ½ | æ˜¯å¦æœ‰æ¶æ„æ„ŸçŸ¥ |
|------|------|------|---------------|
| **æ·±åº¦è°ƒç ”** | `deep_research(query, intent, research_type)` | ä½¿ç”¨ Tavily Search API è¿›è¡Œæ·±åº¦è°ƒç ”ï¼ˆæ¶ˆè´¹è€…/é€šç”¨ï¼‰ | âŒ å¦ |
| **å­—æ®µç”Ÿæˆ** | `generate_field(field, context)` | æ ¹æ®æç¤ºè¯ç”Ÿæˆå­—æ®µå†…å®¹ | âŒ å¦ |
| **æµå¼ç”Ÿæˆ** | `generate_field_stream(field, context)` | æµå¼è¾“å‡ºå­—æ®µå†…å®¹ | âŒ å¦ |
| **å¹¶è¡Œç”Ÿæˆ** | `generate_fields_parallel(fields, context)` | æ‰¹é‡å¹¶è¡Œç”Ÿæˆå¤šä¸ªå­—æ®µ | âŒ å¦ |
| **æ¨¡æ‹Ÿæµ‹è¯•** | `run_simulation(content, personas, mode)` | æ¨¡æ‹Ÿç”¨æˆ·é˜…è¯»åé¦ˆ | âŒ å¦ |
| **å†…å®¹è¯„ä¼°** | `evaluate_project(project_id)` | è¯„ä¼°é¡¹ç›®æ•´ä½“è´¨é‡ | âš ï¸ ä»…é€šè¿‡ project_id é—´æ¥è®¿é—® |
| **ç« èŠ‚è¯„ä¼°** | `evaluate_section(content, criteria)` | è¯„ä¼°å•ä¸ªç« èŠ‚ | âŒ å¦ |

### 3. é—®é¢˜æ ¹æºåˆ†æ

#### 3.1 `phase_order` æ²¡æœ‰ä¼ é€’

**agent.py ç¬¬ 188 è¡Œ**:
```python
result = await content_agent.run(
    project_id=request.project_id,
    user_input=request.message,
    current_phase=current_phase,
    golden_context=project.golden_context or {},
    autonomy_settings=project.agent_autonomy or {},
    use_deep_research=project.use_deep_research,
    chat_history=chat_history,
    phase_status=project.phase_status or {},
    references=references,
    referenced_contents=referenced_contents,
)
# âŒ æ²¡æœ‰ä¼ é€’ phase_order=project.phase_order ï¼
```

**orchestrator.py ç¬¬ 1539 è¡Œï¼ˆrun æ–¹æ³•ï¼‰**:
```python
initial_state = {
    "project_id": project_id,
    "current_phase": current_phase,
    "phase_order": PROJECT_PHASES.copy(),  # âŒ ç¡¬ç¼–ç ï¼
    # ...
}
```

#### 3.2 æ„å›¾åˆ†æé˜¶æ®µç¡¬ç¼–ç åˆ¤æ–­

**orchestrator.py ç¬¬ 189-190 è¡Œ**:
```python
# ===== è§„åˆ™ 4: æ„å›¾åˆ†æé˜¶æ®µçš„é—®ç­”æµç¨‹ =====
if current_phase == "intent" and current_phase_status != "completed":
    return {**state, "route_target": "phase_current", ...}
```

é—®é¢˜ï¼šå³ä½¿é¡¹ç›®å·²ç»åˆ é™¤äº† intent é˜¶æ®µï¼Œè¿™ä¸ªåˆ¤æ–­ä»ç„¶ä¼šè§¦å‘ã€‚

#### 3.3 ContentBlocks å®Œå…¨ä¸åœ¨ Agent è§†é‡ä¸­

Agent é€šè¿‡ `orchestrator.py` è¿è¡Œï¼Œå®Œå…¨æ²¡æœ‰è®¿é—® `ContentBlock` è¡¨çš„é€»è¾‘ã€‚å®ƒåªçŸ¥é“ï¼š
- `PROJECT_PHASES` = å›ºå®šçš„ 8 ä¸ªé˜¶æ®µ
- `current_phase` = å½“å‰é˜¶æ®µåç§°
- `phase_status` = å„é˜¶æ®µçŠ¶æ€

**ä¸çŸ¥é“**ï¼š
- é¡¹ç›®å®é™…æœ‰å“ªäº›é˜¶æ®µï¼ˆphase_orderï¼‰
- é¡¹ç›®æœ‰å“ªäº›å­—æ®µ/å†…å®¹å—
- å­—æ®µä¹‹é—´çš„å±‚çº§å’Œä¾èµ–å…³ç³»
- æ˜¯å¦æ˜¯çµæ´»æ¶æ„é¡¹ç›®

---

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### çŸ­æœŸä¿®å¤ï¼ˆç«‹å³å¯åšï¼‰

1. **ä¼ é€’ `phase_order` åˆ° Agent**
   ```python
   # agent.py
   result = await content_agent.run(
       ...
       phase_order=project.phase_order,  # æ–°å¢
   )
   ```

2. **ä¿®æ”¹ orchestrator ä½¿ç”¨åŠ¨æ€ phase_order**
   ```python
   # orchestrator.py run()
   initial_state = {
       "phase_order": phase_order if phase_order else PROJECT_PHASES.copy(),
       # ...
   }
   ```

3. **ä¿®å¤æ„å›¾åˆ†æç¡¬ç¼–ç åˆ¤æ–­**
   ```python
   # æ”¹ä¸ºæ£€æŸ¥ phase_order æ˜¯å¦åŒ…å« intent
   phase_order = state.get("phase_order", PROJECT_PHASES)
   if "intent" in phase_order and current_phase == "intent" and current_phase_status != "completed":
       return {**state, "route_target": "phase_current", ...}
   ```

### ä¸­æœŸä¿®å¤ï¼ˆæ¶æ„å¢å¼ºï¼‰

4. **æ–°å¢"å†…å®¹æ¶æ„æ„ŸçŸ¥å·¥å…·"**
   ```python
   # backend/core/tools/architecture_reader.py
   async def get_project_architecture(project_id: str) -> dict:
       """è·å–é¡¹ç›®çš„å®Œæ•´å†…å®¹æ¶æ„"""
       return {
           "phases": [...],           # é˜¶æ®µåˆ—è¡¨
           "content_blocks": [...],   # å†…å®¹å—æ ‘
           "fields": [...],           # å­—æ®µåˆ—è¡¨åŠçŠ¶æ€
           "dependencies": {...},     # ä¾èµ–å…³ç³»å›¾
       }
   
   async def get_field_by_name(project_id: str, field_name: str) -> dict:
       """æ ¹æ®åç§°è·å–å­—æ®µ"""
       ...
   
   async def get_fields_in_phase(project_id: str, phase: str) -> List[dict]:
       """è·å–æŸé˜¶æ®µçš„æ‰€æœ‰å­—æ®µ"""
       ...
   ```

5. **åœ¨ route_intent ä¸­æ³¨å…¥æ¶æ„ä¿¡æ¯**
   - è®© LLM çŸ¥é“å½“å‰é¡¹ç›®æœ‰å“ªäº›é˜¶æ®µå’Œå­—æ®µ
   - æ™ºèƒ½åˆ¤æ–­ç”¨æˆ·æ„å›¾åº”è¯¥è·¯ç”±åˆ°å“ªä¸ªé˜¶æ®µ/å­—æ®µ

### é•¿æœŸä¿®å¤ï¼ˆAgent é‡æ„ï¼‰

6. **ReAct æ¨¡å¼çš„ Agent**
   - è®© Agent è‡ªä¸»å†³å®šæ˜¯å¦éœ€è¦è¯»å–æ¶æ„
   - è®© Agent è‡ªä¸»è°ƒç”¨å·¥å…·è€Œä¸æ˜¯è¢«è·¯ç”±

7. **å°†å†…å®¹æ¶æ„ä½œä¸º Agent çš„"è®°å¿†"**
   - æ¯æ¬¡å¯¹è¯å¼€å§‹æ—¶åŠ è½½é¡¹ç›®æ¶æ„
   - åœ¨ System Prompt ä¸­åŒ…å«æ¶æ„æ‘˜è¦

---

## ğŸ“Š å½“å‰ Agent èŠ‚ç‚¹ä¸å·¥å…·æ˜ å°„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        route_intent                              â”‚
â”‚  (æ„å›¾åˆ†ç±»ï¼šmodify/query/generate/advance_phase/chat/...)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ phase_current â”‚   â”‚   modify      â”‚   â”‚    query      â”‚
â”‚ (é˜¶æ®µèŠ‚ç‚¹)    â”‚   â”‚   (ä¿®æ”¹å­—æ®µ)  â”‚   â”‚   (æŸ¥è¯¢å­—æ®µ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µèŠ‚ç‚¹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ intent_analysis_node  â†’  æ— å·¥å…·è°ƒç”¨                   â”‚
â”‚ research_node         â†’  deep_research                 â”‚
â”‚ design_inner_node     â†’  æ— å·¥å…·è°ƒç”¨                   â”‚
â”‚ produce_inner_node    â†’  generate_field               â”‚
â”‚ design_outer_node     â†’  æ— å·¥å…·è°ƒç”¨                   â”‚
â”‚ produce_outer_node    â†’  generate_field               â”‚
â”‚ simulate_node         â†’  run_simulation               â”‚
â”‚ evaluate_node         â†’  evaluate_project             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… å»ºè®®æ‰§è¡Œé¡ºåº

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | å¤æ‚åº¦ | é¢„è®¡æ—¶é—´ |
|--------|------|--------|----------|
| P0 | ä¼ é€’ phase_order åˆ° Agent | ä½ | 15 åˆ†é’Ÿ |
| P0 | ä¿®å¤æ„å›¾åˆ†æç¡¬ç¼–ç åˆ¤æ–­ | ä½ | 15 åˆ†é’Ÿ |
| P1 | åˆ›å»º architecture_reader å·¥å…· | ä¸­ | 2 å°æ—¶ |
| P1 | åœ¨ route_intent ä¸­æ³¨å…¥æ¶æ„ä¿¡æ¯ | ä¸­ | 1 å°æ—¶ |
| P2 | Agent é‡æ„ä¸º ReAct æ¨¡å¼ | é«˜ | 1-2 å¤© |

---

## ğŸ§ª æµ‹è¯• Benchmark

### æµ‹è¯•ç”¨ä¾‹ 1ï¼šæ—  intent é˜¶æ®µçš„é¡¹ç›®
| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 1 | åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œåˆ é™¤ intent é˜¶æ®µï¼ˆåªä¿ç•™ research å¼€å§‹ï¼‰ | é¡¹ç›®ä¿å­˜æˆåŠŸ |
| 2 | è¾“å…¥"å¼€å§‹" | Agent åº”ç›´æ¥è¿›å…¥ research é˜¶æ®µï¼Œä¸é—®æ„å›¾åˆ†æé—®é¢˜ |
| 3 | è¾“å…¥"å¼€å§‹æ¶ˆè´¹è€…è°ƒç ”" | Agent å¼€å§‹æ‰§è¡Œæ¶ˆè´¹è€…è°ƒç ” |

### æµ‹è¯•ç”¨ä¾‹ 2ï¼šä¼ ç»Ÿé¡¹ç›®çš„é˜¶æ®µæ„ŸçŸ¥
| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 1 | æ‰“å¼€ä¼ ç»Ÿé¡¹ç›®ï¼ˆå« intent é˜¶æ®µï¼‰ | æ­£å¸¸åŠ è½½ |
| 2 | è¾“å…¥"å¼€å§‹" | Agent è¿›å…¥æ„å›¾åˆ†æï¼Œé—®ç¬¬ä¸€ä¸ªé—®é¢˜ |
| 3 | å®Œæˆæ„å›¾åˆ†æåè¾“å…¥"ç»§ç»­" | Agent è¿›å…¥ä¸‹ä¸€é˜¶æ®µ |

### æµ‹è¯•ç”¨ä¾‹ 3ï¼šAgent æ¶æ„æ„ŸçŸ¥èƒ½åŠ›
| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 1 | é—®"å½“å‰é¡¹ç›®æœ‰å“ªäº›é˜¶æ®µï¼Ÿ" | Agent èƒ½æ­£ç¡®åˆ—å‡º phase_order |
| 2 | é—®"æ„å›¾åˆ†æé˜¶æ®µæœ‰ä»€ä¹ˆå­—æ®µï¼Ÿ" | Agent èƒ½åˆ—å‡ºè¯¥é˜¶æ®µçš„å­—æ®µ |
| 3 | é—®"æ¶ˆè´¹è€…è°ƒç ”æŠ¥å‘Šçš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ" | Agent èƒ½è¯»å–å¹¶æ€»ç»“è¯¥å­—æ®µå†…å®¹ |

---

## ğŸ¯ ç»“è®º

**æ ¸å¿ƒé—®é¢˜**ï¼šAgent ç›®å‰æ˜¯ä¸€ä¸ª"ç›²äºº"ï¼Œå®ƒä¸çŸ¥é“é¡¹ç›®çš„å®é™…ç»“æ„ï¼Œåªä¼šæŒ‰ç…§ç¡¬ç¼–ç çš„ 8 é˜¶æ®µæµç¨‹æ‰§è¡Œã€‚

**å·²å®Œæˆä¿®å¤**ï¼š
1. âœ… ä¼ é€’ `phase_order` è®© Agent çŸ¥é“é¡¹ç›®æœ‰å“ªäº›é˜¶æ®µ
2. âœ… åŠ¨æ€åˆ¤æ–­å½“å‰é˜¶æ®µï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç  `intent`

**å¾…å®Œæˆ**ï¼š
1. â³ åˆ›å»º `architecture_reader` å·¥å…·ï¼Œè®© Agent èƒ½ä¸»åŠ¨æŸ¥è¯¢é¡¹ç›®ç»“æ„
2. â³ åœ¨ `route_intent` ä¸­æ³¨å…¥æ¶æ„ä¿¡æ¯ï¼Œè®© LLM æ„å›¾åˆ†ç±»æ›´æ™ºèƒ½
