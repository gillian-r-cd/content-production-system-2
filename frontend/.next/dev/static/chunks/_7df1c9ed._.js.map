{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/layout/workspace-layout.tsx"],"sourcesContent":["// frontend/components/layout/workspace-layout.tsx\r\n// 功能: 工作台三栏布局\r\n// 主要组件: WorkspaceLayout\r\n\r\n\"use client\";\r\n\r\nimport { ReactNode } from \"react\";\r\n\r\ninterface WorkspaceLayoutProps {\r\n  leftPanel: ReactNode;\r\n  centerPanel: ReactNode;\r\n  rightPanel: ReactNode;\r\n}\r\n\r\nexport function WorkspaceLayout({\r\n  leftPanel,\r\n  centerPanel,\r\n  rightPanel,\r\n}: WorkspaceLayoutProps) {\r\n  return (\r\n    <div className=\"flex h-screen bg-surface-0\">\r\n      {/* 左栏：项目进度 */}\r\n      <aside className=\"w-64 flex-shrink-0 border-r border-surface-3 bg-surface-1 overflow-y-auto\">\r\n        {leftPanel}\r\n      </aside>\r\n\r\n      {/* 中栏：内容展示区 */}\r\n      <main className=\"flex-1 overflow-y-auto bg-surface-0\">\r\n        {centerPanel}\r\n      </main>\r\n\r\n      {/* 右栏：AI Agent */}\r\n      <aside className=\"w-96 flex-shrink-0 border-l border-surface-3 bg-surface-1 flex flex-col\">\r\n        {rightPanel}\r\n      </aside>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAAA,kDAAkD;AAClD,cAAc;AACd,wBAAwB;AAExB;;AAUO,SAAS,gBAAgB,EAC9B,SAAS,EACT,WAAW,EACX,UAAU,EACW;IACrB,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAM,WAAU;0BACd;;;;;;0BAIH,6LAAC;gBAAK,WAAU;0BACb;;;;;;0BAIH,6LAAC;gBAAM,WAAU;0BACd;;;;;;;;;;;;AAIT;KAvBgB"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/lib/utils.ts"],"sourcesContent":["// frontend/lib/utils.ts\r\n// 功能: 通用工具函数\r\n// 主要函数: cn, formatDate\r\n\r\nimport { clsx, type ClassValue } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\n/**\r\n * 合并 Tailwind 类名\r\n */\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n\r\n/**\r\n * 格式化日期\r\n */\r\nexport function formatDate(dateString: string): string {\r\n  if (!dateString) return \"\";\r\n  const date = new Date(dateString);\r\n  return date.toLocaleString(\"zh-CN\", {\r\n    year: \"numeric\",\r\n    month: \"2-digit\",\r\n    day: \"2-digit\",\r\n    hour: \"2-digit\",\r\n    minute: \"2-digit\",\r\n  });\r\n}\r\n\r\n/**\r\n * 阶段名称映射\r\n */\r\nexport const PHASE_NAMES: Record<string, string> = {\r\n  intent: \"意图分析\",\r\n  research: \"消费者调研\",\r\n  design_inner: \"内涵设计\",\r\n  produce_inner: \"内涵生产\",\r\n  design_outer: \"外延设计\",\r\n  produce_outer: \"外延生产\",\r\n  simulate: \"消费者模拟\",\r\n  evaluate: \"评估\",\r\n};\r\n\r\n/**\r\n * 阶段状态映射\r\n */\r\nexport const PHASE_STATUS: Record<string, { label: string; color: string }> = {\r\n  pending: { label: \"未开始\", color: \"text-zinc-500\" },\r\n  in_progress: { label: \"进行中\", color: \"text-yellow-500\" },\r\n  completed: { label: \"已完成\", color: \"text-green-500\" },\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA,wBAAwB;AACxB,aAAa;AACb,uBAAuB;AAEvB;AACA;;;AAKO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACtB;AAKO,SAAS,WAAW,UAAkB;IAC3C,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,OAAO,IAAI,KAAK;IACtB,OAAO,KAAK,cAAc,CAAC,SAAS;QAClC,MAAM;QACN,OAAO;QACP,KAAK;QACL,MAAM;QACN,QAAQ;IACV;AACF;AAKO,MAAM,cAAsC;IACjD,QAAQ;IACR,UAAU;IACV,cAAc;IACd,eAAe;IACf,cAAc;IACd,eAAe;IACf,UAAU;IACV,UAAU;AACZ;AAKO,MAAM,eAAiE;IAC5E,SAAS;QAAE,OAAO;QAAO,OAAO;IAAgB;IAChD,aAAa;QAAE,OAAO;QAAO,OAAO;IAAkB;IACtD,WAAW;QAAE,OAAO;QAAO,OAAO;IAAiB;AACrD"}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/progress-panel.tsx"],"sourcesContent":["// frontend/components/progress-panel.tsx\r\n// 功能: 左栏项目进度面板，支持中间4阶段拖拽排序\r\n// 主要组件: ProgressPanel\r\n// 固定阶段: 意图分析、消费者调研在顶部；消费者模拟、评估在底部\r\n// 可拖拽阶段: 内涵设计、内涵生产、外延设计、外延生产\r\n\r\n\"use client\";\r\n\r\nimport { useState, useRef } from \"react\";\r\nimport { cn, PHASE_NAMES, PHASE_STATUS } from \"@/lib/utils\";\r\nimport type { Project } from \"@/lib/api\";\r\n\r\n// 固定阶段定义\r\nconst FIXED_TOP_PHASES = [\"intent\", \"research\"];\r\nconst DRAGGABLE_PHASES = [\"design_inner\", \"produce_inner\", \"design_outer\", \"produce_outer\"];\r\nconst FIXED_BOTTOM_PHASES = [\"simulate\", \"evaluate\"];\r\n\r\ninterface ProgressPanelProps {\r\n  project: Project | null;\r\n  onPhaseClick?: (phase: string) => void;\r\n  onPhaseReorder?: (phases: string[]) => void;\r\n}\r\n\r\nexport function ProgressPanel({\r\n  project,\r\n  onPhaseClick,\r\n  onPhaseReorder,\r\n}: ProgressPanelProps) {\r\n  const allPhases = project?.phase_order || [];\r\n  const phaseStatus = project?.phase_status || {};\r\n  const currentPhase = project?.current_phase || \"intent\";\r\n  \r\n  // 分离固定和可拖拽阶段\r\n  const topPhases = allPhases.filter(p => FIXED_TOP_PHASES.includes(p));\r\n  const middlePhases = allPhases.filter(p => DRAGGABLE_PHASES.includes(p));\r\n  const bottomPhases = allPhases.filter(p => FIXED_BOTTOM_PHASES.includes(p));\r\n  \r\n  // 拖拽状态\r\n  const [draggedPhase, setDraggedPhase] = useState<string | null>(null);\r\n  const [dragOverPhase, setDragOverPhase] = useState<string | null>(null);\r\n  const dragCounter = useRef(0);\r\n\r\n  const handleDragStart = (e: React.DragEvent, phase: string) => {\r\n    setDraggedPhase(phase);\r\n    e.dataTransfer.effectAllowed = \"move\";\r\n    e.dataTransfer.setData(\"text/plain\", phase);\r\n  };\r\n\r\n  const handleDragEnd = () => {\r\n    setDraggedPhase(null);\r\n    setDragOverPhase(null);\r\n    dragCounter.current = 0;\r\n  };\r\n\r\n  const handleDragEnter = (e: React.DragEvent, phase: string) => {\r\n    e.preventDefault();\r\n    dragCounter.current++;\r\n    if (DRAGGABLE_PHASES.includes(phase)) {\r\n      setDragOverPhase(phase);\r\n    }\r\n  };\r\n\r\n  const handleDragLeave = () => {\r\n    dragCounter.current--;\r\n    if (dragCounter.current === 0) {\r\n      setDragOverPhase(null);\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent, targetPhase: string) => {\r\n    e.preventDefault();\r\n    \r\n    if (!draggedPhase || draggedPhase === targetPhase) {\r\n      handleDragEnd();\r\n      return;\r\n    }\r\n    \r\n    // 重新排序中间阶段\r\n    const newMiddle = [...middlePhases];\r\n    const dragIdx = newMiddle.indexOf(draggedPhase);\r\n    const dropIdx = newMiddle.indexOf(targetPhase);\r\n    \r\n    if (dragIdx !== -1 && dropIdx !== -1) {\r\n      newMiddle.splice(dragIdx, 1);\r\n      newMiddle.splice(dropIdx, 0, draggedPhase);\r\n      \r\n      // 重建完整顺序\r\n      const newOrder = [...topPhases, ...newMiddle, ...bottomPhases];\r\n      onPhaseReorder?.(newOrder);\r\n    }\r\n    \r\n    handleDragEnd();\r\n  };\r\n\r\n  const renderPhaseItem = (phase: string, isDraggable: boolean) => {\r\n    const status = phaseStatus[phase] || \"pending\";\r\n    const statusInfo = PHASE_STATUS[status] || PHASE_STATUS.pending;\r\n    const isCurrent = phase === currentPhase;\r\n    const isDragging = draggedPhase === phase;\r\n    const isDragOver = dragOverPhase === phase;\r\n    \r\n    return (\r\n      <div\r\n        key={phase}\r\n        draggable={isDraggable}\r\n        onDragStart={isDraggable ? (e) => handleDragStart(e, phase) : undefined}\r\n        onDragEnd={isDraggable ? handleDragEnd : undefined}\r\n        onDragEnter={isDraggable ? (e) => handleDragEnter(e, phase) : undefined}\r\n        onDragLeave={isDraggable ? handleDragLeave : undefined}\r\n        onDragOver={isDraggable ? handleDragOver : undefined}\r\n        onDrop={isDraggable ? (e) => handleDrop(e, phase) : undefined}\r\n        className={cn(\r\n          \"relative transition-all duration-150\",\r\n          isDragging && \"opacity-50\",\r\n          isDragOver && \"before:absolute before:inset-x-0 before:-top-1 before:h-0.5 before:bg-brand-500\"\r\n        )}\r\n      >\r\n        <button\r\n          onClick={() => onPhaseClick?.(phase)}\r\n          className={cn(\r\n            \"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors\",\r\n            isCurrent\r\n              ? \"bg-brand-600/20 text-brand-400\"\r\n              : \"hover:bg-surface-3 text-zinc-300\",\r\n            isDraggable && \"cursor-grab active:cursor-grabbing\"\r\n          )}\r\n        >\r\n          {/* 拖拽手柄 */}\r\n          {isDraggable && (\r\n            <span className=\"text-zinc-600 text-xs select-none\">⋮⋮</span>\r\n          )}\r\n          \r\n          {/* 状态指示器 */}\r\n          <div\r\n            className={cn(\r\n              \"w-2 h-2 rounded-full flex-shrink-0\",\r\n              status === \"completed\" && \"bg-green-500\",\r\n              status === \"in_progress\" && \"bg-yellow-500\",\r\n              status === \"pending\" && \"bg-zinc-600\"\r\n            )}\r\n          />\r\n          \r\n          {/* 阶段名称 */}\r\n          <span className=\"flex-1 text-sm\">\r\n            {PHASE_NAMES[phase] || phase}\r\n          </span>\r\n          \r\n          {/* 状态标签 */}\r\n          <span className={cn(\"text-xs\", statusInfo.color)}>\r\n            {statusInfo.label}\r\n          </span>\r\n        </button>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4\">\r\n      {/* 项目信息 */}\r\n      <div className=\"mb-6\">\r\n        <h2 className=\"text-lg font-semibold text-zinc-100\">\r\n          {project?.name || \"未选择项目\"}\r\n        </h2>\r\n        {project && (\r\n          <p className=\"text-sm text-zinc-500 mt-1\">\r\n            版本 {project.version}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* 流程进度 */}\r\n      <div className=\"space-y-1\">\r\n        <h3 className=\"text-xs font-medium text-zinc-500 uppercase tracking-wider mb-3\">\r\n          流程进度\r\n        </h3>\r\n        \r\n        {/* 顶部固定阶段 */}\r\n        {topPhases.map(phase => renderPhaseItem(phase, false))}\r\n        \r\n        {/* 可拖拽的中间阶段 */}\r\n        {middlePhases.length > 0 && (\r\n          <div className=\"py-1\">\r\n            <div className=\"text-xs text-zinc-600 px-3 mb-1 flex items-center gap-1\">\r\n              <span>↕</span>\r\n              <span>可拖拽调整顺序</span>\r\n            </div>\r\n            {middlePhases.map(phase => renderPhaseItem(phase, true))}\r\n          </div>\r\n        )}\r\n        \r\n        {/* 底部固定阶段 */}\r\n        {bottomPhases.map(phase => renderPhaseItem(phase, false))}\r\n      </div>\r\n\r\n      {/* 分隔线 */}\r\n      <div className=\"my-6 border-t border-surface-3\" />\r\n\r\n      {/* 快捷操作 */}\r\n      <div className=\"space-y-2\">\r\n        <h3 className=\"text-xs font-medium text-zinc-500 uppercase tracking-wider mb-3\">\r\n          快捷操作\r\n        </h3>\r\n        \r\n        <button className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\">\r\n          + 新建版本\r\n        </button>\r\n        \r\n        <button className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\">\r\n          查看历史版本\r\n        </button>\r\n        \r\n        <button className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\">\r\n          导出内容\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAQA;AACA;;;AATA,yCAAyC;AACzC,2BAA2B;AAC3B,sBAAsB;AACtB,kCAAkC;AAClC,6BAA6B;AAE7B;;;AAMA,SAAS;AACT,MAAM,mBAAmB;IAAC;IAAU;CAAW;AAC/C,MAAM,mBAAmB;IAAC;IAAgB;IAAiB;IAAgB;CAAgB;AAC3F,MAAM,sBAAsB;IAAC;IAAY;CAAW;AAQ7C,SAAS,cAAc,EAC5B,OAAO,EACP,YAAY,EACZ,cAAc,EACK;;IACnB,MAAM,YAAY,SAAS,eAAe,EAAE;IAC5C,MAAM,cAAc,SAAS,gBAAgB,CAAC;IAC9C,MAAM,eAAe,SAAS,iBAAiB;IAE/C,aAAa;IACb,MAAM,YAAY,UAAU,MAAM,CAAC,CAAA,IAAK,iBAAiB,QAAQ,CAAC;IAClE,MAAM,eAAe,UAAU,MAAM,CAAC,CAAA,IAAK,iBAAiB,QAAQ,CAAC;IACrE,MAAM,eAAe,UAAU,MAAM,CAAC,CAAA,IAAK,oBAAoB,QAAQ,CAAC;IAExE,OAAO;IACP,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAgB;IAChE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAgB;IAClE,MAAM,cAAc,IAAA,uKAAM,EAAC;IAE3B,MAAM,kBAAkB,CAAC,GAAoB;QAC3C,gBAAgB;QAChB,EAAE,YAAY,CAAC,aAAa,GAAG;QAC/B,EAAE,YAAY,CAAC,OAAO,CAAC,cAAc;IACvC;IAEA,MAAM,gBAAgB;QACpB,gBAAgB;QAChB,iBAAiB;QACjB,YAAY,OAAO,GAAG;IACxB;IAEA,MAAM,kBAAkB,CAAC,GAAoB;QAC3C,EAAE,cAAc;QAChB,YAAY,OAAO;QACnB,IAAI,iBAAiB,QAAQ,CAAC,QAAQ;YACpC,iBAAiB;QACnB;IACF;IAEA,MAAM,kBAAkB;QACtB,YAAY,OAAO;QACnB,IAAI,YAAY,OAAO,KAAK,GAAG;YAC7B,iBAAiB;QACnB;IACF;IAEA,MAAM,iBAAiB,CAAC;QACtB,EAAE,cAAc;IAClB;IAEA,MAAM,aAAa,CAAC,GAAoB;QACtC,EAAE,cAAc;QAEhB,IAAI,CAAC,gBAAgB,iBAAiB,aAAa;YACjD;YACA;QACF;QAEA,WAAW;QACX,MAAM,YAAY;eAAI;SAAa;QACnC,MAAM,UAAU,UAAU,OAAO,CAAC;QAClC,MAAM,UAAU,UAAU,OAAO,CAAC;QAElC,IAAI,YAAY,CAAC,KAAK,YAAY,CAAC,GAAG;YACpC,UAAU,MAAM,CAAC,SAAS;YAC1B,UAAU,MAAM,CAAC,SAAS,GAAG;YAE7B,SAAS;YACT,MAAM,WAAW;mBAAI;mBAAc;mBAAc;aAAa;YAC9D,iBAAiB;QACnB;QAEA;IACF;IAEA,MAAM,kBAAkB,CAAC,OAAe;QACtC,MAAM,SAAS,WAAW,CAAC,MAAM,IAAI;QACrC,MAAM,aAAa,+HAAY,CAAC,OAAO,IAAI,+HAAY,CAAC,OAAO;QAC/D,MAAM,YAAY,UAAU;QAC5B,MAAM,aAAa,iBAAiB;QACpC,MAAM,aAAa,kBAAkB;QAErC,qBACE,6LAAC;YAEC,WAAW;YACX,aAAa,cAAc,CAAC,IAAM,gBAAgB,GAAG,SAAS;YAC9D,WAAW,cAAc,gBAAgB;YACzC,aAAa,cAAc,CAAC,IAAM,gBAAgB,GAAG,SAAS;YAC9D,aAAa,cAAc,kBAAkB;YAC7C,YAAY,cAAc,iBAAiB;YAC3C,QAAQ,cAAc,CAAC,IAAM,WAAW,GAAG,SAAS;YACpD,WAAW,IAAA,qHAAE,EACX,wCACA,cAAc,cACd,cAAc;sBAGhB,cAAA,6LAAC;gBACC,SAAS,IAAM,eAAe;gBAC9B,WAAW,IAAA,qHAAE,EACX,mFACA,YACI,mCACA,oCACJ,eAAe;;oBAIhB,6BACC,6LAAC;wBAAK,WAAU;kCAAoC;;;;;;kCAItD,6LAAC;wBACC,WAAW,IAAA,qHAAE,EACX,sCACA,WAAW,eAAe,gBAC1B,WAAW,iBAAiB,iBAC5B,WAAW,aAAa;;;;;;kCAK5B,6LAAC;wBAAK,WAAU;kCACb,8HAAW,CAAC,MAAM,IAAI;;;;;;kCAIzB,6LAAC;wBAAK,WAAW,IAAA,qHAAE,EAAC,WAAW,WAAW,KAAK;kCAC5C,WAAW,KAAK;;;;;;;;;;;;WA9ChB;;;;;IAmDX;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCACX,SAAS,QAAQ;;;;;;oBAEnB,yBACC,6LAAC;wBAAE,WAAU;;4BAA6B;4BACpC,QAAQ,OAAO;;;;;;;;;;;;;0BAMzB,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAAkE;;;;;;oBAK/E,UAAU,GAAG,CAAC,CAAA,QAAS,gBAAgB,OAAO;oBAG9C,aAAa,MAAM,GAAG,mBACrB,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;kDAAK;;;;;;kDACN,6LAAC;kDAAK;;;;;;;;;;;;4BAEP,aAAa,GAAG,CAAC,CAAA,QAAS,gBAAgB,OAAO;;;;;;;oBAKrD,aAAa,GAAG,CAAC,CAAA,QAAS,gBAAgB,OAAO;;;;;;;0BAIpD,6LAAC;gBAAI,WAAU;;;;;;0BAGf,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAAkE;;;;;;kCAIhF,6LAAC;wBAAO,WAAU;kCAAuH;;;;;;kCAIzI,6LAAC;wBAAO,WAAU;kCAAuH;;;;;;kCAIzI,6LAAC;wBAAO,WAAU;kCAAuH;;;;;;;;;;;;;;;;;;AAMjJ;GAtMgB;KAAA"}},
    {"offset": {"line": 428, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/content-panel.tsx"],"sourcesContent":["// frontend/components/content-panel.tsx\r\n// 功能: 中栏内容展示面板\r\n// 主要组件: ContentPanel\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { PHASE_NAMES } from \"@/lib/utils\";\r\nimport type { Field } from \"@/lib/api\";\r\n\r\ninterface ContentPanelProps {\r\n  projectId: string | null;\r\n  currentPhase: string;\r\n  fields: Field[];\r\n  onFieldUpdate?: (fieldId: string, content: string) => void;\r\n}\r\n\r\nexport function ContentPanel({\r\n  projectId,\r\n  currentPhase,\r\n  fields,\r\n  onFieldUpdate,\r\n}: ContentPanelProps) {\r\n  const phaseFields = fields.filter((f) => f.phase === currentPhase);\r\n\r\n  if (!projectId) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full text-zinc-500\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-lg mb-2\">请选择或创建一个项目</p>\r\n          <p className=\"text-sm\">在左侧选择项目开始工作</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-4xl mx-auto\">\r\n      {/* 阶段标题 */}\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-2xl font-bold text-zinc-100\">\r\n          {PHASE_NAMES[currentPhase] || currentPhase}\r\n        </h1>\r\n        <p className=\"text-zinc-500 mt-1\">\r\n          {getPhaseDescription(currentPhase)}\r\n        </p>\r\n      </div>\r\n\r\n      {/* 字段列表 */}\r\n      {phaseFields.length > 0 ? (\r\n        <div className=\"space-y-6\">\r\n          {phaseFields.map((field) => (\r\n            <FieldCard\r\n              key={field.id}\r\n              field={field}\r\n              onUpdate={(content) => onFieldUpdate?.(field.id, content)}\r\n            />\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-12 text-zinc-500\">\r\n          <p>当前阶段暂无内容</p>\r\n          <p className=\"text-sm mt-2\">\r\n            在右侧与 AI Agent 对话开始生产内容\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface FieldCardProps {\r\n  field: Field;\r\n  onUpdate?: (content: string) => void;\r\n}\r\n\r\nfunction FieldCard({ field, onUpdate }: FieldCardProps) {\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [content, setContent] = useState(field.content);\r\n\r\n  useEffect(() => {\r\n    setContent(field.content);\r\n  }, [field.content]);\r\n\r\n  const handleSave = () => {\r\n    onUpdate?.(content);\r\n    setIsEditing(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-surface-2 rounded-xl border border-surface-3 overflow-hidden\">\r\n      {/* 字段头部 */}\r\n      <div className=\"px-4 py-3 border-b border-surface-3 flex items-center justify-between\">\r\n        <div>\r\n          <h3 className=\"font-medium text-zinc-200\">{field.name}</h3>\r\n          <span className=\"text-xs text-zinc-500\">\r\n            {field.status === \"completed\"\r\n              ? \"已生成\"\r\n              : field.status === \"generating\"\r\n              ? \"生成中...\"\r\n              : \"待生成\"}\r\n          </span>\r\n        </div>\r\n        \r\n        <div className=\"flex gap-2\">\r\n          {isEditing ? (\r\n            <>\r\n              <button\r\n                onClick={handleSave}\r\n                className=\"px-3 py-1 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg transition-colors\"\r\n              >\r\n                保存\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  setContent(field.content);\r\n                  setIsEditing(false);\r\n                }}\r\n                className=\"px-3 py-1 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg transition-colors\"\r\n              >\r\n                取消\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <button\r\n              onClick={() => setIsEditing(true)}\r\n              className=\"px-3 py-1 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg transition-colors\"\r\n            >\r\n              编辑\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* 字段内容 */}\r\n      <div className=\"p-4\">\r\n        {isEditing ? (\r\n          <textarea\r\n            value={content}\r\n            onChange={(e) => setContent(e.target.value)}\r\n            className=\"w-full min-h-[200px] bg-surface-1 border border-surface-3 rounded-lg p-3 text-zinc-200 resize-y focus:outline-none focus:ring-2 focus:ring-brand-500\"\r\n          />\r\n        ) : (\r\n          <div className=\"prose prose-invert max-w-none\">\r\n            {field.content ? (\r\n              <div className=\"whitespace-pre-wrap text-zinc-300\">\r\n                {field.content}\r\n              </div>\r\n            ) : (\r\n              <p className=\"text-zinc-500 italic\">暂无内容</p>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getPhaseDescription(phase: string): string {\r\n  const descriptions: Record<string, string> = {\r\n    intent: \"澄清内容生产的核心意图和目标\",\r\n    research: \"调研目标用户，了解痛点和需求\",\r\n    design_inner: \"设计内容生产方案和大纲\",\r\n    produce_inner: \"生产核心内容\",\r\n    design_outer: \"设计外延传播方案\",\r\n    produce_outer: \"为各渠道生产营销内容\",\r\n    simulate: \"模拟用户体验，收集反馈\",\r\n    evaluate: \"全面评估内容质量\",\r\n  };\r\n  return descriptions[phase] || \"\";\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAMA;AACA;;;AAPA,wCAAwC;AACxC,eAAe;AACf,qBAAqB;AAErB;;;AAaO,SAAS,aAAa,EAC3B,SAAS,EACT,YAAY,EACZ,MAAM,EACN,aAAa,EACK;IAClB,MAAM,cAAc,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,KAAK,KAAK;IAErD,IAAI,CAAC,WAAW;QACd,qBACE,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAE,WAAU;kCAAe;;;;;;kCAC5B,6LAAC;wBAAE,WAAU;kCAAU;;;;;;;;;;;;;;;;;IAI/B;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCACX,8HAAW,CAAC,aAAa,IAAI;;;;;;kCAEhC,6LAAC;wBAAE,WAAU;kCACV,oBAAoB;;;;;;;;;;;;YAKxB,YAAY,MAAM,GAAG,kBACpB,6LAAC;gBAAI,WAAU;0BACZ,YAAY,GAAG,CAAC,CAAC,sBAChB,6LAAC;wBAEC,OAAO;wBACP,UAAU,CAAC,UAAY,gBAAgB,MAAM,EAAE,EAAE;uBAF5C,MAAM,EAAE;;;;;;;;;qCAOnB,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;kCAAE;;;;;;kCACH,6LAAC;wBAAE,WAAU;kCAAe;;;;;;;;;;;;;;;;;;AAOtC;KApDgB;AA2DhB,SAAS,UAAU,EAAE,KAAK,EAAE,QAAQ,EAAkB;;IACpD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC,MAAM,OAAO;IAEpD,IAAA,0KAAS;+BAAC;YACR,WAAW,MAAM,OAAO;QAC1B;8BAAG;QAAC,MAAM,OAAO;KAAC;IAElB,MAAM,aAAa;QACjB,WAAW;QACX,aAAa;IACf;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;;0CACC,6LAAC;gCAAG,WAAU;0CAA6B,MAAM,IAAI;;;;;;0CACrD,6LAAC;gCAAK,WAAU;0CACb,MAAM,MAAM,KAAK,cACd,QACA,MAAM,MAAM,KAAK,eACjB,WACA;;;;;;;;;;;;kCAIR,6LAAC;wBAAI,WAAU;kCACZ,0BACC;;8CACE,6LAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;8CAGD,6LAAC;oCACC,SAAS;wCACP,WAAW,MAAM,OAAO;wCACxB,aAAa;oCACf;oCACA,WAAU;8CACX;;;;;;;yDAKH,6LAAC;4BACC,SAAS,IAAM,aAAa;4BAC5B,WAAU;sCACX;;;;;;;;;;;;;;;;;0BAQP,6LAAC;gBAAI,WAAU;0BACZ,0BACC,6LAAC;oBACC,OAAO;oBACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;oBAC1C,WAAU;;;;;yCAGZ,6LAAC;oBAAI,WAAU;8BACZ,MAAM,OAAO,iBACZ,6LAAC;wBAAI,WAAU;kCACZ,MAAM,OAAO;;;;;6CAGhB,6LAAC;wBAAE,WAAU;kCAAuB;;;;;;;;;;;;;;;;;;;;;;AAOlD;GAhFS;MAAA;AAkFT,SAAS,oBAAoB,KAAa;IACxC,MAAM,eAAuC;QAC3C,QAAQ;QACR,UAAU;QACV,cAAc;QACd,eAAe;QACf,cAAc;QACd,eAAe;QACf,UAAU;QACV,UAAU;IACZ;IACA,OAAO,YAAY,CAAC,MAAM,IAAI;AAChC"}},
    {"offset": {"line": 713, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/agent-panel.tsx"],"sourcesContent":["// frontend/components/agent-panel.tsx\r\n// 功能: 右栏AI Agent对话面板\r\n// 主要组件: AgentPanel\r\n\r\n\"use client\";\r\n\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface Message {\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n}\r\n\r\ninterface AgentPanelProps {\r\n  projectId: string | null;\r\n  onSendMessage?: (message: string) => Promise<string>;\r\n  isLoading?: boolean;\r\n}\r\n\r\nexport function AgentPanel({\r\n  projectId,\r\n  onSendMessage,\r\n  isLoading = false,\r\n}: AgentPanelProps) {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  // 自动滚动到底部\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  const handleSend = async () => {\r\n    if (!input.trim() || !projectId || sending) return;\r\n\r\n    const userMessage = input.trim();\r\n    setInput(\"\");\r\n    setSending(true);\r\n\r\n    // 添加用户消息\r\n    setMessages((prev) => [...prev, { role: \"user\", content: userMessage }]);\r\n\r\n    try {\r\n      // 调用API\r\n      const response = await onSendMessage?.(userMessage);\r\n      \r\n      if (response) {\r\n        setMessages((prev) => [\r\n          ...prev,\r\n          { role: \"assistant\", content: response },\r\n        ]);\r\n      }\r\n    } catch (error) {\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          role: \"assistant\",\r\n          content: `抱歉，发生了错误：${error instanceof Error ? error.message : \"未知错误\"}`,\r\n        },\r\n      ]);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === \"Enter\" && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSend();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full\">\r\n      {/* 头部 */}\r\n      <div className=\"px-4 py-3 border-b border-surface-3\">\r\n        <h2 className=\"font-semibold text-zinc-100\">AI Agent</h2>\r\n        <p className=\"text-xs text-zinc-500\">\r\n          {projectId ? \"与 Agent 对话推进内容生产\" : \"请先选择项目\"}\r\n        </p>\r\n      </div>\r\n\r\n      {/* 消息列表 */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n        {messages.length === 0 && (\r\n          <div className=\"text-center text-zinc-500 py-8\">\r\n            <p>开始对话吧！</p>\r\n            <p className=\"text-sm mt-2\">\r\n              你可以说 \"开始\" 来启动内容生产流程\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {messages.map((msg, idx) => (\r\n          <MessageBubble key={idx} message={msg} />\r\n        ))}\r\n\r\n        {sending && (\r\n          <div className=\"flex items-center gap-2 text-zinc-500\">\r\n            <div className=\"w-2 h-2 bg-brand-500 rounded-full animate-pulse\" />\r\n            <span className=\"text-sm\">Agent 正在思考...</span>\r\n          </div>\r\n        )}\r\n\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* 输入区 */}\r\n      <div className=\"p-4 border-t border-surface-3\">\r\n        <div className=\"flex gap-2\">\r\n          <input\r\n            type=\"text\"\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            onKeyDown={handleKeyDown}\r\n            placeholder={projectId ? \"输入消息... 使用 @ 引用字段\" : \"请先选择项目\"}\r\n            disabled={!projectId || sending}\r\n            className=\"flex-1 px-4 py-2 bg-surface-2 border border-surface-3 rounded-lg text-zinc-200 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-brand-500 disabled:opacity-50\"\r\n          />\r\n          <button\r\n            onClick={handleSend}\r\n            disabled={!projectId || !input.trim() || sending}\r\n            className=\"px-4 py-2 bg-brand-600 hover:bg-brand-700 disabled:bg-surface-3 disabled:cursor-not-allowed rounded-lg transition-colors\"\r\n          >\r\n            发送\r\n          </button>\r\n        </div>\r\n\r\n        {/* 快捷操作 */}\r\n        <div className=\"flex gap-2 mt-2\">\r\n          <QuickAction\r\n            label=\"继续\"\r\n            onClick={() => {\r\n              setInput(\"继续\");\r\n              handleSend();\r\n            }}\r\n            disabled={!projectId || sending}\r\n          />\r\n          <QuickAction\r\n            label=\"开始调研\"\r\n            onClick={() => {\r\n              setInput(\"开始消费者调研\");\r\n              handleSend();\r\n            }}\r\n            disabled={!projectId || sending}\r\n          />\r\n          <QuickAction\r\n            label=\"评估\"\r\n            onClick={() => {\r\n              setInput(\"评估当前内容\");\r\n              handleSend();\r\n            }}\r\n            disabled={!projectId || sending}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction MessageBubble({ message }: { message: Message }) {\r\n  const isUser = message.role === \"user\";\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"flex\",\r\n        isUser ? \"justify-end\" : \"justify-start\"\r\n      )}\r\n    >\r\n      <div\r\n        className={cn(\r\n          \"max-w-[85%] px-4 py-2 rounded-2xl\",\r\n          isUser\r\n            ? \"bg-brand-600 text-white rounded-br-md\"\r\n            : \"bg-surface-3 text-zinc-200 rounded-bl-md\"\r\n        )}\r\n      >\r\n        <div className=\"whitespace-pre-wrap text-sm\">\r\n          {message.content}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction QuickAction({\r\n  label,\r\n  onClick,\r\n  disabled,\r\n}: {\r\n  label: string;\r\n  onClick: () => void;\r\n  disabled: boolean;\r\n}) {\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      disabled={disabled}\r\n      className=\"px-2 py-1 text-xs text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 disabled:opacity-50 disabled:cursor-not-allowed rounded transition-colors\"\r\n    >\r\n      {label}\r\n    </button>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1031, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/lib/api.ts"],"sourcesContent":["// frontend/lib/api.ts\r\n// 功能: API客户端，封装后端API调用\r\n// 主要函数: fetchAPI, streamAPI\r\n// 数据结构: Project, Field, ChatMessage\r\n\r\nconst API_BASE = process.env.BACKEND_URL || \"http://localhost:8000\";\r\n\r\n// ============== Types ==============\r\n\r\nexport interface Project {\r\n  id: string;\r\n  name: string;\r\n  version: number;\r\n  version_note: string;\r\n  creator_profile_id: string | null;\r\n  current_phase: string;\r\n  phase_order: string[];\r\n  phase_status: Record<string, string>;\r\n  agent_autonomy: Record<string, boolean>;\r\n  golden_context: Record<string, string>;\r\n  use_deep_research: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface Field {\r\n  id: string;\r\n  project_id: string;\r\n  phase: string;\r\n  name: string;\r\n  field_type: string;\r\n  content: string;\r\n  status: string;\r\n  ai_prompt: string;\r\n  pre_questions: string[];\r\n  pre_answers: Record<string, string>;\r\n  dependencies: {\r\n    depends_on: string[];\r\n    dependency_type: string;\r\n  };\r\n  template_id: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface CreatorProfile {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  traits: Record<string, any>;\r\n  created_at: string;\r\n}\r\n\r\nexport interface ChatMessage {\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n}\r\n\r\nexport interface ChatResponse {\r\n  message: string;\r\n  phase: string;\r\n  phase_status: Record<string, string>;\r\n  waiting_for_human: boolean;\r\n}\r\n\r\n// ============== API Functions ==============\r\n\r\nasync function fetchAPI<T>(\r\n  endpoint: string,\r\n  options: RequestInit = {}\r\n): Promise<T> {\r\n  const url = `${API_BASE}${endpoint}`;\r\n  \r\n  const response = await fetch(url, {\r\n    ...options,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      ...options.headers,\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({ detail: \"Unknown error\" }));\r\n    // 处理Pydantic验证错误格式 (detail可能是数组)\r\n    let errorMessage: string;\r\n    if (typeof error.detail === \"string\") {\r\n      errorMessage = error.detail;\r\n    } else if (Array.isArray(error.detail)) {\r\n      errorMessage = error.detail.map((e: any) => e.msg || e.message || JSON.stringify(e)).join(\"; \");\r\n    } else {\r\n      errorMessage = `API error: ${response.status}`;\r\n    }\r\n    throw new Error(errorMessage);\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n// ============== Project API ==============\r\n\r\nexport const projectAPI = {\r\n  list: () => fetchAPI<Project[]>(\"/api/projects/\"),\r\n  \r\n  get: (id: string) => fetchAPI<Project>(`/api/projects/${id}`),\r\n  \r\n  create: (data: { name: string; creator_profile_id?: string; use_deep_research?: boolean }) =>\r\n    fetchAPI<Project>(\"/api/projects/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  update: (id: string, data: Partial<Project>) =>\r\n    fetchAPI<Project>(`/api/projects/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  delete: (id: string) =>\r\n    fetchAPI<{ message: string }>(`/api/projects/${id}`, { method: \"DELETE\" }),\r\n  \r\n  createVersion: (id: string, version_note: string) =>\r\n    fetchAPI<Project>(`/api/projects/${id}/versions`, {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ version_note }),\r\n    }),\r\n};\r\n\r\n// ============== Field API ==============\r\n\r\nexport const fieldAPI = {\r\n  listByProject: (projectId: string, phase?: string) => {\r\n    const query = phase ? `?phase=${phase}` : \"\";\r\n    return fetchAPI<Field[]>(`/api/fields/project/${projectId}${query}`);\r\n  },\r\n  \r\n  get: (id: string) => fetchAPI<Field>(`/api/fields/${id}`),\r\n  \r\n  create: (data: Partial<Field>) =>\r\n    fetchAPI<Field>(\"/api/fields/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  update: (id: string, data: Partial<Field>) =>\r\n    fetchAPI<Field>(`/api/fields/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  delete: (id: string) =>\r\n    fetchAPI<{ message: string }>(`/api/fields/${id}`, { method: \"DELETE\" }),\r\n  \r\n  generate: (id: string, pre_answers: Record<string, string> = {}) =>\r\n    fetchAPI<Field>(`/api/fields/${id}/generate`, {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ pre_answers }),\r\n    }),\r\n};\r\n\r\n// ============== Agent API ==============\r\n\r\nexport const agentAPI = {\r\n  chat: (projectId: string, message: string, currentPhase?: string) =>\r\n    fetchAPI<ChatResponse>(\"/api/agent/chat\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        message,\r\n        current_phase: currentPhase,\r\n      }),\r\n    }),\r\n  \r\n  advance: (projectId: string) =>\r\n    fetchAPI<ChatResponse>(\"/api/agent/advance\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        message: \"继续\",\r\n      }),\r\n    }),\r\n  \r\n  stream: async function* (\r\n    projectId: string,\r\n    message: string,\r\n    currentPhase?: string\r\n  ): AsyncGenerator<{ node?: string; content?: string; done?: boolean; error?: string }> {\r\n    const response = await fetch(`${API_BASE}/api/agent/stream`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        message,\r\n        current_phase: currentPhase,\r\n      }),\r\n    });\r\n\r\n    const reader = response.body?.getReader();\r\n    const decoder = new TextDecoder();\r\n\r\n    if (!reader) return;\r\n\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      if (done) break;\r\n\r\n      const text = decoder.decode(value);\r\n      const lines = text.split(\"\\n\");\r\n\r\n      for (const line of lines) {\r\n        if (line.startsWith(\"data: \")) {\r\n          try {\r\n            const data = JSON.parse(line.slice(6));\r\n            yield data;\r\n          } catch {\r\n            // Ignore parse errors\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\n// ============== Settings API ==============\r\n\r\nexport const settingsAPI = {\r\n  // System Prompts\r\n  listSystemPrompts: () =>\r\n    fetchAPI<any[]>(\"/api/settings/system-prompts\"),\r\n  \r\n  updateSystemPrompt: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/system-prompts/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n\r\n  // Creator Profiles\r\n  listCreatorProfiles: () =>\r\n    fetchAPI<CreatorProfile[]>(\"/api/settings/creator-profiles\"),\r\n  \r\n  createCreatorProfile: (data: Partial<CreatorProfile>) =>\r\n    fetchAPI<CreatorProfile>(\"/api/settings/creator-profiles\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateCreatorProfile: (id: string, data: Partial<CreatorProfile>) =>\r\n    fetchAPI<CreatorProfile>(`/api/settings/creator-profiles/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteCreatorProfile: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/creator-profiles/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Field Templates\r\n  listFieldTemplates: () =>\r\n    fetchAPI<any[]>(\"/api/settings/field-templates\"),\r\n  \r\n  createFieldTemplate: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/field-templates\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateFieldTemplate: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/field-templates/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteFieldTemplate: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/field-templates/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Channels\r\n  listChannels: () =>\r\n    fetchAPI<any[]>(\"/api/settings/channels\"),\r\n  \r\n  createChannel: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/channels\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateChannel: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/channels/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteChannel: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/channels/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Simulators\r\n  listSimulators: () =>\r\n    fetchAPI<any[]>(\"/api/settings/simulators\"),\r\n  \r\n  createSimulator: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/simulators\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateSimulator: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/simulators/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteSimulator: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/simulators/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Agent Settings\r\n  getAgentSettings: () =>\r\n    fetchAPI<any>(\"/api/settings/agent\"),\r\n  \r\n  updateAgentSettings: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/agent\", {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  // Logs\r\n  listLogs: (projectId?: string) => {\r\n    const query = projectId ? `?project_id=${projectId}` : \"\";\r\n    return fetchAPI<any[]>(`/api/settings/logs${query}`);\r\n  },\r\n  \r\n  exportLogs: (projectId?: string) => {\r\n    const query = projectId ? `?project_id=${projectId}` : \"\";\r\n    return fetchAPI<any>(`/api/settings/logs/export${query}`);\r\n  },\r\n};\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1250, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/app/workspace/page.tsx"],"sourcesContent":["// frontend/app/workspace/page.tsx\r\n// 功能: 内容生产工作台主页面\r\n// 主要组件: WorkspacePage\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { WorkspaceLayout } from \"@/components/layout/workspace-layout\";\r\nimport { ProgressPanel } from \"@/components/progress-panel\";\r\nimport { ContentPanel } from \"@/components/content-panel\";\r\nimport { AgentPanel } from \"@/components/agent-panel\";\r\nimport { projectAPI, fieldAPI, agentAPI } from \"@/lib/api\";\r\nimport type { Project, Field } from \"@/lib/api\";\r\n\r\nexport default function WorkspacePage() {\r\n  const [projects, setProjects] = useState<Project[]>([]);\r\n  const [currentProject, setCurrentProject] = useState<Project | null>(null);\r\n  const [fields, setFields] = useState<Field[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // 加载项目列表\r\n  useEffect(() => {\r\n    loadProjects();\r\n  }, []);\r\n\r\n  // 加载当前项目的字段\r\n  useEffect(() => {\r\n    if (currentProject) {\r\n      loadFields(currentProject.id);\r\n    }\r\n  }, [currentProject?.id]);\r\n\r\n  const loadProjects = async () => {\r\n    try {\r\n      const data = await projectAPI.list();\r\n      setProjects(data);\r\n      \r\n      // 自动选择第一个项目\r\n      if (data.length > 0 && !currentProject) {\r\n        setCurrentProject(data[0]);\r\n      }\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : \"加载项目失败\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadFields = async (projectId: string) => {\r\n    try {\r\n      const data = await fieldAPI.listByProject(projectId);\r\n      setFields(data);\r\n    } catch (err) {\r\n      console.error(\"加载字段失败:\", err);\r\n    }\r\n  };\r\n\r\n  const handlePhaseClick = (phase: string) => {\r\n    if (currentProject) {\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        current_phase: phase,\r\n      });\r\n    }\r\n  };\r\n\r\n  const handlePhaseReorder = async (newPhaseOrder: string[]) => {\r\n    if (!currentProject) return;\r\n    \r\n    try {\r\n      // 更新本地状态\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        phase_order: newPhaseOrder,\r\n      });\r\n      \r\n      // 保存到服务器\r\n      await projectAPI.update(currentProject.id, { phase_order: newPhaseOrder });\r\n    } catch (err) {\r\n      console.error(\"更新阶段顺序失败:\", err);\r\n    }\r\n  };\r\n\r\n  const handleFieldUpdate = async (fieldId: string, content: string) => {\r\n    try {\r\n      await fieldAPI.update(fieldId, { content });\r\n      // 重新加载字段\r\n      if (currentProject) {\r\n        loadFields(currentProject.id);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"更新字段失败:\", err);\r\n    }\r\n  };\r\n\r\n  const handleSendMessage = async (message: string): Promise<string> => {\r\n    if (!currentProject) {\r\n      throw new Error(\"请先选择项目\");\r\n    }\r\n\r\n    const response = await agentAPI.chat(\r\n      currentProject.id,\r\n      message,\r\n      currentProject.current_phase\r\n    );\r\n\r\n    // 更新项目状态\r\n    if (response.phase_status) {\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        phase_status: response.phase_status,\r\n      });\r\n    }\r\n\r\n    // 重新加载字段\r\n    loadFields(currentProject.id);\r\n\r\n    return response.message;\r\n  };\r\n\r\n  const handleCreateProject = async () => {\r\n    const name = prompt(\"请输入项目名称:\");\r\n    if (!name) return;\r\n\r\n    try {\r\n      const project = await projectAPI.create({ name });\r\n      setProjects([...projects, project]);\r\n      setCurrentProject(project);\r\n    } catch (err) {\r\n      alert(\"创建项目失败: \" + (err instanceof Error ? err.message : \"未知错误\"));\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-surface-0\">\r\n        <div className=\"text-zinc-400\">加载中...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-screen flex flex-col\">\r\n      {/* 顶部导航 */}\r\n      <header className=\"h-14 flex-shrink-0 border-b border-surface-3 bg-surface-1 flex items-center justify-between px-4\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <h1 className=\"text-lg font-semibold bg-gradient-to-r from-brand-400 to-brand-600 bg-clip-text text-transparent\">\r\n            内容生产系统\r\n          </h1>\r\n          \r\n          {/* 项目选择器 */}\r\n          <select\r\n            value={currentProject?.id || \"\"}\r\n            onChange={(e) => {\r\n              const project = projects.find((p) => p.id === e.target.value);\r\n              setCurrentProject(project || null);\r\n            }}\r\n            className=\"px-3 py-1.5 bg-surface-2 border border-surface-3 rounded-lg text-sm text-zinc-200 focus:outline-none focus:ring-2 focus:ring-brand-500\"\r\n          >\r\n            <option value=\"\">选择项目</option>\r\n            {projects.map((p) => (\r\n              <option key={p.id} value={p.id}>\r\n                {p.name} (v{p.version})\r\n              </option>\r\n            ))}\r\n          </select>\r\n          \r\n          <button\r\n            onClick={handleCreateProject}\r\n            className=\"px-3 py-1.5 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg transition-colors\"\r\n          >\r\n            + 新建项目\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-4\">\r\n          <a\r\n            href=\"/settings\"\r\n            className=\"text-sm text-zinc-400 hover:text-zinc-200 transition-colors\"\r\n          >\r\n            后台设置\r\n          </a>\r\n        </div>\r\n      </header>\r\n\r\n      {/* 三栏布局 */}\r\n      <div className=\"flex-1 overflow-hidden\">\r\n        <WorkspaceLayout\r\n          leftPanel={\r\n            <ProgressPanel\r\n              project={currentProject}\r\n              onPhaseClick={handlePhaseClick}\r\n              onPhaseReorder={handlePhaseReorder}\r\n            />\r\n          }\r\n          centerPanel={\r\n            <ContentPanel\r\n              projectId={currentProject?.id || null}\r\n              currentPhase={currentProject?.current_phase || \"intent\"}\r\n              fields={fields}\r\n              onFieldUpdate={handleFieldUpdate}\r\n            />\r\n          }\r\n          rightPanel={\r\n            <AgentPanel\r\n              projectId={currentProject?.id || null}\r\n              onSendMessage={handleSendMessage}\r\n            />\r\n          }\r\n        />\r\n      </div>\r\n\r\n      {/* 错误提示 */}\r\n      {error && (\r\n        <div className=\"fixed bottom-4 right-4 px-4 py-2 bg-red-600 text-white rounded-lg\">\r\n          {error}\r\n          <button\r\n            onClick={() => setError(null)}\r\n            className=\"ml-2 text-red-200 hover:text-white\"\r\n          >\r\n            ✕\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}