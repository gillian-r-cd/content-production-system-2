{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/layout/workspace-layout.tsx"],"sourcesContent":["// frontend/components/layout/workspace-layout.tsx\r\n// ÂäüËÉΩ: Â∑•‰ΩúÂè∞‰∏âÊ†èÂ∏ÉÂ±Ä\r\n// ‰∏ªË¶ÅÁªÑ‰ª∂: WorkspaceLayout\r\n\r\n\"use client\";\r\n\r\nimport { ReactNode } from \"react\";\r\n\r\ninterface WorkspaceLayoutProps {\r\n  leftPanel: ReactNode;\r\n  centerPanel: ReactNode;\r\n  rightPanel: ReactNode;\r\n}\r\n\r\nexport function WorkspaceLayout({\r\n  leftPanel,\r\n  centerPanel,\r\n  rightPanel,\r\n}: WorkspaceLayoutProps) {\r\n  return (\r\n    <div className=\"flex h-screen bg-surface-0\">\r\n      {/* Â∑¶Ê†èÔºöÈ°πÁõÆËøõÂ∫¶ */}\r\n      <aside className=\"w-64 flex-shrink-0 border-r border-surface-3 bg-surface-1 overflow-y-auto\">\r\n        {leftPanel}\r\n      </aside>\r\n\r\n      {/* ‰∏≠Ê†èÔºöÂÜÖÂÆπÂ±ïÁ§∫Âå∫ */}\r\n      <main className=\"flex-1 overflow-y-auto bg-surface-0\">\r\n        {centerPanel}\r\n      </main>\r\n\r\n      {/* Âè≥Ê†èÔºöAI Agent */}\r\n      <aside className=\"w-96 flex-shrink-0 border-l border-surface-3 bg-surface-1 flex flex-col\">\r\n        {rightPanel}\r\n      </aside>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAAA,kDAAkD;AAClD,cAAc;AACd,wBAAwB;AAExB;;AAUO,SAAS,gBAAgB,EAC9B,SAAS,EACT,WAAW,EACX,UAAU,EACW;IACrB,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAM,WAAU;0BACd;;;;;;0BAIH,8OAAC;gBAAK,WAAU;0BACb;;;;;;0BAIH,8OAAC;gBAAM,WAAU;0BACd;;;;;;;;;;;;AAIT"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/lib/utils.ts"],"sourcesContent":["// frontend/lib/utils.ts\r\n// ÂäüËÉΩ: ÈÄöÁî®Â∑•ÂÖ∑ÂáΩÊï∞\r\n// ‰∏ªË¶ÅÂáΩÊï∞: cn, formatDate\r\n\r\nimport { clsx, type ClassValue } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\n/**\r\n * ÂêàÂπ∂ Tailwind Á±ªÂêç\r\n */\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n\r\n/**\r\n * Ê†ºÂºèÂåñÊó•Êúü\r\n */\r\nexport function formatDate(dateString: string): string {\r\n  if (!dateString) return \"\";\r\n  const date = new Date(dateString);\r\n  return date.toLocaleString(\"zh-CN\", {\r\n    year: \"numeric\",\r\n    month: \"2-digit\",\r\n    day: \"2-digit\",\r\n    hour: \"2-digit\",\r\n    minute: \"2-digit\",\r\n  });\r\n}\r\n\r\n/**\r\n * Èò∂ÊÆµÂêçÁß∞Êò†Â∞Ñ\r\n */\r\nexport const PHASE_NAMES: Record<string, string> = {\r\n  intent: \"ÊÑèÂõæÂàÜÊûê\",\r\n  research: \"Ê∂àË¥πËÄÖË∞ÉÁ†î\",\r\n  design_inner: \"ÂÜÖÊ∂µËÆæËÆ°\",\r\n  produce_inner: \"ÂÜÖÊ∂µÁîü‰∫ß\",\r\n  design_outer: \"Â§ñÂª∂ËÆæËÆ°\",\r\n  produce_outer: \"Â§ñÂª∂Áîü‰∫ß\",\r\n  simulate: \"Ê∂àË¥πËÄÖÊ®°Êãü\",\r\n  evaluate: \"ËØÑ‰º∞\",\r\n};\r\n\r\n/**\r\n * Èò∂ÊÆµÁä∂ÊÄÅÊò†Â∞Ñ\r\n */\r\nexport const PHASE_STATUS: Record<string, { label: string; color: string }> = {\r\n  pending: { label: \"Êú™ÂºÄÂßã\", color: \"text-zinc-500\" },\r\n  in_progress: { label: \"ËøõË°å‰∏≠\", color: \"text-yellow-500\" },\r\n  completed: { label: \"Â∑≤ÂÆåÊàê\", color: \"text-green-500\" },\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA,wBAAwB;AACxB,aAAa;AACb,uBAAuB;AAEvB;AACA;;;AAKO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACtB;AAKO,SAAS,WAAW,UAAkB;IAC3C,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,OAAO,IAAI,KAAK;IACtB,OAAO,KAAK,cAAc,CAAC,SAAS;QAClC,MAAM;QACN,OAAO;QACP,KAAK;QACL,MAAM;QACN,QAAQ;IACV;AACF;AAKO,MAAM,cAAsC;IACjD,QAAQ;IACR,UAAU;IACV,cAAc;IACd,eAAe;IACf,cAAc;IACd,eAAe;IACf,UAAU;IACV,UAAU;AACZ;AAKO,MAAM,eAAiE;IAC5E,SAAS;QAAE,OAAO;QAAO,OAAO;IAAgB;IAChD,aAAa;QAAE,OAAO;QAAO,OAAO;IAAkB;IACtD,WAAW;QAAE,OAAO;QAAO,OAAO;IAAiB;AACrD"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/progress-panel.tsx"],"sourcesContent":["// frontend/components/progress-panel.tsx\r\n// ÂäüËÉΩ: Â∑¶Ê†èÈ°πÁõÆËøõÂ∫¶Èù¢ÊùøÔºåÊîØÊåÅ‰∏≠Èó¥4Èò∂ÊÆµÊãñÊãΩÊéíÂ∫è\r\n// ‰∏ªË¶ÅÁªÑ‰ª∂: ProgressPanel\r\n// Âõ∫ÂÆöÈò∂ÊÆµ: ÊÑèÂõæÂàÜÊûê„ÄÅÊ∂àË¥πËÄÖË∞ÉÁ†îÂú®È°∂ÈÉ®ÔºõÊ∂àË¥πËÄÖÊ®°Êãü„ÄÅËØÑ‰º∞Âú®Â∫ïÈÉ®\r\n// ÂèØÊãñÊãΩÈò∂ÊÆµ: ÂÜÖÊ∂µËÆæËÆ°„ÄÅÂÜÖÊ∂µÁîü‰∫ß„ÄÅÂ§ñÂª∂ËÆæËÆ°„ÄÅÂ§ñÂª∂Áîü‰∫ß\r\n\r\n\"use client\";\r\n\r\nimport { useState, useRef } from \"react\";\r\nimport { cn, PHASE_NAMES, PHASE_STATUS } from \"@/lib/utils\";\r\nimport type { Project } from \"@/lib/api\";\r\n\r\n// Âõ∫ÂÆöÈò∂ÊÆµÂÆö‰πâ\r\nconst FIXED_TOP_PHASES = [\"intent\", \"research\"];\r\nconst DRAGGABLE_PHASES = [\"design_inner\", \"produce_inner\", \"design_outer\", \"produce_outer\"];\r\nconst FIXED_BOTTOM_PHASES = [\"simulate\", \"evaluate\"];\r\n\r\ninterface ProgressPanelProps {\r\n  project: Project | null;\r\n  onPhaseClick?: (phase: string) => void;\r\n  onPhaseReorder?: (phases: string[]) => void;\r\n  onAutonomyChange?: (autonomy: Record<string, boolean>) => void;\r\n}\r\n\r\nexport function ProgressPanel({\r\n  project,\r\n  onPhaseClick,\r\n  onPhaseReorder,\r\n  onAutonomyChange,\r\n}: ProgressPanelProps) {\r\n  const [showAutonomySettings, setShowAutonomySettings] = useState(false);\r\n  const allPhases = project?.phase_order || [];\r\n  const phaseStatus = project?.phase_status || {};\r\n  const currentPhase = project?.current_phase || \"intent\";\r\n  \r\n  // ÂàÜÁ¶ªÂõ∫ÂÆöÂíåÂèØÊãñÊãΩÈò∂ÊÆµ\r\n  const topPhases = allPhases.filter(p => FIXED_TOP_PHASES.includes(p));\r\n  const middlePhases = allPhases.filter(p => DRAGGABLE_PHASES.includes(p));\r\n  const bottomPhases = allPhases.filter(p => FIXED_BOTTOM_PHASES.includes(p));\r\n  \r\n  // ÊãñÊãΩÁä∂ÊÄÅ\r\n  const [draggedPhase, setDraggedPhase] = useState<string | null>(null);\r\n  const [dragOverPhase, setDragOverPhase] = useState<string | null>(null);\r\n  const dragCounter = useRef(0);\r\n\r\n  const handleDragStart = (e: React.DragEvent, phase: string) => {\r\n    setDraggedPhase(phase);\r\n    e.dataTransfer.effectAllowed = \"move\";\r\n    e.dataTransfer.setData(\"text/plain\", phase);\r\n  };\r\n\r\n  const handleDragEnd = () => {\r\n    setDraggedPhase(null);\r\n    setDragOverPhase(null);\r\n    dragCounter.current = 0;\r\n  };\r\n\r\n  const handleDragEnter = (e: React.DragEvent, phase: string) => {\r\n    e.preventDefault();\r\n    dragCounter.current++;\r\n    if (DRAGGABLE_PHASES.includes(phase)) {\r\n      setDragOverPhase(phase);\r\n    }\r\n  };\r\n\r\n  const handleDragLeave = () => {\r\n    dragCounter.current--;\r\n    if (dragCounter.current === 0) {\r\n      setDragOverPhase(null);\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent, targetPhase: string) => {\r\n    e.preventDefault();\r\n    \r\n    if (!draggedPhase || draggedPhase === targetPhase) {\r\n      handleDragEnd();\r\n      return;\r\n    }\r\n    \r\n    // ÈáçÊñ∞ÊéíÂ∫è‰∏≠Èó¥Èò∂ÊÆµ\r\n    const newMiddle = [...middlePhases];\r\n    const dragIdx = newMiddle.indexOf(draggedPhase);\r\n    const dropIdx = newMiddle.indexOf(targetPhase);\r\n    \r\n    if (dragIdx !== -1 && dropIdx !== -1) {\r\n      newMiddle.splice(dragIdx, 1);\r\n      newMiddle.splice(dropIdx, 0, draggedPhase);\r\n      \r\n      // ÈáçÂª∫ÂÆåÊï¥È°∫Â∫è\r\n      const newOrder = [...topPhases, ...newMiddle, ...bottomPhases];\r\n      onPhaseReorder?.(newOrder);\r\n    }\r\n    \r\n    handleDragEnd();\r\n  };\r\n\r\n  const renderPhaseItem = (phase: string, isDraggable: boolean) => {\r\n    const status = phaseStatus[phase] || \"pending\";\r\n    const statusInfo = PHASE_STATUS[status] || PHASE_STATUS.pending;\r\n    const isCurrent = phase === currentPhase;\r\n    const isDragging = draggedPhase === phase;\r\n    const isDragOver = dragOverPhase === phase;\r\n    \r\n    return (\r\n      <div\r\n        key={phase}\r\n        draggable={isDraggable}\r\n        onDragStart={isDraggable ? (e) => handleDragStart(e, phase) : undefined}\r\n        onDragEnd={isDraggable ? handleDragEnd : undefined}\r\n        onDragEnter={isDraggable ? (e) => handleDragEnter(e, phase) : undefined}\r\n        onDragLeave={isDraggable ? handleDragLeave : undefined}\r\n        onDragOver={isDraggable ? handleDragOver : undefined}\r\n        onDrop={isDraggable ? (e) => handleDrop(e, phase) : undefined}\r\n        className={cn(\r\n          \"relative transition-all duration-150\",\r\n          isDragging && \"opacity-50\",\r\n          isDragOver && \"before:absolute before:inset-x-0 before:-top-1 before:h-0.5 before:bg-brand-500\"\r\n        )}\r\n      >\r\n        <button\r\n          onClick={() => onPhaseClick?.(phase)}\r\n          className={cn(\r\n            \"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors\",\r\n            isCurrent\r\n              ? \"bg-brand-600/20 text-brand-400\"\r\n              : \"hover:bg-surface-3 text-zinc-300\",\r\n            isDraggable && \"cursor-grab active:cursor-grabbing\"\r\n          )}\r\n        >\r\n          {/* ÊãñÊãΩÊâãÊüÑ */}\r\n          {isDraggable && (\r\n            <span className=\"text-zinc-600 text-xs select-none\">‚ãÆ‚ãÆ</span>\r\n          )}\r\n          \r\n          {/* Áä∂ÊÄÅÊåáÁ§∫Âô® */}\r\n          <div\r\n            className={cn(\r\n              \"w-2 h-2 rounded-full flex-shrink-0\",\r\n              status === \"completed\" && \"bg-green-500\",\r\n              status === \"in_progress\" && \"bg-yellow-500\",\r\n              status === \"pending\" && \"bg-zinc-600\"\r\n            )}\r\n          />\r\n          \r\n          {/* Èò∂ÊÆµÂêçÁß∞ */}\r\n          <span className=\"flex-1 text-sm\">\r\n            {PHASE_NAMES[phase] || phase}\r\n          </span>\r\n          \r\n          {/* Áä∂ÊÄÅÊ†áÁ≠æ */}\r\n          <span className={cn(\"text-xs\", statusInfo.color)}>\r\n            {statusInfo.label}\r\n          </span>\r\n        </button>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4\">\r\n      {/* È°πÁõÆ‰ø°ÊÅØ */}\r\n      <div className=\"mb-6\">\r\n        <h2 className=\"text-lg font-semibold text-zinc-100\">\r\n          {project?.name || \"Êú™ÈÄâÊã©È°πÁõÆ\"}\r\n        </h2>\r\n        {project && (\r\n          <p className=\"text-sm text-zinc-500 mt-1\">\r\n            ÁâàÊú¨ {project.version}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* ÊµÅÁ®ãËøõÂ∫¶ */}\r\n      <div className=\"space-y-1\">\r\n        <h3 className=\"text-xs font-medium text-zinc-500 uppercase tracking-wider mb-3\">\r\n          ÊµÅÁ®ãËøõÂ∫¶\r\n        </h3>\r\n        \r\n        {/* È°∂ÈÉ®Âõ∫ÂÆöÈò∂ÊÆµ */}\r\n        {topPhases.map(phase => renderPhaseItem(phase, false))}\r\n        \r\n        {/* ÂèØÊãñÊãΩÁöÑ‰∏≠Èó¥Èò∂ÊÆµ */}\r\n        {middlePhases.length > 0 && (\r\n          <div className=\"py-1\">\r\n            <div className=\"text-xs text-zinc-600 px-3 mb-1 flex items-center gap-1\">\r\n              <span>‚Üï</span>\r\n              <span>ÂèØÊãñÊãΩË∞ÉÊï¥È°∫Â∫è</span>\r\n            </div>\r\n            {middlePhases.map(phase => renderPhaseItem(phase, true))}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Â∫ïÈÉ®Âõ∫ÂÆöÈò∂ÊÆµ */}\r\n        {bottomPhases.map(phase => renderPhaseItem(phase, false))}\r\n      </div>\r\n\r\n      {/* ÂàÜÈöîÁ∫ø */}\r\n      <div className=\"my-6 border-t border-surface-3\" />\r\n\r\n      {/* Âø´Êç∑Êìç‰Ωú */}\r\n      <div className=\"space-y-2\">\r\n        <h3 className=\"text-xs font-medium text-zinc-500 uppercase tracking-wider mb-3\">\r\n          Âø´Êç∑Êìç‰Ωú\r\n        </h3>\r\n        \r\n        <button \r\n          onClick={() => setShowAutonomySettings(true)}\r\n          className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\"\r\n        >\r\n          ‚öô AgentËá™‰∏ªÊùÉËÆæÁΩÆ\r\n        </button>\r\n        \r\n        <button className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\">\r\n          + Êñ∞Âª∫ÁâàÊú¨\r\n        </button>\r\n        \r\n        <button className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\">\r\n          Êü•ÁúãÂéÜÂè≤ÁâàÊú¨\r\n        </button>\r\n        \r\n        <button className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\">\r\n          ÂØºÂá∫ÂÜÖÂÆπ\r\n        </button>\r\n      </div>\r\n\r\n      {/* AgentËá™‰∏ªÊùÉËÆæÁΩÆÂºπÁ™ó */}\r\n      {showAutonomySettings && project && (\r\n        <AutonomySettingsModal\r\n          project={project}\r\n          onClose={() => setShowAutonomySettings(false)}\r\n          onSave={onAutonomyChange}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface AutonomySettingsModalProps {\r\n  project: Project;\r\n  onClose: () => void;\r\n  onSave?: (autonomy: Record<string, boolean>) => void;\r\n}\r\n\r\nfunction AutonomySettingsModal({ project, onClose, onSave }: AutonomySettingsModalProps) {\r\n  const [autonomy, setAutonomy] = useState<Record<string, boolean>>(\r\n    project.agent_autonomy || {}\r\n  );\r\n\r\n  const allPhases = [\r\n    { id: \"intent\", name: \"ÊÑèÂõæÂàÜÊûê\", desc: \"AgentËá™Âä®ÊèêÈóÆÂπ∂ÂàÜÊûêÊÑèÂõæ\" },\r\n    { id: \"research\", name: \"Ê∂àË¥πËÄÖË∞ÉÁ†î\", desc: \"AgentËá™Âä®Ë∞ÉÁ†îÁî®Êà∑ÁîªÂÉè\" },\r\n    { id: \"design_inner\", name: \"ÂÜÖÊ∂µËÆæËÆ°\", desc: \"AgentËá™Âä®ËÆæËÆ°ÂÜÖÂÆπÊñπÊ°à\" },\r\n    { id: \"produce_inner\", name: \"ÂÜÖÊ∂µÁîü‰∫ß\", desc: \"AgentËá™Âä®Áîü‰∫ßÂêÑÂ≠óÊÆµÂÜÖÂÆπ\" },\r\n    { id: \"design_outer\", name: \"Â§ñÂª∂ËÆæËÆ°\", desc: \"AgentËá™Âä®ËÆæËÆ°‰º†Êí≠ÊñπÊ°à\" },\r\n    { id: \"produce_outer\", name: \"Â§ñÂª∂Áîü‰∫ß\", desc: \"AgentËá™Âä®Áîü‰∫ßÊ∏†ÈÅìÂÜÖÂÆπ\" },\r\n    { id: \"simulate\", name: \"Ê∂àË¥πËÄÖÊ®°Êãü\", desc: \"AgentËá™Âä®Ê®°ÊãüÁî®Êà∑‰ΩìÈ™å\" },\r\n    { id: \"evaluate\", name: \"ËØÑ‰º∞\", desc: \"AgentËá™Âä®ËØÑ‰º∞ÂÜÖÂÆπË¥®Èáè\" },\r\n  ];\r\n\r\n  const handleToggle = (phase: string) => {\r\n    setAutonomy((prev) => ({\r\n      ...prev,\r\n      [phase]: !prev[phase],\r\n    }));\r\n  };\r\n\r\n  const handleSave = () => {\r\n    onSave?.(autonomy);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-surface-2 rounded-xl border border-surface-3 w-full max-w-lg max-h-[80vh] overflow-hidden\">\r\n        <div className=\"px-4 py-3 border-b border-surface-3\">\r\n          <h3 className=\"font-medium text-zinc-200\">AgentËá™‰∏ªÊùÉËÆæÁΩÆ</h3>\r\n          <p className=\"text-xs text-zinc-500 mt-1\">\r\n            ËÆæÁΩÆÂêÑÈò∂ÊÆµAgentÊòØÂê¶Ëá™Âä®ÊâßË°åÔºå‰∏çÂãæÈÄâ = ÈúÄË¶Å‰∫∫Â∑•Á°ÆËÆ§ÂêéÊâçÁªßÁª≠\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"p-4 max-h-[50vh] overflow-y-auto space-y-3\">\r\n          {allPhases.map((phase) => (\r\n            <label\r\n              key={phase.id}\r\n              className=\"flex items-start gap-3 p-3 rounded-lg hover:bg-surface-3 cursor-pointer\"\r\n            >\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={autonomy[phase.id] !== false}\r\n                onChange={() => handleToggle(phase.id)}\r\n                className=\"mt-0.5 rounded\"\r\n              />\r\n              <div className=\"flex-1\">\r\n                <div className=\"text-sm text-zinc-200\">{phase.name}</div>\r\n                <div className=\"text-xs text-zinc-500 mt-0.5\">{phase.desc}</div>\r\n              </div>\r\n              <span className={`text-xs px-2 py-0.5 rounded ${\r\n                autonomy[phase.id] !== false\r\n                  ? \"bg-green-600/20 text-green-400\"\r\n                  : \"bg-yellow-600/20 text-yellow-400\"\r\n              }`}>\r\n                {autonomy[phase.id] !== false ? \"Ëá™Âä®\" : \"ÈúÄÁ°ÆËÆ§\"}\r\n              </span>\r\n            </label>\r\n          ))}\r\n        </div>\r\n\r\n        <div className=\"px-4 py-3 border-t border-surface-3 flex justify-between\">\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={() => setAutonomy(allPhases.reduce((acc, p) => ({ ...acc, [p.id]: true }), {}))}\r\n              className=\"px-3 py-1.5 text-xs bg-surface-3 hover:bg-surface-4 rounded-lg\"\r\n            >\r\n              ÂÖ®ÈÉ®Ëá™Âä®\r\n            </button>\r\n            <button\r\n              onClick={() => setAutonomy(allPhases.reduce((acc, p) => ({ ...acc, [p.id]: false }), {}))}\r\n              className=\"px-3 py-1.5 text-xs bg-surface-3 hover:bg-surface-4 rounded-lg\"\r\n            >\r\n              ÂÖ®ÈÉ®Á°ÆËÆ§\r\n            </button>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg\"\r\n            >\r\n              ÂèñÊ∂à\r\n            </button>\r\n            <button\r\n              onClick={handleSave}\r\n              className=\"px-4 py-2 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg\"\r\n            >\r\n              ‰øùÂ≠ò\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAQA;AACA;AATA,yCAAyC;AACzC,2BAA2B;AAC3B,sBAAsB;AACtB,kCAAkC;AAClC,6BAA6B;AAE7B;;;;AAMA,SAAS;AACT,MAAM,mBAAmB;IAAC;IAAU;CAAW;AAC/C,MAAM,mBAAmB;IAAC;IAAgB;IAAiB;IAAgB;CAAgB;AAC3F,MAAM,sBAAsB;IAAC;IAAY;CAAW;AAS7C,SAAS,cAAc,EAC5B,OAAO,EACP,YAAY,EACZ,cAAc,EACd,gBAAgB,EACG;IACnB,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,IAAA,iNAAQ,EAAC;IACjE,MAAM,YAAY,SAAS,eAAe,EAAE;IAC5C,MAAM,cAAc,SAAS,gBAAgB,CAAC;IAC9C,MAAM,eAAe,SAAS,iBAAiB;IAE/C,aAAa;IACb,MAAM,YAAY,UAAU,MAAM,CAAC,CAAA,IAAK,iBAAiB,QAAQ,CAAC;IAClE,MAAM,eAAe,UAAU,MAAM,CAAC,CAAA,IAAK,iBAAiB,QAAQ,CAAC;IACrE,MAAM,eAAe,UAAU,MAAM,CAAC,CAAA,IAAK,oBAAoB,QAAQ,CAAC;IAExE,OAAO;IACP,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAgB;IAChE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAgB;IAClE,MAAM,cAAc,IAAA,+MAAM,EAAC;IAE3B,MAAM,kBAAkB,CAAC,GAAoB;QAC3C,gBAAgB;QAChB,EAAE,YAAY,CAAC,aAAa,GAAG;QAC/B,EAAE,YAAY,CAAC,OAAO,CAAC,cAAc;IACvC;IAEA,MAAM,gBAAgB;QACpB,gBAAgB;QAChB,iBAAiB;QACjB,YAAY,OAAO,GAAG;IACxB;IAEA,MAAM,kBAAkB,CAAC,GAAoB;QAC3C,EAAE,cAAc;QAChB,YAAY,OAAO;QACnB,IAAI,iBAAiB,QAAQ,CAAC,QAAQ;YACpC,iBAAiB;QACnB;IACF;IAEA,MAAM,kBAAkB;QACtB,YAAY,OAAO;QACnB,IAAI,YAAY,OAAO,KAAK,GAAG;YAC7B,iBAAiB;QACnB;IACF;IAEA,MAAM,iBAAiB,CAAC;QACtB,EAAE,cAAc;IAClB;IAEA,MAAM,aAAa,CAAC,GAAoB;QACtC,EAAE,cAAc;QAEhB,IAAI,CAAC,gBAAgB,iBAAiB,aAAa;YACjD;YACA;QACF;QAEA,WAAW;QACX,MAAM,YAAY;eAAI;SAAa;QACnC,MAAM,UAAU,UAAU,OAAO,CAAC;QAClC,MAAM,UAAU,UAAU,OAAO,CAAC;QAElC,IAAI,YAAY,CAAC,KAAK,YAAY,CAAC,GAAG;YACpC,UAAU,MAAM,CAAC,SAAS;YAC1B,UAAU,MAAM,CAAC,SAAS,GAAG;YAE7B,SAAS;YACT,MAAM,WAAW;mBAAI;mBAAc;mBAAc;aAAa;YAC9D,iBAAiB;QACnB;QAEA;IACF;IAEA,MAAM,kBAAkB,CAAC,OAAe;QACtC,MAAM,SAAS,WAAW,CAAC,MAAM,IAAI;QACrC,MAAM,aAAa,4HAAY,CAAC,OAAO,IAAI,4HAAY,CAAC,OAAO;QAC/D,MAAM,YAAY,UAAU;QAC5B,MAAM,aAAa,iBAAiB;QACpC,MAAM,aAAa,kBAAkB;QAErC,qBACE,8OAAC;YAEC,WAAW;YACX,aAAa,cAAc,CAAC,IAAM,gBAAgB,GAAG,SAAS;YAC9D,WAAW,cAAc,gBAAgB;YACzC,aAAa,cAAc,CAAC,IAAM,gBAAgB,GAAG,SAAS;YAC9D,aAAa,cAAc,kBAAkB;YAC7C,YAAY,cAAc,iBAAiB;YAC3C,QAAQ,cAAc,CAAC,IAAM,WAAW,GAAG,SAAS;YACpD,WAAW,IAAA,kHAAE,EACX,wCACA,cAAc,cACd,cAAc;sBAGhB,cAAA,8OAAC;gBACC,SAAS,IAAM,eAAe;gBAC9B,WAAW,IAAA,kHAAE,EACX,mFACA,YACI,mCACA,oCACJ,eAAe;;oBAIhB,6BACC,8OAAC;wBAAK,WAAU;kCAAoC;;;;;;kCAItD,8OAAC;wBACC,WAAW,IAAA,kHAAE,EACX,sCACA,WAAW,eAAe,gBAC1B,WAAW,iBAAiB,iBAC5B,WAAW,aAAa;;;;;;kCAK5B,8OAAC;wBAAK,WAAU;kCACb,2HAAW,CAAC,MAAM,IAAI;;;;;;kCAIzB,8OAAC;wBAAK,WAAW,IAAA,kHAAE,EAAC,WAAW,WAAW,KAAK;kCAC5C,WAAW,KAAK;;;;;;;;;;;;WA9ChB;;;;;IAmDX;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCACX,SAAS,QAAQ;;;;;;oBAEnB,yBACC,8OAAC;wBAAE,WAAU;;4BAA6B;4BACpC,QAAQ,OAAO;;;;;;;;;;;;;0BAMzB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAkE;;;;;;oBAK/E,UAAU,GAAG,CAAC,CAAA,QAAS,gBAAgB,OAAO;oBAG9C,aAAa,MAAM,GAAG,mBACrB,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;kDAAK;;;;;;kDACN,8OAAC;kDAAK;;;;;;;;;;;;4BAEP,aAAa,GAAG,CAAC,CAAA,QAAS,gBAAgB,OAAO;;;;;;;oBAKrD,aAAa,GAAG,CAAC,CAAA,QAAS,gBAAgB,OAAO;;;;;;;0BAIpD,8OAAC;gBAAI,WAAU;;;;;;0BAGf,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAkE;;;;;;kCAIhF,8OAAC;wBACC,SAAS,IAAM,wBAAwB;wBACvC,WAAU;kCACX;;;;;;kCAID,8OAAC;wBAAO,WAAU;kCAAuH;;;;;;kCAIzI,8OAAC;wBAAO,WAAU;kCAAuH;;;;;;kCAIzI,8OAAC;wBAAO,WAAU;kCAAuH;;;;;;;;;;;;YAM1I,wBAAwB,yBACvB,8OAAC;gBACC,SAAS;gBACT,SAAS,IAAM,wBAAwB;gBACvC,QAAQ;;;;;;;;;;;;AAKlB;AAQA,SAAS,sBAAsB,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAA8B;IACrF,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EACtC,QAAQ,cAAc,IAAI,CAAC;IAG7B,MAAM,YAAY;QAChB;YAAE,IAAI;YAAU,MAAM;YAAQ,MAAM;QAAiB;QACrD;YAAE,IAAI;YAAY,MAAM;YAAS,MAAM;QAAgB;QACvD;YAAE,IAAI;YAAgB,MAAM;YAAQ,MAAM;QAAgB;QAC1D;YAAE,IAAI;YAAiB,MAAM;YAAQ,MAAM;QAAiB;QAC5D;YAAE,IAAI;YAAgB,MAAM;YAAQ,MAAM;QAAgB;QAC1D;YAAE,IAAI;YAAiB,MAAM;YAAQ,MAAM;QAAgB;QAC3D;YAAE,IAAI;YAAY,MAAM;YAAS,MAAM;QAAgB;QACvD;YAAE,IAAI;YAAY,MAAM;YAAM,MAAM;QAAgB;KACrD;IAED,MAAM,eAAe,CAAC;QACpB,YAAY,CAAC,OAAS,CAAC;gBACrB,GAAG,IAAI;gBACP,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,MAAM;YACvB,CAAC;IACH;IAEA,MAAM,aAAa;QACjB,SAAS;QACT;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCAA4B;;;;;;sCAC1C,8OAAC;4BAAE,WAAU;sCAA6B;;;;;;;;;;;;8BAK5C,8OAAC;oBAAI,WAAU;8BACZ,UAAU,GAAG,CAAC,CAAC,sBACd,8OAAC;4BAEC,WAAU;;8CAEV,8OAAC;oCACC,MAAK;oCACL,SAAS,QAAQ,CAAC,MAAM,EAAE,CAAC,KAAK;oCAChC,UAAU,IAAM,aAAa,MAAM,EAAE;oCACrC,WAAU;;;;;;8CAEZ,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;sDAAyB,MAAM,IAAI;;;;;;sDAClD,8OAAC;4CAAI,WAAU;sDAAgC,MAAM,IAAI;;;;;;;;;;;;8CAE3D,8OAAC;oCAAK,WAAW,CAAC,4BAA4B,EAC5C,QAAQ,CAAC,MAAM,EAAE,CAAC,KAAK,QACnB,mCACA,oCACJ;8CACC,QAAQ,CAAC,MAAM,EAAE,CAAC,KAAK,QAAQ,OAAO;;;;;;;2BAlBpC,MAAM,EAAE;;;;;;;;;;8BAwBnB,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCACC,SAAS,IAAM,YAAY,UAAU,MAAM,CAAC,CAAC,KAAK,IAAM,CAAC;gDAAE,GAAG,GAAG;gDAAE,CAAC,EAAE,EAAE,CAAC,EAAE;4CAAK,CAAC,GAAG,CAAC;oCACrF,WAAU;8CACX;;;;;;8CAGD,8OAAC;oCACC,SAAS,IAAM,YAAY,UAAU,MAAM,CAAC,CAAC,KAAK,IAAM,CAAC;gDAAE,GAAG,GAAG;gDAAE,CAAC,EAAE,EAAE,CAAC,EAAE;4CAAM,CAAC,GAAG,CAAC;oCACtF,WAAU;8CACX;;;;;;;;;;;;sCAIH,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;8CAGD,8OAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQb"}},
    {"offset": {"line": 659, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/lib/api.ts"],"sourcesContent":["// frontend/lib/api.ts\r\n// ÂäüËÉΩ: APIÂÆ¢Êà∑Á´ØÔºåÂ∞ÅË£ÖÂêéÁ´ØAPIË∞ÉÁî®\r\n// ‰∏ªË¶ÅÂáΩÊï∞: fetchAPI, streamAPI\r\n// Êï∞ÊçÆÁªìÊûÑ: Project, Field, ChatMessage\r\n\r\nconst API_BASE = process.env.BACKEND_URL || \"http://localhost:8000\";\r\n\r\n// ============== Types ==============\r\n\r\nexport interface Project {\r\n  id: string;\r\n  name: string;\r\n  version: number;\r\n  version_note: string;\r\n  creator_profile_id: string | null;\r\n  current_phase: string;\r\n  phase_order: string[];\r\n  phase_status: Record<string, string>;\r\n  agent_autonomy: Record<string, boolean>;\r\n  golden_context: Record<string, string>;\r\n  use_deep_research: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface Field {\r\n  id: string;\r\n  project_id: string;\r\n  phase: string;\r\n  name: string;\r\n  field_type: string;\r\n  content: string;\r\n  status: string;\r\n  ai_prompt: string;\r\n  pre_questions: string[];\r\n  pre_answers: Record<string, string>;\r\n  dependencies: {\r\n    depends_on: string[];\r\n    dependency_type: string;\r\n  };\r\n  template_id: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface CreatorProfile {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  traits: Record<string, any>;\r\n  created_at: string;\r\n}\r\n\r\nexport interface ChatMessage {\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n}\r\n\r\nexport interface ChatResponse {\r\n  message: string;\r\n  phase: string;\r\n  phase_status: Record<string, string>;\r\n  waiting_for_human: boolean;\r\n}\r\n\r\nexport interface Persona {\r\n  source: string;\r\n  name: string;\r\n  background: string;\r\n  story: string;\r\n}\r\n\r\nexport interface SimulationRecord {\r\n  id: string;\r\n  project_id: string;\r\n  simulator_id: string;\r\n  target_field_ids: string[];\r\n  persona: Persona;\r\n  interaction_log: any[];\r\n  feedback: {\r\n    scores: Record<string, number>;\r\n    comments: Record<string, string>;\r\n    overall: string;\r\n  };\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface PersonaFromResearch {\r\n  name: string;\r\n  background: string;\r\n  story: string;\r\n}\r\n\r\n// ============== API Functions ==============\r\n\r\nasync function fetchAPI<T>(\r\n  endpoint: string,\r\n  options: RequestInit = {}\r\n): Promise<T> {\r\n  const url = `${API_BASE}${endpoint}`;\r\n  \r\n  const response = await fetch(url, {\r\n    ...options,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      ...options.headers,\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({ detail: \"Unknown error\" }));\r\n    // Â§ÑÁêÜPydanticÈ™åËØÅÈîôËØØÊ†ºÂºè (detailÂèØËÉΩÊòØÊï∞ÁªÑ)\r\n    let errorMessage: string;\r\n    if (typeof error.detail === \"string\") {\r\n      errorMessage = error.detail;\r\n    } else if (Array.isArray(error.detail)) {\r\n      errorMessage = error.detail.map((e: any) => e.msg || e.message || JSON.stringify(e)).join(\"; \");\r\n    } else {\r\n      errorMessage = `API error: ${response.status}`;\r\n    }\r\n    throw new Error(errorMessage);\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n// ============== Project API ==============\r\n\r\nexport const projectAPI = {\r\n  list: () => fetchAPI<Project[]>(\"/api/projects/\"),\r\n  \r\n  get: (id: string) => fetchAPI<Project>(`/api/projects/${id}`),\r\n  \r\n  create: (data: { name: string; creator_profile_id?: string; use_deep_research?: boolean }) =>\r\n    fetchAPI<Project>(\"/api/projects/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  update: (id: string, data: Partial<Project>) =>\r\n    fetchAPI<Project>(`/api/projects/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  delete: (id: string) =>\r\n    fetchAPI<{ message: string }>(`/api/projects/${id}`, { method: \"DELETE\" }),\r\n  \r\n  createVersion: (id: string, version_note: string) =>\r\n    fetchAPI<Project>(`/api/projects/${id}/versions`, {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ version_note }),\r\n    }),\r\n};\r\n\r\n// ============== Field API ==============\r\n\r\nexport const fieldAPI = {\r\n  listByProject: (projectId: string, phase?: string) => {\r\n    const query = phase ? `?phase=${phase}` : \"\";\r\n    return fetchAPI<Field[]>(`/api/fields/project/${projectId}${query}`);\r\n  },\r\n  \r\n  get: (id: string) => fetchAPI<Field>(`/api/fields/${id}`),\r\n  \r\n  create: (data: Partial<Field>) =>\r\n    fetchAPI<Field>(\"/api/fields/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  update: (id: string, data: Partial<Field>) =>\r\n    fetchAPI<Field>(`/api/fields/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  delete: (id: string) =>\r\n    fetchAPI<{ message: string }>(`/api/fields/${id}`, { method: \"DELETE\" }),\r\n  \r\n  generate: (id: string, pre_answers: Record<string, string> = {}) =>\r\n    fetchAPI<Field>(`/api/fields/${id}/generate`, {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ pre_answers }),\r\n    }),\r\n};\r\n\r\n// ============== Agent API ==============\r\n\r\nexport const agentAPI = {\r\n  chat: (projectId: string, message: string, currentPhase?: string) =>\r\n    fetchAPI<ChatResponse>(\"/api/agent/chat\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        message,\r\n        current_phase: currentPhase,\r\n      }),\r\n    }),\r\n  \r\n  advance: (projectId: string) =>\r\n    fetchAPI<ChatResponse>(\"/api/agent/advance\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        message: \"ÁªßÁª≠\",\r\n      }),\r\n    }),\r\n  \r\n  stream: async function* (\r\n    projectId: string,\r\n    message: string,\r\n    currentPhase?: string\r\n  ): AsyncGenerator<{ node?: string; content?: string; done?: boolean; error?: string }> {\r\n    const response = await fetch(`${API_BASE}/api/agent/stream`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        message,\r\n        current_phase: currentPhase,\r\n      }),\r\n    });\r\n\r\n    const reader = response.body?.getReader();\r\n    const decoder = new TextDecoder();\r\n\r\n    if (!reader) return;\r\n\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      if (done) break;\r\n\r\n      const text = decoder.decode(value);\r\n      const lines = text.split(\"\\n\");\r\n\r\n      for (const line of lines) {\r\n        if (line.startsWith(\"data: \")) {\r\n          try {\r\n            const data = JSON.parse(line.slice(6));\r\n            yield data;\r\n          } catch {\r\n            // Ignore parse errors\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\n// ============== Settings API ==============\r\n\r\nexport const settingsAPI = {\r\n  // System Prompts\r\n  listSystemPrompts: () =>\r\n    fetchAPI<any[]>(\"/api/settings/system-prompts\"),\r\n  \r\n  updateSystemPrompt: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/system-prompts/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n\r\n  // Creator Profiles\r\n  listCreatorProfiles: () =>\r\n    fetchAPI<CreatorProfile[]>(\"/api/settings/creator-profiles\"),\r\n  \r\n  createCreatorProfile: (data: Partial<CreatorProfile>) =>\r\n    fetchAPI<CreatorProfile>(\"/api/settings/creator-profiles\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateCreatorProfile: (id: string, data: Partial<CreatorProfile>) =>\r\n    fetchAPI<CreatorProfile>(`/api/settings/creator-profiles/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteCreatorProfile: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/creator-profiles/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Field Templates\r\n  listFieldTemplates: () =>\r\n    fetchAPI<any[]>(\"/api/settings/field-templates\"),\r\n  \r\n  createFieldTemplate: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/field-templates\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateFieldTemplate: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/field-templates/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteFieldTemplate: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/field-templates/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Channels\r\n  listChannels: () =>\r\n    fetchAPI<any[]>(\"/api/settings/channels\"),\r\n  \r\n  createChannel: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/channels\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateChannel: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/channels/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteChannel: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/channels/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Simulators\r\n  listSimulators: () =>\r\n    fetchAPI<any[]>(\"/api/settings/simulators\"),\r\n  \r\n  createSimulator: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/simulators\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateSimulator: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/simulators/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteSimulator: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/simulators/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Agent Settings\r\n  getAgentSettings: () =>\r\n    fetchAPI<any>(\"/api/settings/agent\"),\r\n  \r\n  updateAgentSettings: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/agent\", {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  // Logs\r\n  listLogs: (projectId?: string) => {\r\n    const query = projectId ? `?project_id=${projectId}` : \"\";\r\n    return fetchAPI<any[]>(`/api/settings/logs${query}`);\r\n  },\r\n  \r\n  exportLogs: (projectId?: string) => {\r\n    const query = projectId ? `?project_id=${projectId}` : \"\";\r\n    return fetchAPI<any>(`/api/settings/logs/export${query}`);\r\n  },\r\n};\r\n\r\n// ============== Simulation API ==============\r\n\r\nexport const simulationAPI = {\r\n  // Ëé∑ÂèñÈ°πÁõÆÁöÑÊ®°ÊãüËÆ∞ÂΩïÂàóË°®\r\n  list: (projectId: string) =>\r\n    fetchAPI<SimulationRecord[]>(`/api/simulations/project/${projectId}`),\r\n  \r\n  // Ëé∑ÂèñÊ®°ÊãüËÆ∞ÂΩïËØ¶ÊÉÖ\r\n  get: (id: string) =>\r\n    fetchAPI<SimulationRecord>(`/api/simulations/${id}`),\r\n  \r\n  // ÂàõÂª∫Ê®°ÊãüËÆ∞ÂΩï\r\n  create: (data: {\r\n    project_id: string;\r\n    simulator_id: string;\r\n    target_field_ids: string[];\r\n    persona: Persona;\r\n  }) =>\r\n    fetchAPI<SimulationRecord>(\"/api/simulations/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  // Âà†Èô§Ê®°ÊãüËÆ∞ÂΩï\r\n  delete: (id: string) =>\r\n    fetchAPI<any>(`/api/simulations/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Ëé∑ÂèñÊ∂àË¥πËÄÖË∞ÉÁ†î‰∏≠ÁöÑ‰∫∫Áâ©Â∞è‰º†\r\n  getPersonasFromResearch: (projectId: string) =>\r\n    fetchAPI<PersonaFromResearch[]>(`/api/simulations/project/${projectId}/personas`),\r\n};\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 893, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/content-panel.tsx"],"sourcesContent":["// frontend/components/content-panel.tsx\r\n// ÂäüËÉΩ: ‰∏≠Ê†èÂÜÖÂÆπÂ±ïÁ§∫Èù¢ÊùøÔºåÊîØÊåÅÂ≠óÊÆµ‰æùËµñÈÄâÊã©ÂíåÁîüÊàê\r\n// ‰∏ªË¶ÅÁªÑ‰ª∂: ContentPanel, FieldCard\r\n// Êñ∞Â¢û: ‰æùËµñÈÄâÊã©ÂºπÁ™ó„ÄÅÁîüÊàêÊåâÈíÆ„ÄÅ‰æùËµñÁä∂ÊÄÅÊòæÁ§∫„ÄÅÊ®°ÊãüÈò∂ÊÆµÁâπÊÆäÈù¢Êùø\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { PHASE_NAMES } from \"@/lib/utils\";\r\nimport { fieldAPI } from \"@/lib/api\";\r\nimport type { Field } from \"@/lib/api\";\r\nimport { SimulationPanel } from \"./simulation-panel\";\r\n\r\ninterface ContentPanelProps {\r\n  projectId: string | null;\r\n  currentPhase: string;\r\n  fields: Field[];\r\n  onFieldUpdate?: (fieldId: string, content: string) => void;\r\n  onFieldsChange?: () => void;\r\n}\r\n\r\nexport function ContentPanel({\r\n  projectId,\r\n  currentPhase,\r\n  fields,\r\n  onFieldUpdate,\r\n  onFieldsChange,\r\n}: ContentPanelProps) {\r\n  const phaseFields = fields.filter((f) => f.phase === currentPhase);\r\n  const allCompletedFields = fields.filter((f) => f.status === \"completed\");\r\n\r\n  if (!projectId) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full text-zinc-500\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-lg mb-2\">ËØ∑ÈÄâÊã©ÊàñÂàõÂª∫‰∏Ä‰∏™È°πÁõÆ</p>\r\n          <p className=\"text-sm\">Âú®Â∑¶‰æßÈÄâÊã©È°πÁõÆÂºÄÂßãÂ∑•‰Ωú</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-4xl mx-auto\">\r\n      {/* Èò∂ÊÆµÊ†áÈ¢ò */}\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-2xl font-bold text-zinc-100\">\r\n          {PHASE_NAMES[currentPhase] || currentPhase}\r\n        </h1>\r\n        <p className=\"text-zinc-500 mt-1\">\r\n          {getPhaseDescription(currentPhase)}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Â≠óÊÆµÂàóË°® */}\r\n      {phaseFields.length > 0 ? (\r\n        <div className=\"space-y-6\">\r\n          {phaseFields.map((field) => (\r\n            <FieldCard\r\n              key={field.id}\r\n              field={field}\r\n              allFields={fields}\r\n              onUpdate={(content) => onFieldUpdate?.(field.id, content)}\r\n              onFieldsChange={onFieldsChange}\r\n            />\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-12 text-zinc-500\">\r\n          <p>ÂΩìÂâçÈò∂ÊÆµÊöÇÊó†ÂÜÖÂÆπ</p>\r\n          <p className=\"text-sm mt-2\">\r\n            Âú®Âè≥‰æß‰∏é AI Agent ÂØπËØùÂºÄÂßãÁîü‰∫ßÂÜÖÂÆπ\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface FieldCardProps {\r\n  field: Field;\r\n  allFields: Field[];\r\n  onUpdate?: (content: string) => void;\r\n  onFieldsChange?: () => void;\r\n}\r\n\r\nfunction FieldCard({ field, allFields, onUpdate, onFieldsChange }: FieldCardProps) {\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [content, setContent] = useState(field.content);\r\n  const [showDependencyModal, setShowDependencyModal] = useState(false);\r\n  const [isGenerating, setIsGenerating] = useState(false);\r\n  const [generatingContent, setGeneratingContent] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    setContent(field.content);\r\n  }, [field.content]);\r\n\r\n  // Ëé∑Âèñ‰æùËµñÂ≠óÊÆµ‰ø°ÊÅØ\r\n  const dependsOnIds = field.dependencies?.depends_on || [];\r\n  const dependencyFields = allFields.filter((f) => dependsOnIds.includes(f.id));\r\n  const unmetDependencies = dependencyFields.filter((f) => f.status !== \"completed\");\r\n  const canGenerate = unmetDependencies.length === 0;\r\n\r\n  const handleSave = () => {\r\n    onUpdate?.(content);\r\n    setIsEditing(false);\r\n  };\r\n\r\n  const handleGenerate = async () => {\r\n    if (!canGenerate) {\r\n      alert(`ËØ∑ÂÖàÂÆåÊàê‰æùËµñÂ≠óÊÆµ: ${unmetDependencies.map(f => f.name).join(\", \")}`);\r\n      return;\r\n    }\r\n\r\n    setIsGenerating(true);\r\n    setGeneratingContent(\"\");\r\n\r\n    try {\r\n      // ‰ΩøÁî®ÊµÅÂºèÁîüÊàê\r\n      const response = await fetch(`http://localhost:8000/api/fields/${field.id}/generate/stream`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ pre_answers: field.pre_answers || {} }),\r\n      });\r\n\r\n      const reader = response.body?.getReader();\r\n      const decoder = new TextDecoder();\r\n\r\n      if (reader) {\r\n        while (true) {\r\n          const { done, value } = await reader.read();\r\n          if (done) break;\r\n\r\n          const text = decoder.decode(value);\r\n          const lines = text.split(\"\\n\");\r\n\r\n          for (const line of lines) {\r\n            if (line.startsWith(\"data: \")) {\r\n              try {\r\n                const data = JSON.parse(line.slice(6));\r\n                if (data.chunk) {\r\n                  setGeneratingContent((prev) => prev + data.chunk);\r\n                }\r\n                if (data.done) {\r\n                  onFieldsChange?.();\r\n                }\r\n              } catch {}\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error(\"ÁîüÊàêÂ§±Ë¥•:\", err);\r\n      alert(\"ÁîüÊàêÂ§±Ë¥•: \" + (err instanceof Error ? err.message : \"Êú™Áü•ÈîôËØØ\"));\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  };\r\n\r\n  const handleUpdateDependencies = async (newDependsOn: string[]) => {\r\n    try {\r\n      await fieldAPI.update(field.id, {\r\n        dependencies: {\r\n          depends_on: newDependsOn,\r\n          dependency_type: field.dependencies?.dependency_type || \"all\",\r\n        },\r\n      });\r\n      onFieldsChange?.();\r\n      setShowDependencyModal(false);\r\n    } catch (err) {\r\n      alert(\"Êõ¥Êñ∞‰æùËµñÂ§±Ë¥•: \" + (err instanceof Error ? err.message : \"Êú™Áü•ÈîôËØØ\"));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-surface-2 rounded-xl border border-surface-3 overflow-hidden\">\r\n      {/* Â≠óÊÆµÂ§¥ÈÉ® */}\r\n      <div className=\"px-4 py-3 border-b border-surface-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h3 className=\"font-medium text-zinc-200\">{field.name}</h3>\r\n            <div className=\"flex items-center gap-2 mt-1\">\r\n              <span className={`text-xs px-2 py-0.5 rounded ${\r\n                field.status === \"completed\" \r\n                  ? \"bg-green-600/20 text-green-400\"\r\n                  : field.status === \"generating\"\r\n                  ? \"bg-yellow-600/20 text-yellow-400\"\r\n                  : \"bg-zinc-600/20 text-zinc-400\"\r\n              }`}>\r\n                {field.status === \"completed\" ? \"Â∑≤ÁîüÊàê\" \r\n                  : field.status === \"generating\" ? \"ÁîüÊàê‰∏≠...\" \r\n                  : \"ÂæÖÁîüÊàê\"}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex gap-2\">\r\n            {field.status !== \"completed\" && !isGenerating && (\r\n              <button\r\n                onClick={handleGenerate}\r\n                disabled={!canGenerate}\r\n                className={`px-3 py-1 text-sm rounded-lg transition-colors ${\r\n                  canGenerate\r\n                    ? \"bg-brand-600 hover:bg-brand-700 text-white\"\r\n                    : \"bg-zinc-700 text-zinc-500 cursor-not-allowed\"\r\n                }`}\r\n                title={canGenerate ? \"ÁîüÊàêÂÜÖÂÆπ\" : `‰æùËµñÊú™Êª°Ë∂≥: ${unmetDependencies.map(f => f.name).join(\", \")}`}\r\n              >\r\n                ÁîüÊàê\r\n              </button>\r\n            )}\r\n            \r\n            {isEditing ? (\r\n              <>\r\n                <button\r\n                  onClick={handleSave}\r\n                  className=\"px-3 py-1 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg transition-colors\"\r\n                >\r\n                  ‰øùÂ≠ò\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    setContent(field.content);\r\n                    setIsEditing(false);\r\n                  }}\r\n                  className=\"px-3 py-1 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg transition-colors\"\r\n                >\r\n                  ÂèñÊ∂à\r\n                </button>\r\n              </>\r\n            ) : (\r\n              <button\r\n                onClick={() => setIsEditing(true)}\r\n                className=\"px-3 py-1 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg transition-colors\"\r\n              >\r\n                ÁºñËæë\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* ‰æùËµñÂÖ≥Á≥ªÊòæÁ§∫ */}\r\n        <div className=\"mt-2 flex items-center gap-2 flex-wrap\">\r\n          <button\r\n            onClick={() => setShowDependencyModal(true)}\r\n            className=\"text-xs text-zinc-500 hover:text-zinc-300 flex items-center gap-1\"\r\n          >\r\n            <span>üìé ‰æùËµñ:</span>\r\n            {dependencyFields.length > 0 ? (\r\n              dependencyFields.map((df) => (\r\n                <span\r\n                  key={df.id}\r\n                  className={`px-1.5 py-0.5 rounded text-xs ${\r\n                    df.status === \"completed\"\r\n                      ? \"bg-green-600/20 text-green-400\"\r\n                      : \"bg-red-600/20 text-red-400\"\r\n                  }`}\r\n                >\r\n                  {df.name}\r\n                </span>\r\n              ))\r\n            ) : (\r\n              <span className=\"text-zinc-600\">Êó†</span>\r\n            )}\r\n            <span className=\"text-zinc-600 ml-1\">ÔºàÁÇπÂáªÁºñËæëÔºâ</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Â≠óÊÆµÂÜÖÂÆπ */}\r\n      <div className=\"p-4\">\r\n        {isGenerating ? (\r\n          <div className=\"bg-surface-1 border border-surface-3 rounded-lg p-3\">\r\n            <div className=\"text-xs text-brand-400 mb-2\">Ê≠£Âú®ÁîüÊàê...</div>\r\n            <div className=\"whitespace-pre-wrap text-zinc-300 animate-pulse\">\r\n              {generatingContent || \"‚è≥ ÂáÜÂ§á‰∏≠...\"}\r\n            </div>\r\n          </div>\r\n        ) : isEditing ? (\r\n          <textarea\r\n            value={content}\r\n            onChange={(e) => setContent(e.target.value)}\r\n            className=\"w-full min-h-[200px] bg-surface-1 border border-surface-3 rounded-lg p-3 text-zinc-200 resize-y focus:outline-none focus:ring-2 focus:ring-brand-500\"\r\n          />\r\n        ) : (\r\n          <div className=\"prose prose-invert max-w-none\">\r\n            {field.content ? (\r\n              <div className=\"whitespace-pre-wrap text-zinc-300\">\r\n                {field.content}\r\n              </div>\r\n            ) : (\r\n              <p className=\"text-zinc-500 italic\">ÊöÇÊó†ÂÜÖÂÆπÔºåÁÇπÂáª\"ÁîüÊàê\"ÊåâÈíÆÂºÄÂßã</p>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* ‰æùËµñÈÄâÊã©ÂºπÁ™ó */}\r\n      {showDependencyModal && (\r\n        <DependencyModal\r\n          field={field}\r\n          allFields={allFields}\r\n          onClose={() => setShowDependencyModal(false)}\r\n          onSave={handleUpdateDependencies}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface DependencyModalProps {\r\n  field: Field;\r\n  allFields: Field[];\r\n  onClose: () => void;\r\n  onSave: (dependsOn: string[]) => void;\r\n}\r\n\r\nfunction DependencyModal({ field, allFields, onClose, onSave }: DependencyModalProps) {\r\n  const [selectedIds, setSelectedIds] = useState<string[]>(\r\n    field.dependencies?.depends_on || []\r\n  );\r\n\r\n  // ÂèØÈÄâÁöÑ‰æùËµñÂ≠óÊÆµÔºàÊéíÈô§Ëá™Â∑±Ôºâ\r\n  const availableFields = allFields.filter((f) => f.id !== field.id);\r\n\r\n  const toggleField = (id: string) => {\r\n    setSelectedIds((prev) =>\r\n      prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-surface-2 rounded-xl border border-surface-3 w-full max-w-lg max-h-[80vh] overflow-hidden\">\r\n        <div className=\"px-4 py-3 border-b border-surface-3\">\r\n          <h3 className=\"font-medium text-zinc-200\">ËÆæÁΩÆ‰æùËµñÂÖ≥Á≥ª</h3>\r\n          <p className=\"text-xs text-zinc-500 mt-1\">\r\n            ÈÄâÊã©ÁîüÊàê\"{field.name}\"ÂâçÈúÄË¶ÅÂÖàÂÆåÊàêÁöÑÂ≠óÊÆµ\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"p-4 max-h-[50vh] overflow-y-auto space-y-2\">\r\n          {availableFields.length > 0 ? (\r\n            availableFields.map((f) => (\r\n              <label\r\n                key={f.id}\r\n                className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-surface-3 cursor-pointer\"\r\n              >\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={selectedIds.includes(f.id)}\r\n                  onChange={() => toggleField(f.id)}\r\n                  className=\"rounded\"\r\n                />\r\n                <div className=\"flex-1\">\r\n                  <div className=\"text-sm text-zinc-200\">{f.name}</div>\r\n                  <div className=\"text-xs text-zinc-500\">\r\n                    {f.phase} ¬∑ {f.status === \"completed\" ? \"Â∑≤ÂÆåÊàê\" : \"Êú™ÂÆåÊàê\"}\r\n                  </div>\r\n                </div>\r\n                <span\r\n                  className={`w-2 h-2 rounded-full ${\r\n                    f.status === \"completed\" ? \"bg-green-500\" : \"bg-zinc-600\"\r\n                  }`}\r\n                />\r\n              </label>\r\n            ))\r\n          ) : (\r\n            <p className=\"text-zinc-500 text-center py-4\">ÊöÇÊó†ÂèØÈÄâÁöÑ‰æùËµñÂ≠óÊÆµ</p>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"px-4 py-3 border-t border-surface-3 flex justify-end gap-2\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg transition-colors\"\r\n          >\r\n            ÂèñÊ∂à\r\n          </button>\r\n          <button\r\n            onClick={() => onSave(selectedIds)}\r\n            className=\"px-4 py-2 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg transition-colors\"\r\n          >\r\n            ‰øùÂ≠ò\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getPhaseDescription(phase: string): string {\r\n  const descriptions: Record<string, string> = {\r\n    intent: \"ÊæÑÊ∏ÖÂÜÖÂÆπÁîü‰∫ßÁöÑÊ†∏ÂøÉÊÑèÂõæÂíåÁõÆÊ†á\",\r\n    research: \"Ë∞ÉÁ†îÁõÆÊ†áÁî®Êà∑Ôºå‰∫ÜËß£ÁóõÁÇπÂíåÈúÄÊ±Ç\",\r\n    design_inner: \"ËÆæËÆ°ÂÜÖÂÆπÁîü‰∫ßÊñπÊ°àÂíåÂ§ßÁ∫≤\",\r\n    produce_inner: \"Áîü‰∫ßÊ†∏ÂøÉÂÜÖÂÆπ\",\r\n    design_outer: \"ËÆæËÆ°Â§ñÂª∂‰º†Êí≠ÊñπÊ°à\",\r\n    produce_outer: \"‰∏∫ÂêÑÊ∏†ÈÅìÁîü‰∫ßËê•ÈîÄÂÜÖÂÆπ\",\r\n    simulate: \"Ê®°ÊãüÁî®Êà∑‰ΩìÈ™åÔºåÊî∂ÈõÜÂèçÈ¶à\",\r\n    evaluate: \"ÂÖ®Èù¢ËØÑ‰º∞ÂÜÖÂÆπË¥®Èáè\",\r\n  };\r\n  return descriptions[phase] || \"\";\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1503, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/agent-panel.tsx"],"sourcesContent":["// frontend/components/agent-panel.tsx\r\n// ÂäüËÉΩ: Âè≥Ê†èAI AgentÂØπËØùÈù¢ÊùøÔºåÊîØÊåÅ@ÂºïÁî®Êú∫Âà∂\r\n// ‰∏ªË¶ÅÁªÑ‰ª∂: AgentPanel, MessageBubble, MentionDropdown\r\n// @ÂºïÁî®: ËæìÂÖ•@ÂºπÂá∫Â∑≤ÁîüÊàêÂ≠óÊÆµÈÄâÊã©ËèúÂçï\r\n\r\n\"use client\";\r\n\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { cn, PHASE_NAMES } from \"@/lib/utils\";\r\nimport type { Field } from \"@/lib/api\";\r\n\r\ninterface Message {\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n}\r\n\r\ninterface AgentPanelProps {\r\n  projectId: string | null;\r\n  fields?: Field[];\r\n  onSendMessage?: (message: string) => Promise<string>;\r\n  isLoading?: boolean;\r\n}\r\n\r\nexport function AgentPanel({\r\n  projectId,\r\n  fields = [],\r\n  onSendMessage,\r\n  isLoading = false,\r\n}: AgentPanelProps) {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n  const [showMentions, setShowMentions] = useState(false);\r\n  const [mentionFilter, setMentionFilter] = useState(\"\");\r\n  const [mentionIndex, setMentionIndex] = useState(0);\r\n  const [cursorPosition, setCursorPosition] = useState(0);\r\n  \r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const mentionStartPos = useRef<number>(-1);\r\n\r\n  // ÂèØÂºïÁî®ÁöÑÂ≠óÊÆµÔºàÂ∑≤ÂÆåÊàêÁöÑÔºâ\r\n  const completedFields = fields.filter((f) => f.status === \"completed\");\r\n  \r\n  // ËøáÊª§ÂêéÁöÑÂ≠óÊÆµÂàóË°®\r\n  const filteredFields = completedFields.filter((f) =>\r\n    f.name.toLowerCase().includes(mentionFilter.toLowerCase()) ||\r\n    f.phase.toLowerCase().includes(mentionFilter.toLowerCase())\r\n  );\r\n\r\n  // Ëá™Âä®ÊªöÂä®Âà∞Â∫ïÈÉ®\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  const insertMention = useCallback((field: Field) => {\r\n    const beforeMention = input.slice(0, mentionStartPos.current);\r\n    const afterMention = input.slice(cursorPosition);\r\n    const newInput = `${beforeMention}@${field.name}${afterMention}`;\r\n    \r\n    setInput(newInput);\r\n    setShowMentions(false);\r\n    setMentionFilter(\"\");\r\n    mentionStartPos.current = -1;\r\n    \r\n    // ËÅöÁÑ¶ÂõûËæìÂÖ•Ê°Ü\r\n    setTimeout(() => {\r\n      inputRef.current?.focus();\r\n    }, 0);\r\n  }, [input, cursorPosition]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = e.target.value;\r\n    const selectionStart = e.target.selectionStart || 0;\r\n    \r\n    setInput(value);\r\n    setCursorPosition(selectionStart);\r\n    \r\n    // Ê£ÄÊµã@Á¨¶Âè∑\r\n    const lastAtPos = value.lastIndexOf(\"@\", selectionStart - 1);\r\n    \r\n    if (lastAtPos !== -1) {\r\n      const textAfterAt = value.slice(lastAtPos + 1, selectionStart);\r\n      // Â¶ÇÊûú@ÂêéÈù¢Ê≤°ÊúâÁ©∫Ê†ºÔºåÊòæÁ§∫ËèúÂçï\r\n      if (!textAfterAt.includes(\" \")) {\r\n        mentionStartPos.current = lastAtPos;\r\n        setMentionFilter(textAfterAt);\r\n        setShowMentions(true);\r\n        setMentionIndex(0);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    setShowMentions(false);\r\n    setMentionFilter(\"\");\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (showMentions && filteredFields.length > 0) {\r\n      if (e.key === \"ArrowDown\") {\r\n        e.preventDefault();\r\n        setMentionIndex((prev) => (prev + 1) % filteredFields.length);\r\n        return;\r\n      }\r\n      if (e.key === \"ArrowUp\") {\r\n        e.preventDefault();\r\n        setMentionIndex((prev) => (prev - 1 + filteredFields.length) % filteredFields.length);\r\n        return;\r\n      }\r\n      if (e.key === \"Enter\" || e.key === \"Tab\") {\r\n        e.preventDefault();\r\n        insertMention(filteredFields[mentionIndex]);\r\n        return;\r\n      }\r\n      if (e.key === \"Escape\") {\r\n        setShowMentions(false);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    if (e.key === \"Enter\" && !e.shiftKey && !showMentions) {\r\n      e.preventDefault();\r\n      handleSend();\r\n    }\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    if (!input.trim() || !projectId || sending) return;\r\n\r\n    const userMessage = input.trim();\r\n    setInput(\"\");\r\n    setSending(true);\r\n    setShowMentions(false);\r\n\r\n    // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ\r\n    setMessages((prev) => [...prev, { role: \"user\", content: userMessage }]);\r\n\r\n    try {\r\n      const response = await onSendMessage?.(userMessage);\r\n      \r\n      if (response) {\r\n        setMessages((prev) => [\r\n          ...prev,\r\n          { role: \"assistant\", content: response },\r\n        ]);\r\n      }\r\n    } catch (error) {\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          role: \"assistant\",\r\n          content: `Êä±Ê≠âÔºåÂèëÁîü‰∫ÜÈîôËØØÔºö${error instanceof Error ? error.message : \"Êú™Áü•ÈîôËØØ\"}`,\r\n        },\r\n      ]);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full\">\r\n      {/* Â§¥ÈÉ® */}\r\n      <div className=\"px-4 py-3 border-b border-surface-3\">\r\n        <h2 className=\"font-semibold text-zinc-100\">AI Agent</h2>\r\n        <p className=\"text-xs text-zinc-500\">\r\n          {projectId ? \"‰∏é Agent ÂØπËØùÊé®ËøõÂÜÖÂÆπÁîü‰∫ß\" : \"ËØ∑ÂÖàÈÄâÊã©È°πÁõÆ\"}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Ê∂àÊÅØÂàóË°® */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n        {messages.length === 0 && (\r\n          <div className=\"text-center text-zinc-500 py-8\">\r\n            <p>ÂºÄÂßãÂØπËØùÂêßÔºÅ</p>\r\n            <p className=\"text-sm mt-2\">\r\n              ‰Ω†ÂèØ‰ª•ËØ¥ \"ÂºÄÂßã\" Êù•ÂêØÂä®ÂÜÖÂÆπÁîü‰∫ßÊµÅÁ®ã\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {messages.map((msg, idx) => (\r\n          <MessageBubble key={idx} message={msg} />\r\n        ))}\r\n\r\n        {sending && (\r\n          <div className=\"flex items-center gap-2 text-zinc-500\">\r\n            <div className=\"w-2 h-2 bg-brand-500 rounded-full animate-pulse\" />\r\n            <span className=\"text-sm\">Agent Ê≠£Âú®ÊÄùËÄÉ...</span>\r\n          </div>\r\n        )}\r\n\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* ËæìÂÖ•Âå∫ */}\r\n      <div className=\"p-4 border-t border-surface-3\">\r\n        <div className=\"relative\">\r\n          {/* @ÂºïÁî®‰∏ãÊãâËèúÂçï */}\r\n          {showMentions && filteredFields.length > 0 && (\r\n            <div className=\"absolute bottom-full left-0 right-0 mb-1 bg-surface-2 border border-surface-3 rounded-lg shadow-xl max-h-48 overflow-y-auto z-10\">\r\n              <div className=\"p-2 text-xs text-zinc-500 border-b border-surface-3\">\r\n                ÈÄâÊã©Ë¶ÅÂºïÁî®ÁöÑÂ≠óÊÆµ\r\n              </div>\r\n              {filteredFields.map((field, idx) => (\r\n                <button\r\n                  key={field.id}\r\n                  onClick={() => insertMention(field)}\r\n                  className={cn(\r\n                    \"w-full px-3 py-2 text-left hover:bg-surface-3 flex items-center gap-2\",\r\n                    idx === mentionIndex && \"bg-surface-3\"\r\n                  )}\r\n                >\r\n                  <span className=\"text-xs text-zinc-500\">{PHASE_NAMES[field.phase] || field.phase}</span>\r\n                  <span className=\"text-sm text-zinc-200\">{field.name}</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {showMentions && filteredFields.length === 0 && mentionFilter && (\r\n            <div className=\"absolute bottom-full left-0 right-0 mb-1 bg-surface-2 border border-surface-3 rounded-lg p-3 text-center text-sm text-zinc-500\">\r\n              Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÂ≠óÊÆµ\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-2\">\r\n            <input\r\n              ref={inputRef}\r\n              type=\"text\"\r\n              value={input}\r\n              onChange={handleInputChange}\r\n              onKeyDown={handleKeyDown}\r\n              placeholder={projectId ? \"ËæìÂÖ•Ê∂àÊÅØ... ‰ΩøÁî® @ ÂºïÁî®Â≠óÊÆµ\" : \"ËØ∑ÂÖàÈÄâÊã©È°πÁõÆ\"}\r\n              disabled={!projectId || sending}\r\n              className=\"flex-1 px-4 py-2 bg-surface-2 border border-surface-3 rounded-lg text-zinc-200 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-brand-500 disabled:opacity-50\"\r\n            />\r\n            <button\r\n              onClick={handleSend}\r\n              disabled={!projectId || !input.trim() || sending}\r\n              className=\"px-4 py-2 bg-brand-600 hover:bg-brand-700 disabled:bg-surface-3 disabled:cursor-not-allowed rounded-lg transition-colors\"\r\n            >\r\n              ÂèëÈÄÅ\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Âø´Êç∑Êìç‰Ωú */}\r\n        <div className=\"flex gap-2 mt-2\">\r\n          <QuickAction\r\n            label=\"ÁªßÁª≠\"\r\n            onClick={() => setInput(\"ÁªßÁª≠\")}\r\n            disabled={!projectId || sending}\r\n          />\r\n          <QuickAction\r\n            label=\"ÂºÄÂßãË∞ÉÁ†î\"\r\n            onClick={() => setInput(\"ÂºÄÂßãÊ∂àË¥πËÄÖË∞ÉÁ†î\")}\r\n            disabled={!projectId || sending}\r\n          />\r\n          <QuickAction\r\n            label=\"ËØÑ‰º∞\"\r\n            onClick={() => setInput(\"ËØÑ‰º∞ÂΩìÂâçÂÜÖÂÆπ\")}\r\n            disabled={!projectId || sending}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction MessageBubble({ message }: { message: Message }) {\r\n  const isUser = message.role === \"user\";\r\n\r\n  // È´ò‰∫Æ@ÂºïÁî®\r\n  const renderContent = (content: string) => {\r\n    const parts = content.split(/(@[\\u4e00-\\u9fffa-zA-Z0-9_]+)/g);\r\n    return parts.map((part, i) => {\r\n      if (part.startsWith(\"@\")) {\r\n        return (\r\n          <span key={i} className=\"text-brand-400 font-medium\">\r\n            {part}\r\n          </span>\r\n        );\r\n      }\r\n      return part;\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className={cn(\"flex\", isUser ? \"justify-end\" : \"justify-start\")}>\r\n      <div\r\n        className={cn(\r\n          \"max-w-[85%] px-4 py-2 rounded-2xl\",\r\n          isUser\r\n            ? \"bg-brand-600 text-white rounded-br-md\"\r\n            : \"bg-surface-3 text-zinc-200 rounded-bl-md\"\r\n        )}\r\n      >\r\n        <div className=\"whitespace-pre-wrap text-sm\">\r\n          {renderContent(message.content)}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction QuickAction({\r\n  label,\r\n  onClick,\r\n  disabled,\r\n}: {\r\n  label: string;\r\n  onClick: () => void;\r\n  disabled: boolean;\r\n}) {\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      disabled={disabled}\r\n      className=\"px-2 py-1 text-xs text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 disabled:opacity-50 disabled:cursor-not-allowed rounded transition-colors\"\r\n    >\r\n      {label}\r\n    </button>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1944, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/app/workspace/page.tsx"],"sourcesContent":["// frontend/app/workspace/page.tsx\r\n// ÂäüËÉΩ: ÂÜÖÂÆπÁîü‰∫ßÂ∑•‰ΩúÂè∞‰∏ªÈ°µÈù¢\r\n// ‰∏ªË¶ÅÁªÑ‰ª∂: WorkspacePage\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { WorkspaceLayout } from \"@/components/layout/workspace-layout\";\r\nimport { ProgressPanel } from \"@/components/progress-panel\";\r\nimport { ContentPanel } from \"@/components/content-panel\";\r\nimport { AgentPanel } from \"@/components/agent-panel\";\r\nimport { projectAPI, fieldAPI, agentAPI } from \"@/lib/api\";\r\nimport type { Project, Field } from \"@/lib/api\";\r\n\r\nexport default function WorkspacePage() {\r\n  const [projects, setProjects] = useState<Project[]>([]);\r\n  const [currentProject, setCurrentProject] = useState<Project | null>(null);\r\n  const [fields, setFields] = useState<Field[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Âä†ËΩΩÈ°πÁõÆÂàóË°®\r\n  useEffect(() => {\r\n    loadProjects();\r\n  }, []);\r\n\r\n  // Âä†ËΩΩÂΩìÂâçÈ°πÁõÆÁöÑÂ≠óÊÆµ\r\n  useEffect(() => {\r\n    if (currentProject) {\r\n      loadFields(currentProject.id);\r\n    }\r\n  }, [currentProject?.id]);\r\n\r\n  const loadProjects = async () => {\r\n    try {\r\n      const data = await projectAPI.list();\r\n      setProjects(data);\r\n      \r\n      // Ëá™Âä®ÈÄâÊã©Á¨¨‰∏Ä‰∏™È°πÁõÆ\r\n      if (data.length > 0 && !currentProject) {\r\n        setCurrentProject(data[0]);\r\n      }\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : \"Âä†ËΩΩÈ°πÁõÆÂ§±Ë¥•\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadFields = async (projectId: string) => {\r\n    try {\r\n      const data = await fieldAPI.listByProject(projectId);\r\n      setFields(data);\r\n    } catch (err) {\r\n      console.error(\"Âä†ËΩΩÂ≠óÊÆµÂ§±Ë¥•:\", err);\r\n    }\r\n  };\r\n\r\n  const handlePhaseClick = (phase: string) => {\r\n    if (currentProject) {\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        current_phase: phase,\r\n      });\r\n    }\r\n  };\r\n\r\n  const handlePhaseReorder = async (newPhaseOrder: string[]) => {\r\n    if (!currentProject) return;\r\n    \r\n    try {\r\n      // Êõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        phase_order: newPhaseOrder,\r\n      });\r\n      \r\n      // ‰øùÂ≠òÂà∞ÊúçÂä°Âô®\r\n      await projectAPI.update(currentProject.id, { phase_order: newPhaseOrder });\r\n    } catch (err) {\r\n      console.error(\"Êõ¥Êñ∞Èò∂ÊÆµÈ°∫Â∫èÂ§±Ë¥•:\", err);\r\n    }\r\n  };\r\n\r\n  const handleAutonomyChange = async (autonomy: Record<string, boolean>) => {\r\n    if (!currentProject) return;\r\n    \r\n    try {\r\n      // Êõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        agent_autonomy: autonomy,\r\n      });\r\n      \r\n      // ‰øùÂ≠òÂà∞ÊúçÂä°Âô®\r\n      await projectAPI.update(currentProject.id, { agent_autonomy: autonomy });\r\n    } catch (err) {\r\n      console.error(\"Êõ¥Êñ∞Ëá™‰∏ªÊùÉËÆæÁΩÆÂ§±Ë¥•:\", err);\r\n    }\r\n  };\r\n\r\n  const handleFieldUpdate = async (fieldId: string, content: string) => {\r\n    try {\r\n      await fieldAPI.update(fieldId, { content });\r\n      // ÈáçÊñ∞Âä†ËΩΩÂ≠óÊÆµ\r\n      if (currentProject) {\r\n        loadFields(currentProject.id);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Êõ¥Êñ∞Â≠óÊÆµÂ§±Ë¥•:\", err);\r\n    }\r\n  };\r\n\r\n  const handleSendMessage = async (message: string): Promise<string> => {\r\n    if (!currentProject) {\r\n      throw new Error(\"ËØ∑ÂÖàÈÄâÊã©È°πÁõÆ\");\r\n    }\r\n\r\n    const response = await agentAPI.chat(\r\n      currentProject.id,\r\n      message,\r\n      currentProject.current_phase\r\n    );\r\n\r\n    // Êõ¥Êñ∞È°πÁõÆÁä∂ÊÄÅ\r\n    if (response.phase_status) {\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        phase_status: response.phase_status,\r\n      });\r\n    }\r\n\r\n    // ÈáçÊñ∞Âä†ËΩΩÂ≠óÊÆµ\r\n    loadFields(currentProject.id);\r\n\r\n    return response.message;\r\n  };\r\n\r\n  const handleCreateProject = async () => {\r\n    const name = prompt(\"ËØ∑ËæìÂÖ•È°πÁõÆÂêçÁß∞:\");\r\n    if (!name) return;\r\n\r\n    try {\r\n      const project = await projectAPI.create({ name });\r\n      setProjects([...projects, project]);\r\n      setCurrentProject(project);\r\n    } catch (err) {\r\n      alert(\"ÂàõÂª∫È°πÁõÆÂ§±Ë¥•: \" + (err instanceof Error ? err.message : \"Êú™Áü•ÈîôËØØ\"));\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-surface-0\">\r\n        <div className=\"text-zinc-400\">Âä†ËΩΩ‰∏≠...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-screen flex flex-col\">\r\n      {/* È°∂ÈÉ®ÂØºËà™ */}\r\n      <header className=\"h-14 flex-shrink-0 border-b border-surface-3 bg-surface-1 flex items-center justify-between px-4\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <h1 className=\"text-lg font-semibold bg-gradient-to-r from-brand-400 to-brand-600 bg-clip-text text-transparent\">\r\n            ÂÜÖÂÆπÁîü‰∫ßÁ≥ªÁªü\r\n          </h1>\r\n          \r\n          {/* È°πÁõÆÈÄâÊã©Âô® */}\r\n          <select\r\n            value={currentProject?.id || \"\"}\r\n            onChange={(e) => {\r\n              const project = projects.find((p) => p.id === e.target.value);\r\n              setCurrentProject(project || null);\r\n            }}\r\n            className=\"px-3 py-1.5 bg-surface-2 border border-surface-3 rounded-lg text-sm text-zinc-200 focus:outline-none focus:ring-2 focus:ring-brand-500\"\r\n          >\r\n            <option value=\"\">ÈÄâÊã©È°πÁõÆ</option>\r\n            {projects.map((p) => (\r\n              <option key={p.id} value={p.id}>\r\n                {p.name} (v{p.version})\r\n              </option>\r\n            ))}\r\n          </select>\r\n          \r\n          <button\r\n            onClick={handleCreateProject}\r\n            className=\"px-3 py-1.5 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg transition-colors\"\r\n          >\r\n            + Êñ∞Âª∫È°πÁõÆ\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-4\">\r\n          <a\r\n            href=\"/settings\"\r\n            className=\"text-sm text-zinc-400 hover:text-zinc-200 transition-colors\"\r\n          >\r\n            ÂêéÂè∞ËÆæÁΩÆ\r\n          </a>\r\n        </div>\r\n      </header>\r\n\r\n      {/* ‰∏âÊ†èÂ∏ÉÂ±Ä */}\r\n      <div className=\"flex-1 overflow-hidden\">\r\n        <WorkspaceLayout\r\n          leftPanel={\r\n            <ProgressPanel\r\n              project={currentProject}\r\n              onPhaseClick={handlePhaseClick}\r\n              onPhaseReorder={handlePhaseReorder}\r\n              onAutonomyChange={handleAutonomyChange}\r\n            />\r\n          }\r\n          centerPanel={\r\n            <ContentPanel\r\n              projectId={currentProject?.id || null}\r\n              currentPhase={currentProject?.current_phase || \"intent\"}\r\n              fields={fields}\r\n              onFieldUpdate={handleFieldUpdate}\r\n              onFieldsChange={() => currentProject && loadFields(currentProject.id)}\r\n            />\r\n          }\r\n          rightPanel={\r\n            <AgentPanel\r\n              projectId={currentProject?.id || null}\r\n              fields={fields}\r\n              onSendMessage={handleSendMessage}\r\n            />\r\n          }\r\n        />\r\n      </div>\r\n\r\n      {/* ÈîôËØØÊèêÁ§∫ */}\r\n      {error && (\r\n        <div className=\"fixed bottom-4 right-4 px-4 py-2 bg-red-600 text-white rounded-lg\">\r\n          {error}\r\n          <button\r\n            onClick={() => setError(null)}\r\n            className=\"ml-2 text-red-200 hover:text-white\"\r\n          >\r\n            ‚úï\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}