{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/layout/workspace-layout.tsx"],"sourcesContent":["// frontend/components/layout/workspace-layout.tsx\r\n// 功能: 工作台三栏布局\r\n// 主要组件: WorkspaceLayout\r\n\r\n\"use client\";\r\n\r\nimport { ReactNode } from \"react\";\r\n\r\ninterface WorkspaceLayoutProps {\r\n  leftPanel: ReactNode;\r\n  centerPanel: ReactNode;\r\n  rightPanel: ReactNode;\r\n}\r\n\r\nexport function WorkspaceLayout({\r\n  leftPanel,\r\n  centerPanel,\r\n  rightPanel,\r\n}: WorkspaceLayoutProps) {\r\n  return (\r\n    <div className=\"flex h-screen bg-surface-0\">\r\n      {/* 左栏：项目进度 */}\r\n      <aside className=\"w-64 flex-shrink-0 border-r border-surface-3 bg-surface-1 overflow-y-auto\">\r\n        {leftPanel}\r\n      </aside>\r\n\r\n      {/* 中栏：内容展示区 */}\r\n      <main className=\"flex-1 overflow-y-auto bg-surface-0\">\r\n        {centerPanel}\r\n      </main>\r\n\r\n      {/* 右栏：AI Agent */}\r\n      <aside className=\"w-96 flex-shrink-0 border-l border-surface-3 bg-surface-1 flex flex-col\">\r\n        {rightPanel}\r\n      </aside>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAAA,kDAAkD;AAClD,cAAc;AACd,wBAAwB;AAExB;;AAUO,SAAS,gBAAgB,EAC9B,SAAS,EACT,WAAW,EACX,UAAU,EACW;IACrB,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAM,WAAU;0BACd;;;;;;0BAIH,8OAAC;gBAAK,WAAU;0BACb;;;;;;0BAIH,8OAAC;gBAAM,WAAU;0BACd;;;;;;;;;;;;AAIT"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/lib/utils.ts"],"sourcesContent":["// frontend/lib/utils.ts\r\n// 功能: 通用工具函数\r\n// 主要函数: cn, formatDate\r\n\r\nimport { clsx, type ClassValue } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\n/**\r\n * 合并 Tailwind 类名\r\n */\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n\r\n/**\r\n * 格式化日期\r\n */\r\nexport function formatDate(dateString: string): string {\r\n  if (!dateString) return \"\";\r\n  const date = new Date(dateString);\r\n  return date.toLocaleString(\"zh-CN\", {\r\n    year: \"numeric\",\r\n    month: \"2-digit\",\r\n    day: \"2-digit\",\r\n    hour: \"2-digit\",\r\n    minute: \"2-digit\",\r\n  });\r\n}\r\n\r\n/**\r\n * 阶段名称映射\r\n */\r\nexport const PHASE_NAMES: Record<string, string> = {\r\n  intent: \"意图分析\",\r\n  research: \"消费者调研\",\r\n  design_inner: \"内涵设计\",\r\n  produce_inner: \"内涵生产\",\r\n  design_outer: \"外延设计\",\r\n  produce_outer: \"外延生产\",\r\n  simulate: \"消费者模拟\",\r\n  evaluate: \"评估\",\r\n};\r\n\r\n/**\r\n * 阶段状态映射\r\n */\r\nexport const PHASE_STATUS: Record<string, { label: string; color: string }> = {\r\n  pending: { label: \"未开始\", color: \"text-zinc-500\" },\r\n  in_progress: { label: \"进行中\", color: \"text-yellow-500\" },\r\n  completed: { label: \"已完成\", color: \"text-green-500\" },\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA,wBAAwB;AACxB,aAAa;AACb,uBAAuB;AAEvB;AACA;;;AAKO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACtB;AAKO,SAAS,WAAW,UAAkB;IAC3C,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,OAAO,IAAI,KAAK;IACtB,OAAO,KAAK,cAAc,CAAC,SAAS;QAClC,MAAM;QACN,OAAO;QACP,KAAK;QACL,MAAM;QACN,QAAQ;IACV;AACF;AAKO,MAAM,cAAsC;IACjD,QAAQ;IACR,UAAU;IACV,cAAc;IACd,eAAe;IACf,cAAc;IACd,eAAe;IACf,UAAU;IACV,UAAU;AACZ;AAKO,MAAM,eAAiE;IAC5E,SAAS;QAAE,OAAO;QAAO,OAAO;IAAgB;IAChD,aAAa;QAAE,OAAO;QAAO,OAAO;IAAkB;IACtD,WAAW;QAAE,OAAO;QAAO,OAAO;IAAiB;AACrD"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/progress-panel.tsx"],"sourcesContent":["// frontend/components/progress-panel.tsx\r\n// 功能: 左栏项目进度面板，支持中间4阶段拖拽排序\r\n// 主要组件: ProgressPanel\r\n// 固定阶段: 意图分析、消费者调研在顶部；消费者模拟、评估在底部\r\n// 可拖拽阶段: 内涵设计、内涵生产、外延设计、外延生产\r\n\r\n\"use client\";\r\n\r\nimport { useState, useRef } from \"react\";\r\nimport { cn, PHASE_NAMES, PHASE_STATUS } from \"@/lib/utils\";\r\nimport type { Project } from \"@/lib/api\";\r\n\r\n// 固定阶段定义\r\nconst FIXED_TOP_PHASES = [\"intent\", \"research\"];\r\nconst DRAGGABLE_PHASES = [\"design_inner\", \"produce_inner\", \"design_outer\", \"produce_outer\"];\r\nconst FIXED_BOTTOM_PHASES = [\"simulate\", \"evaluate\"];\r\n\r\ninterface ProgressPanelProps {\r\n  project: Project | null;\r\n  onPhaseClick?: (phase: string) => void;\r\n  onPhaseReorder?: (phases: string[]) => void;\r\n  onAutonomyChange?: (autonomy: Record<string, boolean>) => void;\r\n}\r\n\r\nexport function ProgressPanel({\r\n  project,\r\n  onPhaseClick,\r\n  onPhaseReorder,\r\n  onAutonomyChange,\r\n}: ProgressPanelProps) {\r\n  const [showAutonomySettings, setShowAutonomySettings] = useState(false);\r\n  const allPhases = project?.phase_order || [];\r\n  const phaseStatus = project?.phase_status || {};\r\n  const currentPhase = project?.current_phase || \"intent\";\r\n  \r\n  // 分离固定和可拖拽阶段\r\n  const topPhases = allPhases.filter(p => FIXED_TOP_PHASES.includes(p));\r\n  const middlePhases = allPhases.filter(p => DRAGGABLE_PHASES.includes(p));\r\n  const bottomPhases = allPhases.filter(p => FIXED_BOTTOM_PHASES.includes(p));\r\n  \r\n  // 拖拽状态\r\n  const [draggedPhase, setDraggedPhase] = useState<string | null>(null);\r\n  const [dragOverPhase, setDragOverPhase] = useState<string | null>(null);\r\n  const dragCounter = useRef(0);\r\n\r\n  const handleDragStart = (e: React.DragEvent, phase: string) => {\r\n    setDraggedPhase(phase);\r\n    e.dataTransfer.effectAllowed = \"move\";\r\n    e.dataTransfer.setData(\"text/plain\", phase);\r\n  };\r\n\r\n  const handleDragEnd = () => {\r\n    setDraggedPhase(null);\r\n    setDragOverPhase(null);\r\n    dragCounter.current = 0;\r\n  };\r\n\r\n  const handleDragEnter = (e: React.DragEvent, phase: string) => {\r\n    e.preventDefault();\r\n    dragCounter.current++;\r\n    if (DRAGGABLE_PHASES.includes(phase)) {\r\n      setDragOverPhase(phase);\r\n    }\r\n  };\r\n\r\n  const handleDragLeave = () => {\r\n    dragCounter.current--;\r\n    if (dragCounter.current === 0) {\r\n      setDragOverPhase(null);\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent, targetPhase: string) => {\r\n    e.preventDefault();\r\n    \r\n    if (!draggedPhase || draggedPhase === targetPhase) {\r\n      handleDragEnd();\r\n      return;\r\n    }\r\n    \r\n    // 重新排序中间阶段\r\n    const newMiddle = [...middlePhases];\r\n    const dragIdx = newMiddle.indexOf(draggedPhase);\r\n    const dropIdx = newMiddle.indexOf(targetPhase);\r\n    \r\n    if (dragIdx !== -1 && dropIdx !== -1) {\r\n      newMiddle.splice(dragIdx, 1);\r\n      newMiddle.splice(dropIdx, 0, draggedPhase);\r\n      \r\n      // 重建完整顺序\r\n      const newOrder = [...topPhases, ...newMiddle, ...bottomPhases];\r\n      onPhaseReorder?.(newOrder);\r\n    }\r\n    \r\n    handleDragEnd();\r\n  };\r\n\r\n  const renderPhaseItem = (phase: string, isDraggable: boolean) => {\r\n    const status = phaseStatus[phase] || \"pending\";\r\n    const statusInfo = PHASE_STATUS[status] || PHASE_STATUS.pending;\r\n    const isCurrent = phase === currentPhase;\r\n    const isDragging = draggedPhase === phase;\r\n    const isDragOver = dragOverPhase === phase;\r\n    \r\n    return (\r\n      <div\r\n        key={phase}\r\n        draggable={isDraggable}\r\n        onDragStart={isDraggable ? (e) => handleDragStart(e, phase) : undefined}\r\n        onDragEnd={isDraggable ? handleDragEnd : undefined}\r\n        onDragEnter={isDraggable ? (e) => handleDragEnter(e, phase) : undefined}\r\n        onDragLeave={isDraggable ? handleDragLeave : undefined}\r\n        onDragOver={isDraggable ? handleDragOver : undefined}\r\n        onDrop={isDraggable ? (e) => handleDrop(e, phase) : undefined}\r\n        className={cn(\r\n          \"relative transition-all duration-150\",\r\n          isDragging && \"opacity-50\",\r\n          isDragOver && \"before:absolute before:inset-x-0 before:-top-1 before:h-0.5 before:bg-brand-500\"\r\n        )}\r\n      >\r\n        <button\r\n          onClick={() => onPhaseClick?.(phase)}\r\n          className={cn(\r\n            \"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors\",\r\n            isCurrent\r\n              ? \"bg-brand-600/20 text-brand-400\"\r\n              : \"hover:bg-surface-3 text-zinc-300\",\r\n            isDraggable && \"cursor-grab active:cursor-grabbing\"\r\n          )}\r\n        >\r\n          {/* 拖拽手柄 */}\r\n          {isDraggable && (\r\n            <span className=\"text-zinc-600 text-xs select-none\">⋮⋮</span>\r\n          )}\r\n          \r\n          {/* 状态指示器 */}\r\n          <div\r\n            className={cn(\r\n              \"w-2 h-2 rounded-full flex-shrink-0\",\r\n              status === \"completed\" && \"bg-green-500\",\r\n              status === \"in_progress\" && \"bg-yellow-500\",\r\n              status === \"pending\" && \"bg-zinc-600\"\r\n            )}\r\n          />\r\n          \r\n          {/* 阶段名称 */}\r\n          <span className=\"flex-1 text-sm\">\r\n            {PHASE_NAMES[phase] || phase}\r\n          </span>\r\n          \r\n          {/* 状态标签 */}\r\n          <span className={cn(\"text-xs\", statusInfo.color)}>\r\n            {statusInfo.label}\r\n          </span>\r\n        </button>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4\">\r\n      {/* 项目信息 */}\r\n      <div className=\"mb-6\">\r\n        <h2 className=\"text-lg font-semibold text-zinc-100\">\r\n          {project?.name || \"未选择项目\"}\r\n        </h2>\r\n        {project && (\r\n          <p className=\"text-sm text-zinc-500 mt-1\">\r\n            版本 {project.version}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* 流程进度 */}\r\n      <div className=\"space-y-1\">\r\n        <h3 className=\"text-xs font-medium text-zinc-500 uppercase tracking-wider mb-3\">\r\n          流程进度\r\n        </h3>\r\n        \r\n        {/* 顶部固定阶段 */}\r\n        {topPhases.map(phase => renderPhaseItem(phase, false))}\r\n        \r\n        {/* 可拖拽的中间阶段 */}\r\n        {middlePhases.length > 0 && (\r\n          <div className=\"py-1\">\r\n            <div className=\"text-xs text-zinc-600 px-3 mb-1 flex items-center gap-1\">\r\n              <span>↕</span>\r\n              <span>可拖拽调整顺序</span>\r\n            </div>\r\n            {middlePhases.map(phase => renderPhaseItem(phase, true))}\r\n          </div>\r\n        )}\r\n        \r\n        {/* 底部固定阶段 */}\r\n        {bottomPhases.map(phase => renderPhaseItem(phase, false))}\r\n      </div>\r\n\r\n      {/* 分隔线 */}\r\n      <div className=\"my-6 border-t border-surface-3\" />\r\n\r\n      {/* 快捷操作 */}\r\n      <div className=\"space-y-2\">\r\n        <h3 className=\"text-xs font-medium text-zinc-500 uppercase tracking-wider mb-3\">\r\n          快捷操作\r\n        </h3>\r\n        \r\n        <button \r\n          onClick={() => setShowAutonomySettings(true)}\r\n          className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\"\r\n        >\r\n          ⚙ Agent自主权设置\r\n        </button>\r\n        \r\n        <button className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\">\r\n          + 新建版本\r\n        </button>\r\n        \r\n        <button className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\">\r\n          查看历史版本\r\n        </button>\r\n        \r\n        <button className=\"w-full px-3 py-2 text-sm text-left text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 rounded-lg transition-colors\">\r\n          导出内容\r\n        </button>\r\n      </div>\r\n\r\n      {/* Agent自主权设置弹窗 */}\r\n      {showAutonomySettings && project && (\r\n        <AutonomySettingsModal\r\n          project={project}\r\n          onClose={() => setShowAutonomySettings(false)}\r\n          onSave={onAutonomyChange}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface AutonomySettingsModalProps {\r\n  project: Project;\r\n  onClose: () => void;\r\n  onSave?: (autonomy: Record<string, boolean>) => void;\r\n}\r\n\r\nfunction AutonomySettingsModal({ project, onClose, onSave }: AutonomySettingsModalProps) {\r\n  const [autonomy, setAutonomy] = useState<Record<string, boolean>>(\r\n    project.agent_autonomy || {}\r\n  );\r\n\r\n  const allPhases = [\r\n    { id: \"intent\", name: \"意图分析\", desc: \"Agent自动提问并分析意图\" },\r\n    { id: \"research\", name: \"消费者调研\", desc: \"Agent自动调研用户画像\" },\r\n    { id: \"design_inner\", name: \"内涵设计\", desc: \"Agent自动设计内容方案\" },\r\n    { id: \"produce_inner\", name: \"内涵生产\", desc: \"Agent自动生产各字段内容\" },\r\n    { id: \"design_outer\", name: \"外延设计\", desc: \"Agent自动设计传播方案\" },\r\n    { id: \"produce_outer\", name: \"外延生产\", desc: \"Agent自动生产渠道内容\" },\r\n    { id: \"simulate\", name: \"消费者模拟\", desc: \"Agent自动模拟用户体验\" },\r\n    { id: \"evaluate\", name: \"评估\", desc: \"Agent自动评估内容质量\" },\r\n  ];\r\n\r\n  const handleToggle = (phase: string) => {\r\n    setAutonomy((prev) => ({\r\n      ...prev,\r\n      [phase]: !prev[phase],\r\n    }));\r\n  };\r\n\r\n  const handleSave = () => {\r\n    onSave?.(autonomy);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-surface-2 rounded-xl border border-surface-3 w-full max-w-lg max-h-[80vh] overflow-hidden\">\r\n        <div className=\"px-4 py-3 border-b border-surface-3\">\r\n          <h3 className=\"font-medium text-zinc-200\">Agent自主权设置</h3>\r\n          <p className=\"text-xs text-zinc-500 mt-1\">\r\n            设置各阶段Agent是否自动执行，不勾选 = 需要人工确认后才继续\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"p-4 max-h-[50vh] overflow-y-auto space-y-3\">\r\n          {allPhases.map((phase) => (\r\n            <label\r\n              key={phase.id}\r\n              className=\"flex items-start gap-3 p-3 rounded-lg hover:bg-surface-3 cursor-pointer\"\r\n            >\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={autonomy[phase.id] !== false}\r\n                onChange={() => handleToggle(phase.id)}\r\n                className=\"mt-0.5 rounded\"\r\n              />\r\n              <div className=\"flex-1\">\r\n                <div className=\"text-sm text-zinc-200\">{phase.name}</div>\r\n                <div className=\"text-xs text-zinc-500 mt-0.5\">{phase.desc}</div>\r\n              </div>\r\n              <span className={`text-xs px-2 py-0.5 rounded ${\r\n                autonomy[phase.id] !== false\r\n                  ? \"bg-green-600/20 text-green-400\"\r\n                  : \"bg-yellow-600/20 text-yellow-400\"\r\n              }`}>\r\n                {autonomy[phase.id] !== false ? \"自动\" : \"需确认\"}\r\n              </span>\r\n            </label>\r\n          ))}\r\n        </div>\r\n\r\n        <div className=\"px-4 py-3 border-t border-surface-3 flex justify-between\">\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={() => setAutonomy(allPhases.reduce((acc, p) => ({ ...acc, [p.id]: true }), {}))}\r\n              className=\"px-3 py-1.5 text-xs bg-surface-3 hover:bg-surface-4 rounded-lg\"\r\n            >\r\n              全部自动\r\n            </button>\r\n            <button\r\n              onClick={() => setAutonomy(allPhases.reduce((acc, p) => ({ ...acc, [p.id]: false }), {}))}\r\n              className=\"px-3 py-1.5 text-xs bg-surface-3 hover:bg-surface-4 rounded-lg\"\r\n            >\r\n              全部确认\r\n            </button>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg\"\r\n            >\r\n              取消\r\n            </button>\r\n            <button\r\n              onClick={handleSave}\r\n              className=\"px-4 py-2 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg\"\r\n            >\r\n              保存\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 659, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/lib/api.ts"],"sourcesContent":["// frontend/lib/api.ts\r\n// 功能: API客户端，封装后端API调用\r\n// 主要函数: fetchAPI, streamAPI\r\n// 数据结构: Project, Field, ChatMessage\r\n\r\nconst API_BASE = process.env.BACKEND_URL || \"http://localhost:8000\";\r\n\r\n// ============== Types ==============\r\n\r\nexport interface Project {\r\n  id: string;\r\n  name: string;\r\n  version: number;\r\n  version_note: string;\r\n  creator_profile_id: string | null;\r\n  current_phase: string;\r\n  phase_order: string[];\r\n  phase_status: Record<string, string>;\r\n  agent_autonomy: Record<string, boolean>;\r\n  golden_context: Record<string, string>;\r\n  use_deep_research: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface Field {\r\n  id: string;\r\n  project_id: string;\r\n  phase: string;\r\n  name: string;\r\n  field_type: string;\r\n  content: string;\r\n  status: string;\r\n  ai_prompt: string;\r\n  pre_questions: string[];\r\n  pre_answers: Record<string, string>;\r\n  dependencies: {\r\n    depends_on: string[];\r\n    dependency_type: string;\r\n  };\r\n  template_id: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface CreatorProfile {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  traits: Record<string, any>;\r\n  created_at: string;\r\n}\r\n\r\nexport interface ChatMessage {\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n}\r\n\r\nexport interface ChatResponse {\r\n  message_id: string;\r\n  message: string;\r\n  phase: string;\r\n  phase_status: Record<string, string>;\r\n  waiting_for_human: boolean;\r\n}\r\n\r\nexport interface ChatMessageRecord {\r\n  id: string;\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n  original_content: string;\r\n  is_edited: boolean;\r\n  metadata: {\r\n    phase?: string;\r\n    tool_used?: string;\r\n    skill_used?: string;\r\n    references?: string[];\r\n    is_retry?: boolean;\r\n  };\r\n  created_at: string;\r\n}\r\n\r\nexport interface Persona {\r\n  source: string;\r\n  name: string;\r\n  background: string;\r\n  story: string;\r\n}\r\n\r\nexport interface SimulationRecord {\r\n  id: string;\r\n  project_id: string;\r\n  simulator_id: string;\r\n  target_field_ids: string[];\r\n  persona: Persona;\r\n  interaction_log: any[];\r\n  feedback: {\r\n    scores: Record<string, number>;\r\n    comments: Record<string, string>;\r\n    overall: string;\r\n  };\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface PersonaFromResearch {\r\n  name: string;\r\n  background: string;\r\n  story: string;\r\n}\r\n\r\n// ============== API Functions ==============\r\n\r\nasync function fetchAPI<T>(\r\n  endpoint: string,\r\n  options: RequestInit = {}\r\n): Promise<T> {\r\n  const url = `${API_BASE}${endpoint}`;\r\n  \r\n  const response = await fetch(url, {\r\n    ...options,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      ...options.headers,\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({ detail: \"Unknown error\" }));\r\n    // 处理Pydantic验证错误格式 (detail可能是数组)\r\n    let errorMessage: string;\r\n    if (typeof error.detail === \"string\") {\r\n      errorMessage = error.detail;\r\n    } else if (Array.isArray(error.detail)) {\r\n      errorMessage = error.detail.map((e: any) => e.msg || e.message || JSON.stringify(e)).join(\"; \");\r\n    } else {\r\n      errorMessage = `API error: ${response.status}`;\r\n    }\r\n    throw new Error(errorMessage);\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n// ============== Project API ==============\r\n\r\nexport const projectAPI = {\r\n  list: () => fetchAPI<Project[]>(\"/api/projects/\"),\r\n  \r\n  get: (id: string) => fetchAPI<Project>(`/api/projects/${id}`),\r\n  \r\n  create: (data: { name: string; creator_profile_id?: string; use_deep_research?: boolean }) =>\r\n    fetchAPI<Project>(\"/api/projects/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  update: (id: string, data: Partial<Project>) =>\r\n    fetchAPI<Project>(`/api/projects/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  delete: (id: string) =>\r\n    fetchAPI<{ message: string }>(`/api/projects/${id}`, { method: \"DELETE\" }),\r\n  \r\n  createVersion: (id: string, version_note: string) =>\r\n    fetchAPI<Project>(`/api/projects/${id}/versions`, {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ version_note }),\r\n    }),\r\n};\r\n\r\n// ============== Field API ==============\r\n\r\nexport const fieldAPI = {\r\n  listByProject: (projectId: string, phase?: string) => {\r\n    const query = phase ? `?phase=${phase}` : \"\";\r\n    return fetchAPI<Field[]>(`/api/fields/project/${projectId}${query}`);\r\n  },\r\n  \r\n  get: (id: string) => fetchAPI<Field>(`/api/fields/${id}`),\r\n  \r\n  create: (data: Partial<Field>) =>\r\n    fetchAPI<Field>(\"/api/fields/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  update: (id: string, data: Partial<Field>) =>\r\n    fetchAPI<Field>(`/api/fields/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  delete: (id: string) =>\r\n    fetchAPI<{ message: string }>(`/api/fields/${id}`, { method: \"DELETE\" }),\r\n  \r\n  generate: (id: string, pre_answers: Record<string, string> = {}) =>\r\n    fetchAPI<Field>(`/api/fields/${id}/generate`, {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ pre_answers }),\r\n    }),\r\n};\r\n\r\n// ============== Agent API ==============\r\n\r\nexport const agentAPI = {\r\n  chat: (projectId: string, message: string, currentPhase?: string) =>\r\n    fetchAPI<ChatResponse>(\"/api/agent/chat\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        message,\r\n        current_phase: currentPhase,\r\n      }),\r\n    }),\r\n  \r\n  advance: (projectId: string) =>\r\n    fetchAPI<ChatResponse>(\"/api/agent/advance\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        message: \"继续\",\r\n      }),\r\n    }),\r\n  \r\n  stream: async function* (\r\n    projectId: string,\r\n    message: string,\r\n    currentPhase?: string\r\n  ): AsyncGenerator<{ node?: string; content?: string; done?: boolean; error?: string }> {\r\n    const response = await fetch(`${API_BASE}/api/agent/stream`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        message,\r\n        current_phase: currentPhase,\r\n      }),\r\n    });\r\n\r\n    const reader = response.body?.getReader();\r\n    const decoder = new TextDecoder();\r\n\r\n    if (!reader) return;\r\n\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      if (done) break;\r\n\r\n      const text = decoder.decode(value);\r\n      const lines = text.split(\"\\n\");\r\n\r\n      for (const line of lines) {\r\n        if (line.startsWith(\"data: \")) {\r\n          try {\r\n            const data = JSON.parse(line.slice(6));\r\n            yield data;\r\n          } catch {\r\n            // Ignore parse errors\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  // 获取对话历史\r\n  getHistory: (projectId: string, limit: number = 100) =>\r\n    fetchAPI<ChatMessageRecord[]>(`/api/agent/history/${projectId}?limit=${limit}`),\r\n  \r\n  // 编辑消息\r\n  editMessage: (messageId: string, content: string) =>\r\n    fetchAPI<ChatMessageRecord>(`/api/agent/message/${messageId}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify({ content }),\r\n    }),\r\n  \r\n  // 重试/再试一次\r\n  retryMessage: (messageId: string) =>\r\n    fetchAPI<ChatResponse>(`/api/agent/retry/${messageId}`, {\r\n      method: \"POST\",\r\n    }),\r\n  \r\n  // 删除消息\r\n  deleteMessage: (messageId: string) =>\r\n    fetchAPI<any>(`/api/agent/message/${messageId}`, { method: \"DELETE\" }),\r\n  \r\n  // 调用Tool\r\n  callTool: (projectId: string, toolName: string, parameters: Record<string, any> = {}) =>\r\n    fetchAPI<ChatResponse>(\"/api/agent/tool\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        project_id: projectId,\r\n        tool_name: toolName,\r\n        parameters,\r\n      }),\r\n    }),\r\n};\r\n\r\n// ============== Settings API ==============\r\n\r\nexport const settingsAPI = {\r\n  // System Prompts\r\n  listSystemPrompts: () =>\r\n    fetchAPI<any[]>(\"/api/settings/system-prompts\"),\r\n  \r\n  updateSystemPrompt: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/system-prompts/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n\r\n  // Creator Profiles\r\n  listCreatorProfiles: () =>\r\n    fetchAPI<CreatorProfile[]>(\"/api/settings/creator-profiles\"),\r\n  \r\n  createCreatorProfile: (data: Partial<CreatorProfile>) =>\r\n    fetchAPI<CreatorProfile>(\"/api/settings/creator-profiles\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateCreatorProfile: (id: string, data: Partial<CreatorProfile>) =>\r\n    fetchAPI<CreatorProfile>(`/api/settings/creator-profiles/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteCreatorProfile: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/creator-profiles/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Field Templates\r\n  listFieldTemplates: () =>\r\n    fetchAPI<any[]>(\"/api/settings/field-templates\"),\r\n  \r\n  createFieldTemplate: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/field-templates\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateFieldTemplate: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/field-templates/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteFieldTemplate: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/field-templates/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Channels\r\n  listChannels: () =>\r\n    fetchAPI<any[]>(\"/api/settings/channels\"),\r\n  \r\n  createChannel: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/channels\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateChannel: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/channels/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteChannel: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/channels/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Simulators\r\n  listSimulators: () =>\r\n    fetchAPI<any[]>(\"/api/settings/simulators\"),\r\n  \r\n  createSimulator: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/simulators\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  updateSimulator: (id: string, data: any) =>\r\n    fetchAPI<any>(`/api/settings/simulators/${id}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  deleteSimulator: (id: string) =>\r\n    fetchAPI<any>(`/api/settings/simulators/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // Agent Settings\r\n  getAgentSettings: () =>\r\n    fetchAPI<any>(\"/api/settings/agent\"),\r\n  \r\n  updateAgentSettings: (data: any) =>\r\n    fetchAPI<any>(\"/api/settings/agent\", {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  // Logs\r\n  listLogs: (projectId?: string) => {\r\n    const query = projectId ? `?project_id=${projectId}` : \"\";\r\n    return fetchAPI<any[]>(`/api/settings/logs${query}`);\r\n  },\r\n  \r\n  exportLogs: (projectId?: string) => {\r\n    const query = projectId ? `?project_id=${projectId}` : \"\";\r\n    return fetchAPI<any>(`/api/settings/logs/export${query}`);\r\n  },\r\n};\r\n\r\n// ============== Simulation API ==============\r\n\r\nexport const simulationAPI = {\r\n  // 获取项目的模拟记录列表\r\n  list: (projectId: string) =>\r\n    fetchAPI<SimulationRecord[]>(`/api/simulations/project/${projectId}`),\r\n  \r\n  // 获取模拟记录详情\r\n  get: (id: string) =>\r\n    fetchAPI<SimulationRecord>(`/api/simulations/${id}`),\r\n  \r\n  // 创建模拟记录\r\n  create: (data: {\r\n    project_id: string;\r\n    simulator_id: string;\r\n    target_field_ids: string[];\r\n    persona: Persona;\r\n  }) =>\r\n    fetchAPI<SimulationRecord>(\"/api/simulations/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    }),\r\n  \r\n  // 删除模拟记录\r\n  delete: (id: string) =>\r\n    fetchAPI<any>(`/api/simulations/${id}`, { method: \"DELETE\" }),\r\n  \r\n  // 获取消费者调研中的人物小传\r\n  getPersonasFromResearch: (projectId: string) =>\r\n    fetchAPI<PersonaFromResearch[]>(`/api/simulations/project/${projectId}/personas`),\r\n};\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 919, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/simulation-panel.tsx"],"sourcesContent":["// frontend/components/simulation-panel.tsx\r\n// 功能: 消费者模拟阶段专用面板\r\n// 主要组件: SimulationPanel\r\n// 包含: 人物小传选择、模拟记录表格、新建模拟\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { simulationAPI, settingsAPI } from \"@/lib/api\";\r\nimport type { SimulationRecord, PersonaFromResearch, Persona } from \"@/lib/api\";\r\n\r\ninterface SimulationPanelProps {\r\n  projectId: string;\r\n  fields: any[];\r\n  onSimulationCreated?: () => void;\r\n}\r\n\r\nexport function SimulationPanel({\r\n  projectId,\r\n  fields,\r\n  onSimulationCreated,\r\n}: SimulationPanelProps) {\r\n  const [simulations, setSimulations] = useState<SimulationRecord[]>([]);\r\n  const [personas, setPersonas] = useState<PersonaFromResearch[]>([]);\r\n  const [simulators, setSimulators] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, [projectId]);\r\n\r\n  const loadData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const [sims, personaList, simList] = await Promise.all([\r\n        simulationAPI.list(projectId),\r\n        simulationAPI.getPersonasFromResearch(projectId),\r\n        settingsAPI.listSimulators(),\r\n      ]);\r\n      setSimulations(sims);\r\n      setPersonas(personaList);\r\n      setSimulators(simList);\r\n    } catch (err) {\r\n      console.error(\"加载模拟数据失败:\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm(\"确定删除此模拟记录？\")) return;\r\n    try {\r\n      await simulationAPI.delete(id);\r\n      loadData();\r\n    } catch (err) {\r\n      alert(\"删除失败\");\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"p-6 text-zinc-500\">加载中...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-4xl mx-auto\">\r\n      {/* 标题 */}\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-2xl font-bold text-zinc-100\">消费者模拟</h1>\r\n        <p className=\"text-zinc-500 mt-1\">\r\n          模拟目标用户体验内容，收集反馈\r\n        </p>\r\n      </div>\r\n\r\n      {/* 人物小传选择 */}\r\n      <div className=\"mb-8\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h2 className=\"text-lg font-semibold text-zinc-200\">可用人物小传</h2>\r\n          <span className=\"text-xs text-zinc-500\">来自消费者调研</span>\r\n        </div>\r\n        \r\n        {personas.length > 0 ? (\r\n          <div className=\"grid gap-3 md:grid-cols-2\">\r\n            {personas.map((persona, idx) => (\r\n              <div\r\n                key={idx}\r\n                className=\"p-4 bg-surface-2 border border-surface-3 rounded-xl\"\r\n              >\r\n                <h3 className=\"font-medium text-zinc-200\">{persona.name}</h3>\r\n                <p className=\"text-xs text-zinc-500 mt-1\">{persona.background}</p>\r\n                <p className=\"text-sm text-zinc-400 mt-2 line-clamp-3\">\r\n                  {persona.story}\r\n                </p>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"p-4 bg-surface-2 border border-surface-3 rounded-xl text-center text-zinc-500\">\r\n            <p>暂无人物小传</p>\r\n            <p className=\"text-xs mt-1\">完成消费者调研后会自动提取人物小传</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* 模拟记录表格 */}\r\n      <div className=\"mb-8\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h2 className=\"text-lg font-semibold text-zinc-200\">模拟记录</h2>\r\n          <button\r\n            onClick={() => setShowCreateModal(true)}\r\n            className=\"px-4 py-2 bg-brand-600 hover:bg-brand-700 rounded-lg text-sm transition-colors\"\r\n          >\r\n            + 新建模拟\r\n          </button>\r\n        </div>\r\n\r\n        {simulations.length > 0 ? (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full text-sm\">\r\n              <thead>\r\n                <tr className=\"border-b border-surface-3\">\r\n                  <th className=\"text-left py-3 px-3 text-zinc-500\">人物</th>\r\n                  <th className=\"text-left py-3 px-3 text-zinc-500\">模拟器</th>\r\n                  <th className=\"text-left py-3 px-3 text-zinc-500\">状态</th>\r\n                  <th className=\"text-right py-3 px-3 text-zinc-500\">评分</th>\r\n                  <th className=\"text-left py-3 px-3 text-zinc-500\">时间</th>\r\n                  <th className=\"text-right py-3 px-3 text-zinc-500\">操作</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {simulations.map((sim) => {\r\n                  const simulator = simulators.find(s => s.id === sim.simulator_id);\r\n                  const avgScore = Object.values(sim.feedback.scores || {}).reduce(\r\n                    (a, b) => a + b, 0\r\n                  ) / (Object.keys(sim.feedback.scores || {}).length || 1);\r\n                  \r\n                  return (\r\n                    <tr key={sim.id} className=\"border-b border-surface-3/50 hover:bg-surface-2\">\r\n                      <td className=\"py-3 px-3\">\r\n                        <div className=\"font-medium text-zinc-200\">{sim.persona.name || \"未知\"}</div>\r\n                        <div className=\"text-xs text-zinc-500\">{sim.persona.source}</div>\r\n                      </td>\r\n                      <td className=\"py-3 px-3 text-zinc-300\">\r\n                        {simulator?.name || sim.simulator_id}\r\n                      </td>\r\n                      <td className=\"py-3 px-3\">\r\n                        <span className={`px-2 py-0.5 rounded text-xs ${\r\n                          sim.status === \"completed\" \r\n                            ? \"bg-green-600/20 text-green-400\"\r\n                            : sim.status === \"running\"\r\n                            ? \"bg-yellow-600/20 text-yellow-400\"\r\n                            : \"bg-zinc-600/20 text-zinc-400\"\r\n                        }`}>\r\n                          {sim.status === \"completed\" ? \"已完成\" \r\n                            : sim.status === \"running\" ? \"进行中\" \r\n                            : \"待开始\"}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"py-3 px-3 text-right\">\r\n                        {Object.keys(sim.feedback.scores || {}).length > 0 ? (\r\n                          <span className=\"text-zinc-200\">{avgScore.toFixed(1)}</span>\r\n                        ) : (\r\n                          <span className=\"text-zinc-500\">-</span>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"py-3 px-3 text-zinc-400\">\r\n                        {new Date(sim.created_at).toLocaleDateString()}\r\n                      </td>\r\n                      <td className=\"py-3 px-3 text-right\">\r\n                        <button\r\n                          onClick={() => handleDelete(sim.id)}\r\n                          className=\"text-red-400 hover:text-red-300 text-sm\"\r\n                        >\r\n                          删除\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        ) : (\r\n          <div className=\"p-8 bg-surface-2 border border-surface-3 rounded-xl text-center text-zinc-500\">\r\n            <p>暂无模拟记录</p>\r\n            <p className=\"text-xs mt-1\">点击\"新建模拟\"开始消费者模拟</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* 新建模拟弹窗 */}\r\n      {showCreateModal && (\r\n        <CreateSimulationModal\r\n          projectId={projectId}\r\n          personas={personas}\r\n          simulators={simulators}\r\n          fields={fields}\r\n          onClose={() => setShowCreateModal(false)}\r\n          onCreated={() => {\r\n            setShowCreateModal(false);\r\n            loadData();\r\n            onSimulationCreated?.();\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface CreateSimulationModalProps {\r\n  projectId: string;\r\n  personas: PersonaFromResearch[];\r\n  simulators: any[];\r\n  fields: any[];\r\n  onClose: () => void;\r\n  onCreated: () => void;\r\n}\r\n\r\nfunction CreateSimulationModal({\r\n  projectId,\r\n  personas,\r\n  simulators,\r\n  fields,\r\n  onClose,\r\n  onCreated,\r\n}: CreateSimulationModalProps) {\r\n  const [simulatorId, setSimulatorId] = useState(simulators[0]?.id || \"\");\r\n  const [personaSource, setPersonaSource] = useState<\"research\" | \"custom\">(\"research\");\r\n  const [selectedPersonaIdx, setSelectedPersonaIdx] = useState(0);\r\n  const [customPersona, setCustomPersona] = useState({ name: \"\", background: \"\", story: \"\" });\r\n  const [selectedFieldIds, setSelectedFieldIds] = useState<string[]>([]);\r\n  const [creating, setCreating] = useState(false);\r\n\r\n  // 可选的字段（已完成的内涵/外延字段）\r\n  const completedFields = fields.filter(\r\n    (f) => f.status === \"completed\" && \r\n    [\"produce_inner\", \"produce_outer\"].includes(f.phase)\r\n  );\r\n\r\n  const handleCreate = async () => {\r\n    if (!simulatorId) {\r\n      alert(\"请选择模拟器\");\r\n      return;\r\n    }\r\n\r\n    const persona: Persona = personaSource === \"research\" && personas[selectedPersonaIdx]\r\n      ? {\r\n          source: \"research\",\r\n          name: personas[selectedPersonaIdx].name,\r\n          background: personas[selectedPersonaIdx].background,\r\n          story: personas[selectedPersonaIdx].story,\r\n        }\r\n      : {\r\n          source: \"custom\",\r\n          name: customPersona.name,\r\n          background: customPersona.background,\r\n          story: customPersona.story,\r\n        };\r\n\r\n    if (!persona.name) {\r\n      alert(\"请填写人物名称\");\r\n      return;\r\n    }\r\n\r\n    setCreating(true);\r\n    try {\r\n      await simulationAPI.create({\r\n        project_id: projectId,\r\n        simulator_id: simulatorId,\r\n        target_field_ids: selectedFieldIds,\r\n        persona,\r\n      });\r\n      onCreated();\r\n    } catch (err) {\r\n      alert(\"创建失败: \" + (err instanceof Error ? err.message : \"未知错误\"));\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-surface-2 rounded-xl border border-surface-3 w-full max-w-2xl max-h-[85vh] overflow-hidden\">\r\n        <div className=\"px-4 py-3 border-b border-surface-3\">\r\n          <h3 className=\"font-medium text-zinc-200\">新建消费者模拟</h3>\r\n        </div>\r\n\r\n        <div className=\"p-4 max-h-[60vh] overflow-y-auto space-y-6\">\r\n          {/* 选择模拟器 */}\r\n          <div>\r\n            <label className=\"block text-sm text-zinc-400 mb-2\">模拟器类型</label>\r\n            <select\r\n              value={simulatorId}\r\n              onChange={(e) => setSimulatorId(e.target.value)}\r\n              className=\"w-full px-3 py-2 bg-surface-1 border border-surface-3 rounded-lg text-zinc-200\"\r\n            >\r\n              {simulators.map((s) => (\r\n                <option key={s.id} value={s.id}>\r\n                  {s.name} - {s.interaction_type}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* 人物来源选择 */}\r\n          <div>\r\n            <label className=\"block text-sm text-zinc-400 mb-2\">人物画像来源</label>\r\n            <div className=\"flex gap-4\">\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"radio\"\r\n                  checked={personaSource === \"research\"}\r\n                  onChange={() => setPersonaSource(\"research\")}\r\n                />\r\n                <span className=\"text-zinc-200\">从消费者调研选择</span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"radio\"\r\n                  checked={personaSource === \"custom\"}\r\n                  onChange={() => setPersonaSource(\"custom\")}\r\n                />\r\n                <span className=\"text-zinc-200\">自定义</span>\r\n              </label>\r\n            </div>\r\n          </div>\r\n\r\n          {/* 人物选择/输入 */}\r\n          {personaSource === \"research\" ? (\r\n            <div>\r\n              <label className=\"block text-sm text-zinc-400 mb-2\">选择人物小传</label>\r\n              {personas.length > 0 ? (\r\n                <div className=\"space-y-2\">\r\n                  {personas.map((p, idx) => (\r\n                    <label\r\n                      key={idx}\r\n                      className={`flex items-start gap-3 p-3 rounded-lg cursor-pointer border ${\r\n                        selectedPersonaIdx === idx\r\n                          ? \"border-brand-500 bg-brand-600/10\"\r\n                          : \"border-surface-3 hover:bg-surface-3\"\r\n                      }`}\r\n                    >\r\n                      <input\r\n                        type=\"radio\"\r\n                        checked={selectedPersonaIdx === idx}\r\n                        onChange={() => setSelectedPersonaIdx(idx)}\r\n                        className=\"mt-1\"\r\n                      />\r\n                      <div>\r\n                        <div className=\"font-medium text-zinc-200\">{p.name}</div>\r\n                        <div className=\"text-xs text-zinc-500\">{p.background}</div>\r\n                        <div className=\"text-sm text-zinc-400 mt-1 line-clamp-2\">{p.story}</div>\r\n                      </div>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <div className=\"p-4 text-center text-zinc-500 bg-surface-1 rounded-lg\">\r\n                  暂无可用的人物小传，请选择\"自定义\"\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm text-zinc-400 mb-1\">人物名称</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={customPersona.name}\r\n                  onChange={(e) => setCustomPersona({ ...customPersona, name: e.target.value })}\r\n                  className=\"w-full px-3 py-2 bg-surface-1 border border-surface-3 rounded-lg text-zinc-200\"\r\n                  placeholder=\"如：张医生\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm text-zinc-400 mb-1\">背景描述</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={customPersona.background}\r\n                  onChange={(e) => setCustomPersona({ ...customPersona, background: e.target.value })}\r\n                  className=\"w-full px-3 py-2 bg-surface-1 border border-surface-3 rounded-lg text-zinc-200\"\r\n                  placeholder=\"如：某三甲医院主任医师，从业15年\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm text-zinc-400 mb-1\">人物小传</label>\r\n                <textarea\r\n                  value={customPersona.story}\r\n                  onChange={(e) => setCustomPersona({ ...customPersona, story: e.target.value })}\r\n                  rows={4}\r\n                  className=\"w-full px-3 py-2 bg-surface-1 border border-surface-3 rounded-lg text-zinc-200\"\r\n                  placeholder=\"详细描述人物的背景、需求、痛点等...\"\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* 选择要模拟的内容 */}\r\n          <div>\r\n            <label className=\"block text-sm text-zinc-400 mb-2\">选择要模拟的内容（可选）</label>\r\n            {completedFields.length > 0 ? (\r\n              <div className=\"space-y-2 max-h-40 overflow-y-auto\">\r\n                {completedFields.map((f) => (\r\n                  <label key={f.id} className=\"flex items-center gap-2 cursor-pointer\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selectedFieldIds.includes(f.id)}\r\n                      onChange={(e) => {\r\n                        if (e.target.checked) {\r\n                          setSelectedFieldIds([...selectedFieldIds, f.id]);\r\n                        } else {\r\n                          setSelectedFieldIds(selectedFieldIds.filter((id) => id !== f.id));\r\n                        }\r\n                      }}\r\n                    />\r\n                    <span className=\"text-zinc-200\">{f.name}</span>\r\n                    <span className=\"text-xs text-zinc-500\">({f.phase})</span>\r\n                  </label>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-sm text-zinc-500\">暂无已完成的内容字段</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"px-4 py-3 border-t border-surface-3 flex justify-end gap-2\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg\"\r\n          >\r\n            取消\r\n          </button>\r\n          <button\r\n            onClick={handleCreate}\r\n            disabled={creating}\r\n            className=\"px-4 py-2 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg disabled:opacity-50\"\r\n          >\r\n            {creating ? \"创建中...\" : \"创建模拟\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1873, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/content-panel.tsx"],"sourcesContent":["// frontend/components/content-panel.tsx\r\n// 功能: 中栏内容展示面板，支持字段依赖选择和生成\r\n// 主要组件: ContentPanel, FieldCard\r\n// 新增: 依赖选择弹窗、生成按钮、依赖状态显示、模拟阶段特殊面板\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { PHASE_NAMES } from \"@/lib/utils\";\r\nimport { fieldAPI } from \"@/lib/api\";\r\nimport type { Field } from \"@/lib/api\";\r\nimport { SimulationPanel } from \"./simulation-panel\";\r\n\r\ninterface ContentPanelProps {\r\n  projectId: string | null;\r\n  currentPhase: string;\r\n  fields: Field[];\r\n  onFieldUpdate?: (fieldId: string, content: string) => void;\r\n  onFieldsChange?: () => void;\r\n}\r\n\r\nexport function ContentPanel({\r\n  projectId,\r\n  currentPhase,\r\n  fields,\r\n  onFieldUpdate,\r\n  onFieldsChange,\r\n}: ContentPanelProps) {\r\n  const phaseFields = fields.filter((f) => f.phase === currentPhase);\r\n  const allCompletedFields = fields.filter((f) => f.status === \"completed\");\r\n\r\n  if (!projectId) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full text-zinc-500\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-lg mb-2\">请选择或创建一个项目</p>\r\n          <p className=\"text-sm\">在左侧选择项目开始工作</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 消费者模拟阶段使用专用面板\r\n  if (currentPhase === \"simulate\") {\r\n    return (\r\n      <SimulationPanel\r\n        projectId={projectId}\r\n        fields={fields}\r\n        onSimulationCreated={onFieldsChange}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-4xl mx-auto\">\r\n      {/* 阶段标题 */}\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-2xl font-bold text-zinc-100\">\r\n          {PHASE_NAMES[currentPhase] || currentPhase}\r\n        </h1>\r\n        <p className=\"text-zinc-500 mt-1\">\r\n          {getPhaseDescription(currentPhase)}\r\n        </p>\r\n      </div>\r\n\r\n      {/* 字段列表 */}\r\n      {phaseFields.length > 0 ? (\r\n        <div className=\"space-y-6\">\r\n          {phaseFields.map((field) => (\r\n            <FieldCard\r\n              key={field.id}\r\n              field={field}\r\n              allFields={fields}\r\n              onUpdate={(content) => onFieldUpdate?.(field.id, content)}\r\n              onFieldsChange={onFieldsChange}\r\n            />\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-12 text-zinc-500\">\r\n          <p>当前阶段暂无内容</p>\r\n          <p className=\"text-sm mt-2\">\r\n            在右侧与 AI Agent 对话开始生产内容\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface FieldCardProps {\r\n  field: Field;\r\n  allFields: Field[];\r\n  onUpdate?: (content: string) => void;\r\n  onFieldsChange?: () => void;\r\n}\r\n\r\nfunction FieldCard({ field, allFields, onUpdate, onFieldsChange }: FieldCardProps) {\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [content, setContent] = useState(field.content);\r\n  const [showDependencyModal, setShowDependencyModal] = useState(false);\r\n  const [isGenerating, setIsGenerating] = useState(false);\r\n  const [generatingContent, setGeneratingContent] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    setContent(field.content);\r\n  }, [field.content]);\r\n\r\n  // 获取依赖字段信息\r\n  const dependsOnIds = field.dependencies?.depends_on || [];\r\n  const dependencyFields = allFields.filter((f) => dependsOnIds.includes(f.id));\r\n  const unmetDependencies = dependencyFields.filter((f) => f.status !== \"completed\");\r\n  const canGenerate = unmetDependencies.length === 0;\r\n\r\n  const handleSave = () => {\r\n    onUpdate?.(content);\r\n    setIsEditing(false);\r\n  };\r\n\r\n  const handleGenerate = async () => {\r\n    if (!canGenerate) {\r\n      alert(`请先完成依赖字段: ${unmetDependencies.map(f => f.name).join(\", \")}`);\r\n      return;\r\n    }\r\n\r\n    setIsGenerating(true);\r\n    setGeneratingContent(\"\");\r\n\r\n    try {\r\n      // 使用流式生成\r\n      const response = await fetch(`http://localhost:8000/api/fields/${field.id}/generate/stream`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ pre_answers: field.pre_answers || {} }),\r\n      });\r\n\r\n      const reader = response.body?.getReader();\r\n      const decoder = new TextDecoder();\r\n\r\n      if (reader) {\r\n        while (true) {\r\n          const { done, value } = await reader.read();\r\n          if (done) break;\r\n\r\n          const text = decoder.decode(value);\r\n          const lines = text.split(\"\\n\");\r\n\r\n          for (const line of lines) {\r\n            if (line.startsWith(\"data: \")) {\r\n              try {\r\n                const data = JSON.parse(line.slice(6));\r\n                if (data.chunk) {\r\n                  setGeneratingContent((prev) => prev + data.chunk);\r\n                }\r\n                if (data.done) {\r\n                  onFieldsChange?.();\r\n                }\r\n              } catch {}\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error(\"生成失败:\", err);\r\n      alert(\"生成失败: \" + (err instanceof Error ? err.message : \"未知错误\"));\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  };\r\n\r\n  const handleUpdateDependencies = async (newDependsOn: string[]) => {\r\n    try {\r\n      await fieldAPI.update(field.id, {\r\n        dependencies: {\r\n          depends_on: newDependsOn,\r\n          dependency_type: field.dependencies?.dependency_type || \"all\",\r\n        },\r\n      });\r\n      onFieldsChange?.();\r\n      setShowDependencyModal(false);\r\n    } catch (err) {\r\n      alert(\"更新依赖失败: \" + (err instanceof Error ? err.message : \"未知错误\"));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-surface-2 rounded-xl border border-surface-3 overflow-hidden\">\r\n      {/* 字段头部 */}\r\n      <div className=\"px-4 py-3 border-b border-surface-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h3 className=\"font-medium text-zinc-200\">{field.name}</h3>\r\n            <div className=\"flex items-center gap-2 mt-1\">\r\n              <span className={`text-xs px-2 py-0.5 rounded ${\r\n                field.status === \"completed\" \r\n                  ? \"bg-green-600/20 text-green-400\"\r\n                  : field.status === \"generating\"\r\n                  ? \"bg-yellow-600/20 text-yellow-400\"\r\n                  : \"bg-zinc-600/20 text-zinc-400\"\r\n              }`}>\r\n                {field.status === \"completed\" ? \"已生成\" \r\n                  : field.status === \"generating\" ? \"生成中...\" \r\n                  : \"待生成\"}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex gap-2\">\r\n            {field.status !== \"completed\" && !isGenerating && (\r\n              <button\r\n                onClick={handleGenerate}\r\n                disabled={!canGenerate}\r\n                className={`px-3 py-1 text-sm rounded-lg transition-colors ${\r\n                  canGenerate\r\n                    ? \"bg-brand-600 hover:bg-brand-700 text-white\"\r\n                    : \"bg-zinc-700 text-zinc-500 cursor-not-allowed\"\r\n                }`}\r\n                title={canGenerate ? \"生成内容\" : `依赖未满足: ${unmetDependencies.map(f => f.name).join(\", \")}`}\r\n              >\r\n                生成\r\n              </button>\r\n            )}\r\n            \r\n            {isEditing ? (\r\n              <>\r\n                <button\r\n                  onClick={handleSave}\r\n                  className=\"px-3 py-1 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg transition-colors\"\r\n                >\r\n                  保存\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    setContent(field.content);\r\n                    setIsEditing(false);\r\n                  }}\r\n                  className=\"px-3 py-1 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg transition-colors\"\r\n                >\r\n                  取消\r\n                </button>\r\n              </>\r\n            ) : (\r\n              <button\r\n                onClick={() => setIsEditing(true)}\r\n                className=\"px-3 py-1 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg transition-colors\"\r\n              >\r\n                编辑\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* 依赖关系显示 */}\r\n        <div className=\"mt-2 flex items-center gap-2 flex-wrap\">\r\n          <button\r\n            onClick={() => setShowDependencyModal(true)}\r\n            className=\"text-xs text-zinc-500 hover:text-zinc-300 flex items-center gap-1\"\r\n          >\r\n            <span>📎 依赖:</span>\r\n            {dependencyFields.length > 0 ? (\r\n              dependencyFields.map((df) => (\r\n                <span\r\n                  key={df.id}\r\n                  className={`px-1.5 py-0.5 rounded text-xs ${\r\n                    df.status === \"completed\"\r\n                      ? \"bg-green-600/20 text-green-400\"\r\n                      : \"bg-red-600/20 text-red-400\"\r\n                  }`}\r\n                >\r\n                  {df.name}\r\n                </span>\r\n              ))\r\n            ) : (\r\n              <span className=\"text-zinc-600\">无</span>\r\n            )}\r\n            <span className=\"text-zinc-600 ml-1\">（点击编辑）</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 字段内容 */}\r\n      <div className=\"p-4\">\r\n        {isGenerating ? (\r\n          <div className=\"bg-surface-1 border border-surface-3 rounded-lg p-3\">\r\n            <div className=\"text-xs text-brand-400 mb-2\">正在生成...</div>\r\n            <div className=\"whitespace-pre-wrap text-zinc-300 animate-pulse\">\r\n              {generatingContent || \"⏳ 准备中...\"}\r\n            </div>\r\n          </div>\r\n        ) : isEditing ? (\r\n          <textarea\r\n            value={content}\r\n            onChange={(e) => setContent(e.target.value)}\r\n            className=\"w-full min-h-[200px] bg-surface-1 border border-surface-3 rounded-lg p-3 text-zinc-200 resize-y focus:outline-none focus:ring-2 focus:ring-brand-500\"\r\n          />\r\n        ) : (\r\n          <div className=\"prose prose-invert max-w-none\">\r\n            {field.content ? (\r\n              <div className=\"whitespace-pre-wrap text-zinc-300\">\r\n                {field.content}\r\n              </div>\r\n            ) : (\r\n              <p className=\"text-zinc-500 italic\">暂无内容，点击\"生成\"按钮开始</p>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* 依赖选择弹窗 */}\r\n      {showDependencyModal && (\r\n        <DependencyModal\r\n          field={field}\r\n          allFields={allFields}\r\n          onClose={() => setShowDependencyModal(false)}\r\n          onSave={handleUpdateDependencies}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface DependencyModalProps {\r\n  field: Field;\r\n  allFields: Field[];\r\n  onClose: () => void;\r\n  onSave: (dependsOn: string[]) => void;\r\n}\r\n\r\nfunction DependencyModal({ field, allFields, onClose, onSave }: DependencyModalProps) {\r\n  const [selectedIds, setSelectedIds] = useState<string[]>(\r\n    field.dependencies?.depends_on || []\r\n  );\r\n\r\n  // 可选的依赖字段（排除自己）\r\n  const availableFields = allFields.filter((f) => f.id !== field.id);\r\n\r\n  const toggleField = (id: string) => {\r\n    setSelectedIds((prev) =>\r\n      prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-surface-2 rounded-xl border border-surface-3 w-full max-w-lg max-h-[80vh] overflow-hidden\">\r\n        <div className=\"px-4 py-3 border-b border-surface-3\">\r\n          <h3 className=\"font-medium text-zinc-200\">设置依赖关系</h3>\r\n          <p className=\"text-xs text-zinc-500 mt-1\">\r\n            选择生成\"{field.name}\"前需要先完成的字段\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"p-4 max-h-[50vh] overflow-y-auto space-y-2\">\r\n          {availableFields.length > 0 ? (\r\n            availableFields.map((f) => (\r\n              <label\r\n                key={f.id}\r\n                className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-surface-3 cursor-pointer\"\r\n              >\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={selectedIds.includes(f.id)}\r\n                  onChange={() => toggleField(f.id)}\r\n                  className=\"rounded\"\r\n                />\r\n                <div className=\"flex-1\">\r\n                  <div className=\"text-sm text-zinc-200\">{f.name}</div>\r\n                  <div className=\"text-xs text-zinc-500\">\r\n                    {f.phase} · {f.status === \"completed\" ? \"已完成\" : \"未完成\"}\r\n                  </div>\r\n                </div>\r\n                <span\r\n                  className={`w-2 h-2 rounded-full ${\r\n                    f.status === \"completed\" ? \"bg-green-500\" : \"bg-zinc-600\"\r\n                  }`}\r\n                />\r\n              </label>\r\n            ))\r\n          ) : (\r\n            <p className=\"text-zinc-500 text-center py-4\">暂无可选的依赖字段</p>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"px-4 py-3 border-t border-surface-3 flex justify-end gap-2\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-sm bg-surface-3 hover:bg-surface-4 rounded-lg transition-colors\"\r\n          >\r\n            取消\r\n          </button>\r\n          <button\r\n            onClick={() => onSave(selectedIds)}\r\n            className=\"px-4 py-2 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg transition-colors\"\r\n          >\r\n            保存\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getPhaseDescription(phase: string): string {\r\n  const descriptions: Record<string, string> = {\r\n    intent: \"澄清内容生产的核心意图和目标\",\r\n    research: \"调研目标用户，了解痛点和需求\",\r\n    design_inner: \"设计内容生产方案和大纲\",\r\n    produce_inner: \"生产核心内容\",\r\n    design_outer: \"设计外延传播方案\",\r\n    produce_outer: \"为各渠道生产营销内容\",\r\n    simulate: \"模拟用户体验，收集反馈\",\r\n    evaluate: \"全面评估内容质量\",\r\n  };\r\n  return descriptions[phase] || \"\";\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2497, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/components/agent-panel.tsx"],"sourcesContent":["// frontend/components/agent-panel.tsx\r\n// 功能: 右栏AI Agent对话面板\r\n// 主要组件: AgentPanel, MessageBubble, MentionDropdown, ToolSelector\r\n// 支持: @引用、对话历史加载、编辑重发、再试一次、一键复制、Tool调用\r\n\r\n\"use client\";\r\n\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { cn, PHASE_NAMES } from \"@/lib/utils\";\r\nimport { agentAPI } from \"@/lib/api\";\r\nimport type { Field, ChatMessageRecord } from \"@/lib/api\";\r\n\r\ninterface AgentPanelProps {\r\n  projectId: string | null;\r\n  fields?: Field[];\r\n  onSendMessage?: (message: string) => Promise<string>;\r\n  isLoading?: boolean;\r\n}\r\n\r\n// 可用的Tool列表\r\nconst AVAILABLE_TOOLS = [\r\n  { id: \"deep_research\", name: \"深度调研\", desc: \"使用DeepResearch进行网络调研\" },\r\n  { id: \"generate_field\", name: \"生成字段\", desc: \"根据上下文生成指定字段内容\" },\r\n  { id: \"simulate_consumer\", name: \"消费者模拟\", desc: \"模拟消费者体验内容\" },\r\n  { id: \"evaluate_content\", name: \"内容评估\", desc: \"评估内容质量\" },\r\n];\r\n\r\nexport function AgentPanel({\r\n  projectId,\r\n  fields = [],\r\n  onSendMessage,\r\n  isLoading = false,\r\n}: AgentPanelProps) {\r\n  const [messages, setMessages] = useState<ChatMessageRecord[]>([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n  const [showMentions, setShowMentions] = useState(false);\r\n  const [showTools, setShowTools] = useState(false);\r\n  const [mentionFilter, setMentionFilter] = useState(\"\");\r\n  const [mentionIndex, setMentionIndex] = useState(0);\r\n  const [cursorPosition, setCursorPosition] = useState(0);\r\n  const [editingMessageId, setEditingMessageId] = useState<string | null>(null);\r\n  const [editContent, setEditContent] = useState(\"\");\r\n\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const mentionStartPos = useRef<number>(-1);\r\n\r\n  const completedFields = fields.filter((f) => f.status === \"completed\");\r\n  const filteredFields = completedFields.filter((f) =>\r\n    f.name.toLowerCase().includes(mentionFilter.toLowerCase()) ||\r\n    f.phase.toLowerCase().includes(mentionFilter.toLowerCase())\r\n  );\r\n\r\n  // 加载对话历史\r\n  useEffect(() => {\r\n    if (projectId) {\r\n      loadHistory();\r\n    } else {\r\n      setMessages([]);\r\n    }\r\n  }, [projectId]);\r\n\r\n  // 自动滚动\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  const loadHistory = async () => {\r\n    if (!projectId) return;\r\n    try {\r\n      const history = await agentAPI.getHistory(projectId);\r\n      setMessages(history);\r\n    } catch (err) {\r\n      console.error(\"加载对话历史失败:\", err);\r\n    }\r\n  };\r\n\r\n  const insertMention = useCallback((field: Field) => {\r\n    const beforeMention = input.slice(0, mentionStartPos.current);\r\n    const afterMention = input.slice(cursorPosition);\r\n    const newInput = `${beforeMention}@${field.name}${afterMention}`;\r\n    setInput(newInput);\r\n    setShowMentions(false);\r\n    setMentionFilter(\"\");\r\n    mentionStartPos.current = -1;\r\n    setTimeout(() => inputRef.current?.focus(), 0);\r\n  }, [input, cursorPosition]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = e.target.value;\r\n    const selectionStart = e.target.selectionStart || 0;\r\n    setInput(value);\r\n    setCursorPosition(selectionStart);\r\n\r\n    const lastAtPos = value.lastIndexOf(\"@\", selectionStart - 1);\r\n    if (lastAtPos !== -1) {\r\n      const textAfterAt = value.slice(lastAtPos + 1, selectionStart);\r\n      if (!textAfterAt.includes(\" \")) {\r\n        mentionStartPos.current = lastAtPos;\r\n        setMentionFilter(textAfterAt);\r\n        setShowMentions(true);\r\n        setMentionIndex(0);\r\n        return;\r\n      }\r\n    }\r\n    setShowMentions(false);\r\n    setMentionFilter(\"\");\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (showMentions && filteredFields.length > 0) {\r\n      if (e.key === \"ArrowDown\") {\r\n        e.preventDefault();\r\n        setMentionIndex((prev) => (prev + 1) % filteredFields.length);\r\n        return;\r\n      }\r\n      if (e.key === \"ArrowUp\") {\r\n        e.preventDefault();\r\n        setMentionIndex((prev) => (prev - 1 + filteredFields.length) % filteredFields.length);\r\n        return;\r\n      }\r\n      if (e.key === \"Enter\" || e.key === \"Tab\") {\r\n        e.preventDefault();\r\n        insertMention(filteredFields[mentionIndex]);\r\n        return;\r\n      }\r\n      if (e.key === \"Escape\") {\r\n        setShowMentions(false);\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (e.key === \"Enter\" && !e.shiftKey && !showMentions) {\r\n      e.preventDefault();\r\n      handleSend();\r\n    }\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    if (!input.trim() || !projectId || sending) return;\r\n\r\n    const userMessage = input.trim();\r\n    setInput(\"\");\r\n    setSending(true);\r\n    setShowMentions(false);\r\n\r\n    try {\r\n      const response = await agentAPI.chat(projectId, userMessage);\r\n      // 重新加载历史以获取新消息\r\n      await loadHistory();\r\n    } catch (error) {\r\n      console.error(\"发送失败:\", error);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  const handleRetry = async (messageId: string) => {\r\n    if (!projectId) return;\r\n    setSending(true);\r\n    try {\r\n      await agentAPI.retryMessage(messageId);\r\n      await loadHistory();\r\n    } catch (err) {\r\n      console.error(\"重试失败:\", err);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  const handleEdit = (message: ChatMessageRecord) => {\r\n    setEditingMessageId(message.id);\r\n    setEditContent(message.content);\r\n  };\r\n\r\n  const handleSaveEdit = async () => {\r\n    if (!editingMessageId || !projectId) return;\r\n\r\n    try {\r\n      await agentAPI.editMessage(editingMessageId, editContent);\r\n      // 编辑后重新发送\r\n      const response = await agentAPI.chat(projectId, editContent);\r\n      await loadHistory();\r\n    } catch (err) {\r\n      console.error(\"编辑失败:\", err);\r\n    } finally {\r\n      setEditingMessageId(null);\r\n      setEditContent(\"\");\r\n    }\r\n  };\r\n\r\n  const handleCopy = async (content: string) => {\r\n    try {\r\n      await navigator.clipboard.writeText(content);\r\n      // 可以添加toast提示\r\n    } catch (err) {\r\n      console.error(\"复制失败:\", err);\r\n    }\r\n  };\r\n\r\n  const handleToolCall = async (toolId: string) => {\r\n    if (!projectId) return;\r\n    setShowTools(false);\r\n    setSending(true);\r\n\r\n    try {\r\n      await agentAPI.callTool(projectId, toolId, {});\r\n      await loadHistory();\r\n    } catch (err) {\r\n      console.error(\"Tool调用失败:\", err);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full\">\r\n      {/* 头部 */}\r\n      <div className=\"px-4 py-3 border-b border-surface-3\">\r\n        <h2 className=\"font-semibold text-zinc-100\">AI Agent</h2>\r\n        <p className=\"text-xs text-zinc-500\">\r\n          {projectId ? \"与 Agent 对话推进内容生产\" : \"请先选择项目\"}\r\n        </p>\r\n      </div>\r\n\r\n      {/* 消息列表 */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n        {messages.length === 0 && (\r\n          <div className=\"text-center text-zinc-500 py-8\">\r\n            <p>开始对话吧！</p>\r\n            <p className=\"text-sm mt-2\">\r\n              你可以说 \"开始\" 来启动内容生产流程\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {messages.map((msg) => (\r\n          <MessageBubble\r\n            key={msg.id}\r\n            message={msg}\r\n            isEditing={editingMessageId === msg.id}\r\n            editContent={editContent}\r\n            onEditContentChange={setEditContent}\r\n            onEdit={() => handleEdit(msg)}\r\n            onSaveEdit={handleSaveEdit}\r\n            onCancelEdit={() => setEditingMessageId(null)}\r\n            onRetry={() => handleRetry(msg.id)}\r\n            onCopy={() => handleCopy(msg.content)}\r\n          />\r\n        ))}\r\n\r\n        {sending && (\r\n          <div className=\"flex items-center gap-2 text-zinc-500\">\r\n            <div className=\"w-2 h-2 bg-brand-500 rounded-full animate-pulse\" />\r\n            <span className=\"text-sm\">Agent 正在思考...</span>\r\n          </div>\r\n        )}\r\n\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* 输入区 */}\r\n      <div className=\"p-4 border-t border-surface-3\">\r\n        <div className=\"relative\">\r\n          {/* @引用下拉菜单 */}\r\n          {showMentions && filteredFields.length > 0 && (\r\n            <div className=\"absolute bottom-full left-0 right-0 mb-1 bg-surface-2 border border-surface-3 rounded-lg shadow-xl max-h-48 overflow-y-auto z-10\">\r\n              <div className=\"p-2 text-xs text-zinc-500 border-b border-surface-3\">\r\n                选择要引用的字段\r\n              </div>\r\n              {filteredFields.map((field, idx) => (\r\n                <button\r\n                  key={field.id}\r\n                  onClick={() => insertMention(field)}\r\n                  className={cn(\r\n                    \"w-full px-3 py-2 text-left hover:bg-surface-3 flex items-center gap-2\",\r\n                    idx === mentionIndex && \"bg-surface-3\"\r\n                  )}\r\n                >\r\n                  <span className=\"text-xs text-zinc-500\">{PHASE_NAMES[field.phase] || field.phase}</span>\r\n                  <span className=\"text-sm text-zinc-200\">{field.name}</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {/* Tool选择下拉 */}\r\n          {showTools && (\r\n            <div className=\"absolute bottom-full left-0 right-0 mb-1 bg-surface-2 border border-surface-3 rounded-lg shadow-xl z-10\">\r\n              <div className=\"p-2 text-xs text-zinc-500 border-b border-surface-3\">\r\n                选择要调用的工具\r\n              </div>\r\n              {AVAILABLE_TOOLS.map((tool) => (\r\n                <button\r\n                  key={tool.id}\r\n                  onClick={() => handleToolCall(tool.id)}\r\n                  className=\"w-full px-3 py-2 text-left hover:bg-surface-3\"\r\n                >\r\n                  <div className=\"text-sm text-zinc-200\">{tool.name}</div>\r\n                  <div className=\"text-xs text-zinc-500\">{tool.desc}</div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-2\">\r\n            <input\r\n              ref={inputRef}\r\n              type=\"text\"\r\n              value={input}\r\n              onChange={handleInputChange}\r\n              onKeyDown={handleKeyDown}\r\n              placeholder={projectId ? \"输入消息... 使用 @ 引用字段\" : \"请先选择项目\"}\r\n              disabled={!projectId || sending}\r\n              className=\"flex-1 px-4 py-2 bg-surface-2 border border-surface-3 rounded-lg text-zinc-200 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-brand-500 disabled:opacity-50\"\r\n            />\r\n            <button\r\n              onClick={handleSend}\r\n              disabled={!projectId || !input.trim() || sending}\r\n              className=\"px-4 py-2 bg-brand-600 hover:bg-brand-700 disabled:bg-surface-3 disabled:cursor-not-allowed rounded-lg transition-colors\"\r\n            >\r\n              发送\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* 快捷操作 */}\r\n        <div className=\"flex gap-2 mt-2 flex-wrap\">\r\n          <QuickAction label=\"继续\" onClick={() => setInput(\"继续\")} disabled={!projectId || sending} />\r\n          <QuickAction label=\"开始调研\" onClick={() => setInput(\"开始消费者调研\")} disabled={!projectId || sending} />\r\n          <QuickAction label=\"评估\" onClick={() => setInput(\"评估当前内容\")} disabled={!projectId || sending} />\r\n          <button\r\n            onClick={() => setShowTools(!showTools)}\r\n            disabled={!projectId || sending}\r\n            className=\"px-2 py-1 text-xs text-brand-400 hover:text-brand-300 hover:bg-surface-3 disabled:opacity-50 rounded transition-colors flex items-center gap-1\"\r\n          >\r\n            🔧 调用工具\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MessageBubbleProps {\r\n  message: ChatMessageRecord;\r\n  isEditing: boolean;\r\n  editContent: string;\r\n  onEditContentChange: (content: string) => void;\r\n  onEdit: () => void;\r\n  onSaveEdit: () => void;\r\n  onCancelEdit: () => void;\r\n  onRetry: () => void;\r\n  onCopy: () => void;\r\n}\r\n\r\nfunction MessageBubble({\r\n  message,\r\n  isEditing,\r\n  editContent,\r\n  onEditContentChange,\r\n  onEdit,\r\n  onSaveEdit,\r\n  onCancelEdit,\r\n  onRetry,\r\n  onCopy,\r\n}: MessageBubbleProps) {\r\n  const isUser = message.role === \"user\";\r\n  const [showActions, setShowActions] = useState(false);\r\n\r\n  const renderContent = (content: string) => {\r\n    const parts = content.split(/(@[\\u4e00-\\u9fffa-zA-Z0-9_]+)/g);\r\n    return parts.map((part, i) => {\r\n      if (part.startsWith(\"@\")) {\r\n        return <span key={i} className=\"text-brand-400 font-medium\">{part}</span>;\r\n      }\r\n      return part;\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={cn(\"flex group\", isUser ? \"justify-end\" : \"justify-start\")}\r\n      onMouseEnter={() => setShowActions(true)}\r\n      onMouseLeave={() => setShowActions(false)}\r\n    >\r\n      <div className=\"relative max-w-[85%]\">\r\n        {/* 消息气泡 */}\r\n        <div\r\n          className={cn(\r\n            \"px-4 py-2 rounded-2xl\",\r\n            isUser\r\n              ? \"bg-brand-600 text-white rounded-br-md\"\r\n              : \"bg-surface-3 text-zinc-200 rounded-bl-md\"\r\n          )}\r\n        >\r\n          {isEditing ? (\r\n            <div className=\"space-y-2\">\r\n              <textarea\r\n                value={editContent}\r\n                onChange={(e) => onEditContentChange(e.target.value)}\r\n                className=\"w-full bg-surface-1 text-zinc-200 rounded p-2 text-sm min-h-[60px]\"\r\n              />\r\n              <div className=\"flex gap-2\">\r\n                <button onClick={onSaveEdit} className=\"px-2 py-1 text-xs bg-brand-600 rounded\">\r\n                  保存并重发\r\n                </button>\r\n                <button onClick={onCancelEdit} className=\"px-2 py-1 text-xs bg-surface-4 rounded\">\r\n                  取消\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              <div className=\"whitespace-pre-wrap text-sm\">\r\n                {renderContent(message.content)}\r\n              </div>\r\n              {message.is_edited && (\r\n                <span className=\"text-xs opacity-50 ml-1\">(已编辑)</span>\r\n              )}\r\n              {message.metadata?.tool_used && (\r\n                <span className=\"text-xs opacity-70 block mt-1\">\r\n                  🔧 {message.metadata.tool_used}\r\n                </span>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n\r\n        {/* 操作按钮 */}\r\n        {showActions && !isEditing && (\r\n          <div\r\n            className={cn(\r\n              \"absolute top-0 flex gap-1 bg-surface-2 rounded-lg shadow-lg p-1 z-10\",\r\n              isUser ? \"left-0 -translate-x-full -ml-2\" : \"right-0 translate-x-full ml-2\"\r\n            )}\r\n          >\r\n            <ActionButton icon=\"📋\" title=\"复制\" onClick={onCopy} />\r\n            {isUser && <ActionButton icon=\"✏️\" title=\"编辑重发\" onClick={onEdit} />}\r\n            {!isUser && <ActionButton icon=\"🔄\" title=\"再试一次\" onClick={onRetry} />}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ActionButton({ icon, title, onClick }: { icon: string; title: string; onClick: () => void }) {\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      title={title}\r\n      className=\"w-6 h-6 flex items-center justify-center text-xs hover:bg-surface-3 rounded transition-colors\"\r\n    >\r\n      {icon}\r\n    </button>\r\n  );\r\n}\r\n\r\nfunction QuickAction({ label, onClick, disabled }: { label: string; onClick: () => void; disabled: boolean }) {\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      disabled={disabled}\r\n      className=\"px-2 py-1 text-xs text-zinc-400 hover:text-zinc-200 hover:bg-surface-3 disabled:opacity-50 disabled:cursor-not-allowed rounded transition-colors\"\r\n    >\r\n      {label}\r\n    </button>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3187, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/vibe_projects/202601_content_production_system_2/frontend/app/workspace/page.tsx"],"sourcesContent":["// frontend/app/workspace/page.tsx\r\n// 功能: 内容生产工作台主页面\r\n// 主要组件: WorkspacePage\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { WorkspaceLayout } from \"@/components/layout/workspace-layout\";\r\nimport { ProgressPanel } from \"@/components/progress-panel\";\r\nimport { ContentPanel } from \"@/components/content-panel\";\r\nimport { AgentPanel } from \"@/components/agent-panel\";\r\nimport { CreateProjectModal } from \"@/components/create-project-modal\";\r\nimport { projectAPI, fieldAPI, agentAPI } from \"@/lib/api\";\r\nimport type { Project, Field } from \"@/lib/api\";\r\n\r\nexport default function WorkspacePage() {\r\n  const [projects, setProjects] = useState<Project[]>([]);\r\n  const [currentProject, setCurrentProject] = useState<Project | null>(null);\r\n  const [fields, setFields] = useState<Field[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n\r\n  // 加载项目列表\r\n  useEffect(() => {\r\n    loadProjects();\r\n  }, []);\r\n\r\n  // 加载当前项目的字段\r\n  useEffect(() => {\r\n    if (currentProject) {\r\n      loadFields(currentProject.id);\r\n    }\r\n  }, [currentProject?.id]);\r\n\r\n  const loadProjects = async () => {\r\n    try {\r\n      const data = await projectAPI.list();\r\n      setProjects(data);\r\n      \r\n      // 自动选择第一个项目\r\n      if (data.length > 0 && !currentProject) {\r\n        setCurrentProject(data[0]);\r\n      }\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : \"加载项目失败\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadFields = async (projectId: string) => {\r\n    try {\r\n      const data = await fieldAPI.listByProject(projectId);\r\n      setFields(data);\r\n    } catch (err) {\r\n      console.error(\"加载字段失败:\", err);\r\n    }\r\n  };\r\n\r\n  const handlePhaseClick = (phase: string) => {\r\n    if (currentProject) {\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        current_phase: phase,\r\n      });\r\n    }\r\n  };\r\n\r\n  const handlePhaseReorder = async (newPhaseOrder: string[]) => {\r\n    if (!currentProject) return;\r\n    \r\n    try {\r\n      // 更新本地状态\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        phase_order: newPhaseOrder,\r\n      });\r\n      \r\n      // 保存到服务器\r\n      await projectAPI.update(currentProject.id, { phase_order: newPhaseOrder });\r\n    } catch (err) {\r\n      console.error(\"更新阶段顺序失败:\", err);\r\n    }\r\n  };\r\n\r\n  const handleAutonomyChange = async (autonomy: Record<string, boolean>) => {\r\n    if (!currentProject) return;\r\n    \r\n    try {\r\n      // 更新本地状态\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        agent_autonomy: autonomy,\r\n      });\r\n      \r\n      // 保存到服务器\r\n      await projectAPI.update(currentProject.id, { agent_autonomy: autonomy });\r\n    } catch (err) {\r\n      console.error(\"更新自主权设置失败:\", err);\r\n    }\r\n  };\r\n\r\n  const handleFieldUpdate = async (fieldId: string, content: string) => {\r\n    try {\r\n      await fieldAPI.update(fieldId, { content });\r\n      // 重新加载字段\r\n      if (currentProject) {\r\n        loadFields(currentProject.id);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"更新字段失败:\", err);\r\n    }\r\n  };\r\n\r\n  const handleSendMessage = async (message: string): Promise<string> => {\r\n    if (!currentProject) {\r\n      throw new Error(\"请先选择项目\");\r\n    }\r\n\r\n    const response = await agentAPI.chat(\r\n      currentProject.id,\r\n      message,\r\n      currentProject.current_phase\r\n    );\r\n\r\n    // 更新项目状态\r\n    if (response.phase_status) {\r\n      setCurrentProject({\r\n        ...currentProject,\r\n        phase_status: response.phase_status,\r\n      });\r\n    }\r\n\r\n    // 重新加载字段\r\n    loadFields(currentProject.id);\r\n\r\n    return response.message;\r\n  };\r\n\r\n  const handleCreateProject = () => {\r\n    setShowCreateModal(true);\r\n  };\r\n\r\n  const handleProjectCreated = (project: Project) => {\r\n    setProjects([...projects, project]);\r\n    setCurrentProject(project);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-surface-0\">\r\n        <div className=\"text-zinc-400\">加载中...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-screen flex flex-col\">\r\n      {/* 顶部导航 */}\r\n      <header className=\"h-14 flex-shrink-0 border-b border-surface-3 bg-surface-1 flex items-center justify-between px-4\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <h1 className=\"text-lg font-semibold bg-gradient-to-r from-brand-400 to-brand-600 bg-clip-text text-transparent\">\r\n            内容生产系统\r\n          </h1>\r\n          \r\n          {/* 项目选择器 */}\r\n          <select\r\n            value={currentProject?.id || \"\"}\r\n            onChange={(e) => {\r\n              const project = projects.find((p) => p.id === e.target.value);\r\n              setCurrentProject(project || null);\r\n            }}\r\n            className=\"px-3 py-1.5 bg-surface-2 border border-surface-3 rounded-lg text-sm text-zinc-200 focus:outline-none focus:ring-2 focus:ring-brand-500\"\r\n          >\r\n            <option value=\"\">选择项目</option>\r\n            {projects.map((p) => (\r\n              <option key={p.id} value={p.id}>\r\n                {p.name} (v{p.version})\r\n              </option>\r\n            ))}\r\n          </select>\r\n          \r\n          <button\r\n            onClick={handleCreateProject}\r\n            className=\"px-3 py-1.5 text-sm bg-brand-600 hover:bg-brand-700 rounded-lg transition-colors\"\r\n          >\r\n            + 新建项目\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-4\">\r\n          <a\r\n            href=\"/settings\"\r\n            className=\"text-sm text-zinc-400 hover:text-zinc-200 transition-colors\"\r\n          >\r\n            后台设置\r\n          </a>\r\n        </div>\r\n      </header>\r\n\r\n      {/* 三栏布局 */}\r\n      <div className=\"flex-1 overflow-hidden\">\r\n        <WorkspaceLayout\r\n          leftPanel={\r\n            <ProgressPanel\r\n              project={currentProject}\r\n              onPhaseClick={handlePhaseClick}\r\n              onPhaseReorder={handlePhaseReorder}\r\n              onAutonomyChange={handleAutonomyChange}\r\n            />\r\n          }\r\n          centerPanel={\r\n            <ContentPanel\r\n              projectId={currentProject?.id || null}\r\n              currentPhase={currentProject?.current_phase || \"intent\"}\r\n              fields={fields}\r\n              onFieldUpdate={handleFieldUpdate}\r\n              onFieldsChange={() => currentProject && loadFields(currentProject.id)}\r\n            />\r\n          }\r\n          rightPanel={\r\n            <AgentPanel\r\n              projectId={currentProject?.id || null}\r\n              fields={fields}\r\n              onSendMessage={handleSendMessage}\r\n            />\r\n          }\r\n        />\r\n      </div>\r\n\r\n      {/* 错误提示 */}\r\n      {error && (\r\n        <div className=\"fixed bottom-4 right-4 px-4 py-2 bg-red-600 text-white rounded-lg\">\r\n          {error}\r\n          <button\r\n            onClick={() => setError(null)}\r\n            className=\"ml-2 text-red-200 hover:text-white\"\r\n          >\r\n            ✕\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}